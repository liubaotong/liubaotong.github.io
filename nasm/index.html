<!DOCTYPE html>
<!-- saved from url=(0021)https://asmtutor.com/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>NASM Assembly Language Tutorials - asmtutor.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="./assets/bootstrap.min.css" rel="stylesheet">
    <link href="./assets/all.css" rel="stylesheet">
    <link href="./assets/stylesheet.css" rel="stylesheet">
    <link href="./assets/bootstrap-responsive.min.css" rel="stylesheet">

  <script async="" src="./assets/analytics.js"></script><script src="./assets/shCore.js"></script>
    <script src="./assets/shBrushAsm.js"></script>
    <link href="./assets/shCoreDefault.css" rel="stylesheet">

    <script type="text/javascript">SyntaxHighlighter.all();</script>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}
.immersive-translate-attach-loading::after {
  content: " ";

  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;

  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-2000%, -50%);
  z-index: 100;
}

.immersive-translate-loading-spinner {
  vertical-align: middle !important;
  width: 10px !important;
  height: 10px !important;
  display: inline-block !important;
  margin: 0 4px !important;
  border: 2px rgba(221, 244, 255, 0.6) solid !important;
  border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-radius: 50% !important;
  padding: 0 !important;
  -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
  animation: immersive-translate-loading-animation 0.6s infinite linear !important;
}

@-webkit-keyframes immersive-translate-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes immersive-translate-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
      100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
      110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
      120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}

.immersive-translate-toast {
  display: flex;
  position: fixed;
  z-index: 2147483647;
  left: 0;
  right: 0;
  top: 1%;
  width: fit-content;
  padding: 12px 20px;
  margin: auto;
  overflow: auto;
  background: #fef6f9;
  box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
  font-size: 15px;
  border-radius: 8px;
  color: #333;
}

.immersive-translate-toast-content {
  display: flex;
  flex-direction: row;
  align-items: center;
}

.immersive-translate-toast-hidden {
  margin: 0 20px 0 72px;
  text-decoration: underline;
  cursor: pointer;
}

.immersive-translate-toast-close {
  color: #666666;
  font-size: 20px;
  font-weight: bold;
  padding: 0 10px;
  cursor: pointer;
}

@media screen and (max-width: 768px) {
  .immersive-translate-toast {
    top: 0;
    padding: 12px 0px 0 10px;
  }
  .immersive-translate-toast-content {
    flex-direction: column;
    text-align: center;
  }
  .immersive-translate-toast-hidden {
    margin: 10px auto;
  }
}

.immersive-translate-modal {
  display: none;
  position: fixed;
  z-index: 2147483647;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
  font-size: 15px;
}

.immersive-translate-modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 40px 24px 24px;
  border: 1px solid #888;
  border-radius: 10px;
  width: 80%;
  max-width: 270px;
  font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
    "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  position: relative;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-content {
    margin: 50% auto !important;
  }
}

.immersive-translate-modal .immersive-translate-modal-content-in-input {
  max-width: 500px;
}
.immersive-translate-modal-content-in-input .immersive-translate-modal-body {
  text-align: left;
  max-height: unset;
}

.immersive-translate-modal-title {
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #333333;
}

.immersive-translate-modal-body {
  text-align: center;
  font-size: 14px;
  font-weight: 400;
  color: #333333;
  word-break: break-all;
  margin-top: 24px;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-body {
    max-height: 250px;
    overflow-y: auto;
  }
}

.immersive-translate-close {
  color: #666666;
  position: absolute;
  right: 16px;
  top: 16px;
  font-size: 20px;
  font-weight: bold;
}

.immersive-translate-close:hover,
.immersive-translate-close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.immersive-translate-modal-footer {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 24px;
}

.immersive-translate-btn {
  width: fit-content;
  color: #fff;
  background-color: #ea4c89;
  border: none;
  font-size: 16px;
  margin: 0 8px;
  padding: 9px 30px;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.immersive-translate-btn:hover {
  background-color: #f082ac;
}
.immersive-translate-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.immersive-translate-btn:disabled:hover {
  background-color: #ea4c89;
}

.immersive-translate-cancel-btn {
  /* gray color */
  background-color: rgb(89, 107, 120);
}

.immersive-translate-cancel-btn:hover {
  background-color: hsl(205, 20%, 32%);
}

.immersive-translate-action-btn {
  background-color: transparent;
  color: #ea4c89;
  border: 1px solid #ea4c89;
}

.immersive-translate-btn svg {
  margin-right: 5px;
}

.immersive-translate-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #007bff;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-primary-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #ea4c89;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-modal input[type="radio"] {
  margin: 0 6px;
  cursor: pointer;
}

.immersive-translate-modal label {
  cursor: pointer;
}

.immersive-translate-close-action {
  position: absolute;
  top: 2px;
  right: 0px;
  cursor: pointer;
}

.imt-image-status {
  background-color: rgba(0, 0, 0, 0.5) !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  border-radius: 16px !important;
}
.imt-image-status img,
.imt-image-status svg,
.imt-img-loading {
  width: 28px !important;
  height: 28px !important;
  margin: 0 0 8px 0 !important;
  min-height: 28px !important;
  min-width: 28px !important;
  position: relative !important;
}
.imt-img-loading {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
  background-size: 28px 28px;
  animation: image-loading-rotate 1s linear infinite !important;
}

.imt-image-status span {
  color: var(--bg-2, #fff) !important;
  font-size: 14px !important;
  line-height: 14px !important;
  font-weight: 500 !important;
  font-family: "PingFang SC", Arial, sans-serif !important;
}

@keyframes image-loading-rotate {
  from {
    transform: rotate(360deg);
  }
  to {
    transform: rotate(0deg);
  }
}
</style></head>

<body style="zoom: 1;">

    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container-fluid">
                <span class="brand">NASM Assembly Language Tutorials - asmtutor.com</span>
                <div class="nav-collapse collapse">
                    <p class="navbar-text pull-right">
                        <a class="navbar-link" href="./#top">Top</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row-fluid">

            <div class="span3">
                <div class="well sidebar-nav">
                    <ul class="nav nav-list">
                        <li class="nav-header">Lessons</li>
                        <li><a href="./#lesson1">Lesson 1 <span>Hello, world!</span></a></li>
                        <li><a href="./#lesson2">Lesson 2 <span>Proper program exit</span></a></li>
                        <li><a href="./#lesson3">Lesson 3 <span>Calculate string length</span></a></li>
                        <li><a href="./#lesson4">Lesson 4 <span>Subroutines</span></a></li>
                        <li><a href="./#lesson5">Lesson 5 <span>External include files</span></a></li>
                        <li><a href="./#lesson6">Lesson 6 <span>NULL terminating bytes</span></a></li>
                        <li><a href="./#lesson7">Lesson 7 <span>Linefeeds</span></a></li>
                        <li><a href="./#lesson8">Lesson 8 <span>Passing arguments</span></a></li>
                        <li><a href="./#lesson9">Lesson 9 <span>User input</span></a></li>
                        <li><a href="./#lesson10">Lesson 10 <span>Count to 10</span></a></li>
                        <li><a href="./#lesson11">Lesson 11 <span>Count to 10 (itoa)</span></a></li>
                        <li><a href="./#lesson12">Lesson 12 <span>Calculator - addition</span></a></li>
                        <li><a href="./#lesson13">Lesson 13 <span>Calculator - subtraction</span></a></li>
                        <li><a href="./#lesson14">Lesson 14 <span>Calculator - multiplication</span></a></li>
                        <li><a href="./#lesson15">Lesson 15 <span>Calculator - division</span></a></li>
                        <li><a href="./#lesson16">Lesson 16 <span>Calculator (atoi)</span></a></li>
                        <li><a href="./#lesson17">Lesson 17 <span>Namespace</span></a></li>
                        <li><a href="./#lesson18">Lesson 18 <span>Fizz Buzz</span></a></li>
                        <li><a href="./#lesson19">Lesson 19 <span>Execute Command</span></a></li>
                        <li><a href="./#lesson20">Lesson 20 <span>Process Forking</span></a></li>
                        <li><a href="./#lesson21">Lesson 21 <span>Telling the time</span></a></li>
                        <li><a href="./#lesson22">Lesson 22 <span>File Handling - Create</span></a></li>
                        <li><a href="./#lesson23">Lesson 23 <span>File Handling - Write</span></a></li>
                        <li><a href="./#lesson24">Lesson 24 <span>File Handling - Open</span></a></li>
                        <li><a href="./#lesson25">Lesson 25 <span>File Handling - Read</span></a></li>
                        <li><a href="./#lesson26">Lesson 26 <span>File Handling - Close</span></a></li>
                        <li><a href="./#lesson27">Lesson 27 <span>File Handling - Update</span></a></li>
                        <li><a href="./#lesson28">Lesson 28 <span>File Handling - Delete</span></a></li>
                        <li><a href="./#lesson29">Lesson 29 <span>Sockets - Create</span></a></li>
                        <li><a href="./#lesson30">Lesson 30 <span>Sockets - Bind</span></a></li>
                        <li><a href="./#lesson31">Lesson 31 <span>Sockets - Listen</span></a></li>
                        <li><a href="./#lesson32">Lesson 32 <span>Sockets - Accept</span></a></li>
                        <li><a href="./#lesson33">Lesson 33 <span>Sockets - Read</span></a></li>
                        <li><a href="./#lesson34">Lesson 34 <span>Sockets - Write</span></a></li>
                        <li><a href="./#lesson35">Lesson 35 <span>Sockets - Close</span></a></li>
                        <li><a href="./#lesson36">Lesson 36 <span>Download a Webpage</span></a></li>
                    </ul>
                </div>
            </div>

            <div class="span9 lessons">

                <div class="hero-unit">
                    <h2>Learn Assembly Language</h2>
                    <p>This project was put together to teach myself NASM x86 assembly language on linux.</p>
                    <p><a href="https://github.com/DGivney/assemblytutorials" class="btn btn-primary btn" target="_blank">Github Project »</a></p>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 1</h2>
                        <h5>The obligatory 'Hello, world!'</h5>
                        <p>Introduction to the Linux System Call Table.  In this lesson we use software interrupts to request system functions from the kernel in order to print out 'Hello World!' to the console.</p>
                        <p><a class="btn" href="./#lesson1">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 2</h2>
                        <h5>Proper program exit</h5>
                        <p>A very brief lesson about memory addresses, sequential code execution and how to properly terminate a program without errors.</p>
                        <p><a class="btn" href="./#lesson2">View details »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 3</h2>
                        <h5>Calculate string length</h5>
                        <p>What if we wanted to output something that we don't know the length of? Like user input? Learn about loops, labels and pointer arithmic.</p>
                        <p><a class="btn" href="./#lesson3">View details »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 4</h2>
                        <h5>Subroutines</h5>
                        <p>Introduction to the stack and how to write clean, reusable code in assembly.</p>
                        <p><a class="btn" href="./#lesson4">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 5</h2>
                        <h5>External include files</h5>
                        <p>To further simplify our code we can move our subroutines into an external include file.</p>
                        <p><a class="btn" href="./#lesson5">View details »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 6</h2>
                        <h5>NULL terminating bytes</h5>
                        <p>A quick lesson on how memory is handled. This lesson also fixes the duplication bug we added in lesson 5.</p>
                        <p><a class="btn" href="./#lesson6">View details »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 7</h2>
                        <h5>Linefeeds</h5>
                        <p>How you can use the stack to print linefeeds after strings and an introduction to the Extended Stack Pointer <span class="register-name">ESP.</span></p>
                        <p><a class="btn" href="./#lesson7">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 8</h2>
                        <h5>Passing arguments</h5>
                        <p>Passing arguments to your program from the command line.</p>
                        <p><a class="btn" href="./#lesson8">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 9</h2>
                        <h5>User input</h5>
                        <p>Introduction to the BSS section and how to trigger a call to <span class="function-name">sys_read</span> to process user input.</p>
                        <p><a class="btn" href="./#lesson9">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 10</h2>
                        <h5>Count to 10</h5>
                        <p>Introduction to numbers and counting in assembly.</p>
                        <p><a class="btn" href="./#lesson10">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 11</h2>
                        <h5>Count to 10 (itoa)</h5>
                        <p>Introduction to ASCII and how to convert integers to their string representations in assembly.</p>
                        <p><a class="btn" href="./#lesson11">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 12</h2>
                        <h5>Calculator - addition</h5>
                        <p>Introduction to calulating numbers in assembly.  This tutorial describes a simple program to <span class="instruction-name">add</span> two numbers together.</p>
                        <p><a class="btn" href="./#lesson12">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 13</h2>
                        <h5>Calculator - subtraction</h5>
                        <p>Introduction to calulating numbers in assembly.  This tutorial describes a simple program to subtract one number from another.</p>
                        <p><a class="btn" href="./#lesson13">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 14</h2>
                        <h5>Calculator - multiplication</h5>
                        <p>Introduction to calulating numbers in assembly.  This tutorial describes a simple program to multiply two numbers together.</p>
                        <p><a class="btn" href="./#lesson14">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 15</h2>
                        <h5>Calculator - division</h5>
                        <p>Introduction to calulating numbers in assembly.  This tutorial describes a simple program to divide one number by another.</p>
                        <p><a class="btn" href="./#lesson15">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 16</h2>
                        <h5>Calculator (atoi)</h5>
                        <p>This program takes a series of passed string arguments, converts them to integers and adds them all together.</p>
                        <p><a class="btn" href="./#lesson16">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 17</h2>
                        <h5>Namespace</h5>
                        <p>Introduction to how NASM handles namespace when it comes to global and local labels.</p>
                        <p><a class="btn" href="./#lesson17">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 18</h2>
                        <h5>Fizz Buzz</h5>
                        <p>The Fizz Buzz programming challenge recreated in NASM.</p>
                        <p><a class="btn" href="./#lesson18">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 19</h2>
                        <h5>Execute Command</h5>
                        <p>In this lesson we replace the currently running process with a new process that executes a command.</p>
                        <p><a class="btn" href="./#lesson19">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 20</h2>
                        <h5>Process Forking</h5>
                        <p>In this lesson we create a new process that duplicates our current process.</p>
                        <p><a class="btn" href="./#lesson20">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 21</h2>
                        <h5>Telling the time</h5>
                        <p>In this lesson we ask the kernel for the current unix timestamp.</p>
                        <p><a class="btn" href="./#lesson21">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 22</h2>
                        <h5>File Handling - Create</h5>
                        <p>In this lesson we learn how to create a new file in Assembly.</p>
                        <p><a class="btn" href="./#lesson22">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 23</h2>
                        <h5>File Handling - Write</h5>
                        <p>In this lesson we write content to a newly created text file.</p>
                        <p><a class="btn" href="./#lesson23">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 24</h2>
                        <h5>File Handling - Open</h5>
                        <p>In this lesson we open a text file and print it's file descriptor.</p>
                        <p><a class="btn" href="./#lesson24">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 25</h2>
                        <h5>File Handling - Read</h5>
                        <p>In this lesson we read content from a newly created text file.</p>
                        <p><a class="btn" href="./#lesson25">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 26</h2>
                        <h5>File Handling - Close</h5>
                        <p>In this lesson we close a newly created text file using it's file descriptor.</p>
                        <p><a class="btn" href="./#lesson26">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 27</h2>
                        <h5>File Handling - Update</h5>
                        <p>In this lesson we update the content of an included text file using seek.</p>
                        <p><a class="btn" href="./#lesson27">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 28</h2>
                        <h5>File Handling - Delete</h5>
                        <p>In this lesson we learn how to delete a file.</p>
                        <p><a class="btn" href="./#lesson28">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 29</h2>
                        <h5>Sockets - Create</h5>
                        <p>In this lesson we learn how to create a new socket in assembly and store it's file descriptor.</p>
                        <p><a class="btn" href="./#lesson29">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 30</h2>
                        <h5>Sockets - Bind</h5>
                        <p>In this lesson we learn how to bind a socket to an IP Address &amp; Port Number.</p>
                        <p><a class="btn" href="./#lesson30">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 31</h2>
                        <h5>Sockets - Listen</h5>
                        <p>In this lesson we learn how to make a socket listen for incoming connections.</p>
                        <p><a class="btn" href="./#lesson31">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 32</h2>
                        <h5>Sockets - Accept</h5>
                        <p>In this lesson we learn how to make a socket accept incoming connections.</p>
                        <p><a class="btn" href="./#lesson32">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 33</h2>
                        <h5>Sockets - Read</h5>
                        <p>In this lesson we learn how to read incoming requests on a socket.</p>
                        <p><a class="btn" href="./#lesson33">View lesson »</a></p>
                    </div>
                </div>

                <div class="row-fluid hidden-phone">
                    <div class="span4">
                        <h2>Lesson 34</h2>
                        <h5>Sockets - Write</h5>
                        <p>In this lesson we learn how to make a socket respond to incoming requests.</p>
                        <p><a class="btn" href="./#lesson34">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 35</h2>
                        <h5>Sockets - Close</h5>
                        <p>In this lesson we learn how to shutdown and close an open socket connection.</p>
                        <p><a class="btn" href="./#lesson35">View lesson »</a></p>
                    </div>
                    <div class="span4">
                        <h2>Lesson 36</h2>
                        <h5>Download a Webpage</h5>
                        <p>In this lesson we're going to connect to a webserver and send a HTTP request for a webpage. We'll then print the server's response to our terminal.</p>
                        <p><a class="btn" href="./#lesson36">View lesson »</a></p>
                    </div>
                </div>

                <hr>

                <div class="row-fluid" id="lesson1">
                    <article class="span12">
                        <header>
                            <h2>Lesson 1</h2>
                            <h4>Hello, world!</h4>
                        </header>

                            <h5>First, some background</h5>

                            <p>Assembly language is bare-bones. The only interface a programmer has above the actual hardware is the kernel itself. In order to build useful programs in assembly we need to use the linux system calls provided by the kernel. These system calls are a library built into the operating system to provide functions such as reading input from a keyboard and writing output to the screen.</p>

                            <p>When you invoke a system call the kernel will immediately suspend execution of your program.  It will then contact the necessary drivers needed to perform the task you requested on the hardware and then return control back to your program.</p>

                            <p>
                                <span class="label label-info">Note:</span>
                                Drivers are called <i>drivers</i> because the kernel literally uses them to drive the hardware.
                            </p>

                            <p>We can accomplish this all in assembly by loading <span class="register-name">EAX</span> with the function number (operation code OPCODE) we want to execute and filling the remaining registers with the arguments we want to pass to the system call. A software interrupt is requested with the <span class="instruction-name">INT</span> instruction and the kernel takes over and calls the function from the library with our arguments. Simple.</p>

                            <p>For example requesting an interrupt when <span class="register-name">EAX=1</span> will call <span class="function-name">sys_exit</span> and requesting an interrupt when <span class="register-name">EAX=4</span> will call <span class="function-name">sys_write</span> instead. <span class="register-name">EBX,</span> <span class="register-name">ECX</span> &amp; <span class="register-name">EDX</span> will be passed as arguments if the function requires them. <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/constants/syscalls.md#x86-32_bit" target="_blank">Click here to view an example of a Linux System Call Table and its corresponding OPCODES.</a></p>

                            <h5>Writing our program</h5>

                            <p>Firstly we create a variable 'msg' in our .data section and assign it the string we want to output in this case 'Hello, world!'. In our .text section we tell the kernel where to begin execution by providing it with a global label _start: to denote the programs entry point.</p>

                            <p>We will be using the system call <span class="function-name">sys_write</span> to output our message to the console window.  This function is assigned OPCODE 4 in the Linux System Call Table.  The function also takes 3 arguments which are sequentially loaded into <span class="register-name">EDX,</span> <span class="register-name">ECX</span> and <span class="register-name">EBX</span> before requesting a software interrupt which will perform the task.</p>

                            <p>The arguments passed are as follows:
                                </p><ul>
                                    <li> <span class="register-name">EDX</span> will be loaded with the length (in bytes) of the string.</li>
                                    <li> <span class="register-name">ECX</span> will be loaded with the address of our variable created in the .data section.</li>
                                    <li> <span class="register-name">EBX</span> will be loaded with the file we want to write to – in this case STDOUT.</li>
                                </ul>
                                The datatype and meaning of the arguments passed can be found in the function's definition.
                            <p></p>

                            <p>We compile, link and run the program using the commands below.</p>

                        <div class="snippet">
                            <span class="filename">helloworld.asm</span>
                            <div><div id="highlighter_746511" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program - asmtutor.com</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld.o -o helloworld</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number7 index6 alt2"><code class="asm plain">msg&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello World!'</code><code class="asm plain">, 0Ah&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; assign msg variable with your message string</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number10 index9 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm plain">_start:</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 13&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to write - one for each letter plus 0Ah (line feed character)</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, msg&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our message string into ecx</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; write to the STDOUT file</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_WRITE (kernel opcode 4)</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld.o -o helloworld</span>
                                    <span>~$ ./helloworld</span>
                                    <span>Hello World!</span>
                                    <span>Segmentation fault</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-important">Error:</span>
                            Segmentation fault
                        </p>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson2">
                    <article class="span12">
                        <header>
                            <h2>Lesson 2</h2>
                            <h4>Proper program exit</h4>
                        </header>

                        <h5>Some more background</h5>

                        <p>After successfully learning how to execute a system call in Lesson 1 we now need to learn about one of the most important system calls in the kernel, <span class="function-name">sys_exit.</span></p>

                        <p>Notice how after our 'Hello, world!' program ran we got a Segmentation fault? Well, computer programs can be thought of as a long strip of instructions that are loaded into memory and divided up into sections (or segments). This general pool of memory is shared between all programs and can be used to store variables, instructions, other programs or anything really. Each segment is given an address so that information stored in that section can be found later.</p>

                        <p>To execute a program that is loaded in memory, we use the global label _start: to tell the operating system where in memory our program can be found and executed.  Memory is then accessed sequentially following the program logic which determines the next address to be accessed. The kernel jumps to that address in memory and executes it.</p>

                        <p>It's important to tell the operating system exactly where it should begin execution and where it should stop. In Lesson 1 we didn't tell the kernel where to stop execution. So, after we called <span class="function-name">sys_write</span> the program continued sequentially executing the next address in memory, which could have been anything. We don't know what the kernel tried to execute but it caused it to choke and terminate the process for us instead - leaving us the error message of 'Segmentation fault'.  Calling <span class="function-name">sys_exit</span> at the end of all our programs will mean the kernel knows exactly when to terminate the process and return memory back to the general pool thus avoiding an error.</p>

                        <h5>Writing our program</h5>

                        <p><span class="function-name">Sys_exit</span> has a simple function definition.  In the Linux System Call Table it is allocated OPCODE 1 and is passed a single argument through <span class="register-name">EBX.</span></p>

                        <p>In order to execute this function all we need to do is:
                            </p><ul>
                                <li>Load <span class="register-name">EBX</span> with 0 to pass zero to the function meaning 'zero errors'.</li>
                                <li>Load <span class="register-name">EAX</span> with 1 to call <span class="function-name">sys_exit.</span></li>
                                <li>Then request an interrupt on libc using <span class="instruction-name">INT</span> 80h.</li>
                            </ul>
                        <p></p>

                        <p>We then compile, link and run it again.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Only new code added in each lesson will be commented.
                        </p>

                        <div class="snippet">
                            <span class="filename">helloworld.asm</span>
                            <div><div id="highlighter_832656" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program - asmtutor.com</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld.o -o helloworld</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number7 index6 alt2"><code class="asm plain">msg&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello World!'</code><code class="asm plain">, 0Ah</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number10 index9 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm plain">_start:</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 13</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, msg</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; return 0 status on exit - 'No Errors'</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_EXIT (kernel opcode 1)</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld.o -o helloworld</span>
                                    <span>~$ ./helloworld</span>
                                    <span>Hello World!</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson3">
                    <article class="span12">
                        <header>
                            <h2>Lesson 3</h2>
                            <h4>Calculate string length</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>Why do we need to calculate the length of a string?</p>

                        <p>Well <span class="function-name">sys_write</span> requires that we pass it a pointer to the string we want to output in memory and the length in bytes we want to print out.  If we were to modify our message string we would have to update the length in bytes that we pass to <span class="function-name">sys_write</span> as well, otherwise it will not print correctly. </p>

                        <p>You can see what I mean using the program in Lesson 2.  Modify the message string to say 'Hello, brave new world!' then compile, link and run the new program.  The output will be 'Hello, brave ' (the first 13 characters) because we are still only passing 13 bytes to <span class="function-name">sys_write</span> as its length.  It will be particularly necessary when we want to print out user input.  As we won't know the length of the data when we compile our program, we will need a way to calculate the length at runtime in order to successfully print it out.</p>

                        <h5>Writing our program</h5>

                        <p>To calculate the length of the string we will use a technique called pointer arithmetic.  Two registers are initialised pointing to the same address in memory.  One register (in this case <span class="register-name">EAX)</span> will be incremented forward one byte for each character in the output string until we reach the end of the string.  The original pointer will then be subtracted from <span class="register-name">EAX.</span>  This is effectively like subtraction between two arrays and the result yields the number of elements between the two addresses. This result is then passed to <span class="function-name">sys_write</span> replacing our hard coded count.</p>

                        <p>The <span class="instruction-name">CMP</span> instruction compares the left hand side against the right hand side and sets a number of flags that are used for program flow.  The flag we're checking is the ZF or Zero Flag.  When the byte that <span class="register-name">EAX</span> points to is equal to zero the ZF flag is set.  We then use the JZ instruction to jump, if the ZF flag is set, to the point in our program labeled 'finished'. This is to break out of the nextchar loop and continue executing the rest of the program.</p>

                        <div class="snippet">
                            <span class="filename">helloworld-len.asm</span>
                            <div><div id="highlighter_181148" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Calculating string length)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-len.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-len.o -o helloworld-len</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-len</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number7 index6 alt2"><code class="asm plain">msg&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello, brave new world!'</code><code class="asm plain">, 0Ah</code> <code class="asm comments">; we can modify this now without having to update anywhere else in the program</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number10 index9 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm plain">_start:</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of our message string into EBX</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the address in EBX into EAX as well (Both now point to the same segment in memory)</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm plain">nextchar:</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">[</code><code class="asm color1 bold">eax</code><code class="asm plain">], 0&nbsp; </code> <code class="asm comments">; compare the byte pointed to by EAX at this address against zero (Zero is an end of string delimiter)</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump (if the zero flagged has been set) to the point in the code labeled 'finished'</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; increment the address in EAX by one byte (if the zero flagged has NOT been set)</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextchar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump to the point in the code labeled 'nextchar'</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm plain">finished:</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; subtract the address in EBX from the address in EAX</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; remember both registers started pointing to the same address (see line 15)</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; but EAX has been incremented one byte for each character in the message string</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; when you subtract one memory address from another of the same type</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; the result is number of segments between them - in this case the number of bytes</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; EAX now equals the number of bytes in our string</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; the rest of the code should be familiar now</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-len.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-len.o -o helloworld-len</span>
                                    <span>~$ ./helloworld-len</span>
                                    <span>Hello, brave new world!</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson4">
                    <article class="span12">
                        <header>
                            <h2>Lesson 4</h2>
                            <h4>Subroutines</h4>
                        </header>

                        <h5>Introduction to subroutines</h5>

                        <p>Subroutines are functions.  They are reusable pieces of code that can be called by your program to perform various repeatable tasks.  Subroutines are declared using labels just like we've used before (eg. _start:) however we don't use the <span class="instruction-name">JMP</span> instruction to get to them - instead we use a new instruction <span class="instruction-name">CALL</span>. We also don't use the <span class="instruction-name">JMP</span> instruction to return to our program after we have run the function.  To return to our program from a subroutine we use the instruction <span class="instruction-name">RET</span> instead.</p>

                        <h5>Why don't we JMP to subroutines?</h5>

                        <p>The great thing about writing a subroutine is that we can reuse it.  If we want to be able to use the subroutine from anywhere in the code we would have to write some logic to determine where in the code we had jumped from and where we should jump back to.  This would litter our code with unwanted labels.  If we use <span class="instruction-name">CALL</span> and <span class="instruction-name">RET</span> however, assembly handles this problem for us using something called the stack.</p>

                        <h5>Introduction to the stack</h5>

                        <p>The stack is a special type of memory.  It's the same type of memory that we've used before however it's special in how it is used by our program.  The stack is what is call <strong>Last In First Out</strong> memory (LIFO).  You can think of the stack like a stack of plates in your kitchen.  The last plate you put on the stack is also the first plate you will take off the stack next time you use a plate.</p>

                        <p>The stack in assembly is not storing plates though, its storing values.  You can store a lot of things on the stack such as variables, addresses or other programs.  We need to use the stack when we call subroutines to temporarily store values that will be restored later.</p>

                        <p>Any register that your function needs to use should have it's current value put on the stack for safe keeping using the <span class="instruction-name">PUSH</span> instruction.  Then after the function has finished it's logic, these registers can have their original values restored using the <span class="instruction-name">POP</span> instruction.  This means that any values in the registers will be the same before and after you've called your function.  If we take care of this in our subroutine we can call functions without worrying about what changes they're making to our registers.</p>

                        <p>The <span class="instruction-name">CALL</span> and <span class="instruction-name">RET</span> instructions also use the stack.  When you <span class="instruction-name">CALL</span> a subroutine, the address you called it from in your program is pushed onto the stack.  This address is then popped off the stack by <span class="instruction-name">RET</span> and the program jumps back to that place in your code.  This is why you should always <span class="instruction-name">JMP</span> to labels but you should <span class="instruction-name">CALL</span> functions.</p>

                        <div class="snippet">
                            <span class="filename">helloworld-len.asm</span>
                            <div><div id="highlighter_187174" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Subroutines)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-len.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-len.o -o helloworld-len</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-len</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number7 index6 alt2"><code class="asm plain">msg&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello, brave new world!'</code><code class="asm plain">, 0Ah</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number10 index9 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm plain">_start:</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of our message string into EAX</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">strlen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our function to calculate the length of the string</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; our function leaves the result in EAX</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; this is all the same as before</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="asm plain">strlen:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; this is our first function declaration</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the value in EBX onto the stack to preserve it while we use EBX in this function</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the address in EAX into EBX (Both point to the same segment in memory)</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="asm plain">nextchar:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; this is the same as lesson3</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">[</code><code class="asm color1 bold">eax</code><code class="asm plain">], 0</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">finished</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextchar</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="asm plain">finished:</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; pop the value on the stack back into EBX</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; return to where the function was called</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-len.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-len.o -o helloworld-len</span>
                                    <span>~$ ./helloworld-len</span>
                                    <span>Hello, brave new world!</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson5">
                    <article class="span12">
                        <header>
                            <h2>Lesson 5</h2>
                            <h4>External include files</h4>
                        </header>

                        <p>External include files allow us to move code from our program and put it into separate files. This technique is useful for writing clean, easy to maintain programs. Reusable bits of code can be written as subroutines and stored in separate files called libraries. When you need a piece of logic you can include the file in your program and use it as if they are part of the same file.</p>

                        <p>In this lesson we will move our string length calculating subroutine into an external file.  We fill also make our string printing logic and program exit logic a subroutine and we will move them into this external file.  Once it's completed our actual program will be clean and easier to read.</p>

                        <p>We can then declare another message variable and call our print function twice in order to demonstrate how we can reuse code.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            I won't be showing the code in functions.asm after this lesson unless it changes. It will just be included if needed.
                        </p>

                        <div class="snippet">
                            <span class="filename">functions.asm</span>
                            <div><div id="highlighter_923295" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number2 index1 alt1"><code class="asm comments">; int slen(String message)</code></div><div class="line number3 index2 alt2"><code class="asm comments">; String length calculation function</code></div><div class="line number4 index3 alt1"><code class="asm plain">slen:</code></div><div class="line number5 index4 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number6 index5 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm plain">nextchar:</code></div><div class="line number9 index8 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">[</code><code class="asm color1 bold">eax</code><code class="asm plain">], 0</code></div><div class="line number10 index9 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">finished</code></div><div class="line number11 index10 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number12 index11 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextchar</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">finished:</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm comments">;------------------------------------------</code></div><div class="line number21 index20 alt2"><code class="asm comments">; void sprint(String message)</code></div><div class="line number22 index21 alt1"><code class="asm comments">; String printing function</code></div><div class="line number23 index22 alt2"><code class="asm plain">sprint:</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">slen</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1"><code class="asm comments">;------------------------------------------</code></div><div class="line number45 index44 alt2"><code class="asm comments">; void exit()</code></div><div class="line number46 index45 alt1"><code class="asm comments">; Exit program and restore resources</code></div><div class="line number47 index46 alt2"><code class="asm plain">quit:</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0</code></div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1</code></div><div class="line number50 index49 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number51 index50 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <div class="snippet">
                            <span class="filename">helloworld-inc.asm</span>
                            <div><div id="highlighter_22602" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (External file include)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-inc.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-inc.o -o helloworld-inc</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-inc</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; include our external file</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg1&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello, brave new world!'</code><code class="asm plain">, 0Ah&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; our first message string</code></div><div class="line number10 index9 alt1"><code class="asm plain">msg2&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'This is how we recycle in NASM.'</code><code class="asm plain">, 0Ah&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; our second message string</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of our first message string into EAX</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of our second message string into EAX</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-inc.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-inc.o -o helloworld-inc</span>
                                    <span>~$ ./helloworld-inc</span>
                                    <span>Hello, brave new world!</span>
                                    <span>This is how we recycle in NASM.</span>
                                    <span>This is how we recycle in NASM.</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-important">Error:</span>
                            Our second message is outputted twice.  This is fixed in the next lesson.
                        </p>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson6">
                    <article class="span12">
                        <header>
                            <h2>Lesson 6</h2>
                            <h4>NULL terminating bytes</h4>
                        </header>

                        <p>Ok so why did our second message print twice when we only called our sprint function on msg2 once?  Well actually it did only print once.  You can see what I mean if you comment out our second call to sprint.  The output will be both of our message strings.</p>

                        <p>But how is this possible?</p>

                        <p>What is happening is we weren't properly terminating our strings.  In assembly, variables are stored one after another in memory so the last byte of our msg1 variable is right next to the first byte of our msg2 variable.  We know our string length calculation is looking for a zero byte so unless our msg2 variable starts with a zero byte it keeps counting as if it's the same string (and as far as assembly is concerned it is the same string).  So we need to put a zero byte or 0h after our strings to let assembly know where to stop counting.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            In programming 0h denotes a null byte and a null byte after a string tells assembly where it ends in memory.
                        </p>

                        <div class="snippet">
                            <span class="filename">helloworld-inc.asm</span>
                            <div><div id="highlighter_292681" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (NULL terminating bytes)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-inc.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-inc.o -o helloworld-inc</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-inc</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg1&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello, brave new world!'</code><code class="asm plain">, 0Ah, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; NOTE the null terminating byte</code></div><div class="line number10 index9 alt1"><code class="asm plain">msg2&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'This is how we recycle in NASM.'</code><code class="asm plain">, 0Ah, 0h </code> <code class="asm comments">; NOTE the null terminating byte</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg2</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-inc.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-inc.o -o helloworld-inc</span>
                                    <span>~$ ./helloworld-inc</span>
                                    <span>Hello, brave new world!</span>
                                    <span>This is how we recycle in NASM.</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson7">
                    <article class="span12">
                        <header>
                            <h2>Lesson 7</h2>
                            <h4>Linefeeds</h4>
                        </header>

                        <p>Linefeeds are essential to console programs like our 'hello world' program.  They become even more important once we start building programs that require user input. But linefeeds can be a pain to maintain.  Sometimes you will want to include them in your strings and sometimes you will want to remove them.  If we continue to hard code them in our variables by adding 0Ah after our declared message text, it will become a problem.  If there's a place in the code that we don't want to print out the linefeed for that variable we will need to write some extra logic remove it from the string at runtime.</p>

                        <p>It would be better for the maintainability of our program if we write a subroutine that will print out our message and then print a linefeed afterwards. That way we can just call this subroutine when we need the linefeed and call our current sprint subroutine when we don't.</p>

                        <p>A call to <span class="function-name">sys_write</span> requires we pass a pointer to an address in memory of the string we want to print so we can't just pass a linefeed character (0Ah) to our print function.  We also don't want to create another variable just to hold a linefeed character so we will instead use the stack.</p>

                        <p>The way it works is by moving a linefeed character into <span class="register-name">EAX.</span>  We then <span class="instruction-name">push</span> <span class="register-name">EAX</span> onto the stack and get the address pointed to by the Extended Stack Pointer.  <span class="register-name">ESP</span> is another register.  When you <span class="instruction-name">push</span> items onto the stack, <span class="register-name">ESP</span> is decremented to point to the address in memory of the last item and so it can be used to access that item directly from the stack. Since <span class="register-name">ESP</span> points to an address in memory of a character, <span class="function-name">sys_write</span> will be able to use it to print.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            I've highlighted the new code in functions.asm below.
                        </p>

                        <div class="snippet">
                            <span class="filename">functions.asm</span>
                            <div><div id="highlighter_785941" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1 highlighted">44</div><div class="line number45 index44 alt2 highlighted">45</div><div class="line number46 index45 alt1 highlighted">46</div><div class="line number47 index46 alt2 highlighted">47</div><div class="line number48 index47 alt1 highlighted">48</div><div class="line number49 index48 alt2 highlighted">49</div><div class="line number50 index49 alt1 highlighted">50</div><div class="line number51 index50 alt2 highlighted">51</div><div class="line number52 index51 alt1 highlighted">52</div><div class="line number53 index52 alt2 highlighted">53</div><div class="line number54 index53 alt1 highlighted">54</div><div class="line number55 index54 alt2 highlighted">55</div><div class="line number56 index55 alt1 highlighted">56</div><div class="line number57 index56 alt2 highlighted">57</div><div class="line number58 index57 alt1 highlighted">58</div><div class="line number59 index58 alt2 highlighted">59</div><div class="line number60 index59 alt1 highlighted">60</div><div class="line number61 index60 alt2 highlighted">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number2 index1 alt1"><code class="asm comments">; int slen(String message)</code></div><div class="line number3 index2 alt2"><code class="asm comments">; String length calculation function</code></div><div class="line number4 index3 alt1"><code class="asm plain">slen:</code></div><div class="line number5 index4 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number6 index5 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm plain">nextchar:</code></div><div class="line number9 index8 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">[</code><code class="asm color1 bold">eax</code><code class="asm plain">], 0</code></div><div class="line number10 index9 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">finished</code></div><div class="line number11 index10 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number12 index11 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextchar</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">finished:</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm comments">;------------------------------------------</code></div><div class="line number21 index20 alt2"><code class="asm comments">; void sprint(String message)</code></div><div class="line number22 index21 alt1"><code class="asm comments">; String printing function</code></div><div class="line number23 index22 alt2"><code class="asm plain">sprint:</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">slen</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1 highlighted"><code class="asm comments">;------------------------------------------</code></div><div class="line number45 index44 alt2 highlighted"><code class="asm comments">; void sprintLF(String message)</code></div><div class="line number46 index45 alt1 highlighted"><code class="asm comments">; String printing with line feed function</code></div><div class="line number47 index46 alt2 highlighted"><code class="asm plain">sprintLF:</code></div><div class="line number48 index47 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number49 index48 alt2 highlighted">&nbsp;</div><div class="line number50 index49 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push eax onto the stack to preserve it while we use the eax register in this function</code></div><div class="line number51 index50 alt2 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0Ah&nbsp;&nbsp; </code> <code class="asm comments">; move 0Ah into eax - 0Ah is the ascii character for a linefeed</code></div><div class="line number52 index51 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; as eax is 4 bytes wide, it now contains 0000000Ah</code></div><div class="line number53 index52 alt2 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the linefeed onto the stack so we can get the address</code></div><div class="line number54 index53 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; given that we have a little-endian architecture, eax register bytes are stored in reverse order,</code></div><div class="line number55 index54 alt2 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; this corresponds to stack memory contents of 0Ah, 0h, 0h, 0h,</code></div><div class="line number56 index55 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; giving us a linefeed followed by a NULL terminating byte</code></div><div class="line number57 index56 alt2 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;  <code class="asm comments">; move the address of the current stack pointer into eax for sprint</code></div><div class="line number58 index57 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our sprint function</code></div><div class="line number59 index58 alt2 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; remove our linefeed character from the stack</code></div><div class="line number60 index59 alt1 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore the original value of eax before our function was called</code></div><div class="line number61 index60 alt2 highlighted"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; return to our program</code></div><div class="line number62 index61 alt1">&nbsp;</div><div class="line number63 index62 alt2">&nbsp;</div><div class="line number64 index63 alt1"><code class="asm comments">;------------------------------------------</code></div><div class="line number65 index64 alt2"><code class="asm comments">; void exit()</code></div><div class="line number66 index65 alt1"><code class="asm comments">; Exit program and restore resources</code></div><div class="line number67 index66 alt2"><code class="asm plain">quit:</code></div><div class="line number68 index67 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0</code></div><div class="line number69 index68 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1</code></div><div class="line number70 index69 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number71 index70 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <div class="snippet">
                            <span class="filename">helloworld-lf.asm</span>
                            <div><div id="highlighter_518512" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Print with line feed)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-lf.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-lf.o -o helloworld-lf</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-lf</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg1&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello, brave new world!'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; NOTE we have removed the line feed character 0Ah</code></div><div class="line number10 index9 alt1"><code class="asm plain">msg2&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'This is how we recycle in NASM.'</code><code class="asm plain">, 0h </code> <code class="asm comments">; NOTE we have removed the line feed character 0Ah</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp; </code> <code class="asm comments">; NOTE we are calling our new print with linefeed function</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg2</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp; </code> <code class="asm comments">; NOTE we are calling our new print with linefeed function</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-lf.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-lf.o -o helloworld-lf</span>
                                    <span>~$ ./helloworld-lf</span>
                                    <span>Hello, brave new world!</span>
                                    <span>This is how we recycle in NASM.</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson8">
                    <article class="span12">
                        <header>
                            <h2>Lesson 8</h2>
                            <h4>Passing arguments</h4>
                        </header>

                        <p>Passing arguments to your program from the command line is as easy as popping them off the stack in NASM. When we run our program, any passed arguments are loaded onto the stack in reverse order.  The name of the program is then loaded onto the stack and lastly the total number of arguments is loaded onto the stack. The last two stack items for a NASM compiled program are always the name of the program and the number of passed arguments.</p>

                        <p>So all we have to do to use them is <span class="instruction-name">pop</span> the number of arguments off the stack first, then iterate once for each argument and perform our logic. In our program that means calling our print function.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            We are using the <span class="register-name">ECX</span> register as our counter for the loop. Although it's a general-purpose register it's original intention was to be used as a counter.
                        </p>

                        <div class="snippet">
                            <span class="filename">helloworld-args.asm</span>
                            <div><div id="highlighter_434475" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Passing arguments from the command line)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-args.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-args.o -o helloworld-args</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-args</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; first value on the stack is the number of arguments</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">nextArg:</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; check to see if we have any arguments left</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">noMoreArgs&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if zero flag is set jump to noMoreArgs label (jumping over the end of the loop)</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; pop the next argument off the stack</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our print with linefeed function</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">dec</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; decrease ecx (number of arguments left) by 1</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextArg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump to nextArg label</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm plain">noMoreArgs:</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-args.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-args.o -o helloworld-args</span>
                                    <span>~$ ./helloworld-args "This is one argument" "This is another" 101</span>
                                    <span>./helloworld-args</span>
                                    <span>This is one argument</span>
                                    <span>This is another</span>
                                    <span>101</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson9">
                    <article class="span12">
                        <header>
                            <h2>Lesson 9</h2>
                            <h4>User input</h4>
                        </header>

                        <h5>Introduction to the .bss section</h5>

                        <p>So far we've used the .text and .data section so now it's time to introduce the .bss section. BSS stands for <span class="register-name">Block</span> Started by Symbol.  It is an area in our program that is used to reserve space in memory for uninitialised variables. We will use it to reserve some space in memory to hold our user input since we don't know how many bytes we'll need to store.</p>

                        <p>The syntax to declare variables is as follows:</p>

                        <div class="snippet">
                            <span class="filename">.bss section example</span>
                            <div><div id="highlighter_120432" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number2 index1 alt1"><code class="asm plain">variableName1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">RESB</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserve space for 1 byte</code></div><div class="line number3 index2 alt2"><code class="asm plain">variableName2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">RESW</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserve space for 1 word</code></div><div class="line number4 index3 alt1"><code class="asm plain">variableName3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">RESD</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserve space for 1 double word</code></div><div class="line number5 index4 alt2"><code class="asm plain">variableName4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">RESQ</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserve space for 1 double precision float (quad word)</code></div><div class="line number6 index5 alt1"><code class="asm plain">variableName5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">REST</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserve space for 1 extended precision float</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <h5>Writing our program</h5>

                        <p>We will be using the system call <span class="function-name">sys_read</span> to receive and process input from the user. This function is assigned OPCODE 3 in the Linux System Call Table. Just like <span class="function-name">sys_write</span> this function also takes 3 arguments which will be loaded into <span class="register-name">EDX,</span> <span class="register-name">ECX</span> and <span class="register-name">EBX</span> before requesting a software interrupt that will call the function.</p>

                        <p>The arguments passed are as follows:
                            </p><ul>
                                <li> <span class="register-name">EDX</span> will be loaded with the maximum length (in bytes) of the space in memory.</li>
                                <li> <span class="register-name">ECX</span> will be loaded with the address of our variable created in the .bss section.</li>
                                <li> <span class="register-name">EBX</span> will be loaded with the file we want to read from – in this case STDIN.</li>
                            </ul>
                            As always the datatype and meaning of the arguments passed can be found in the function's definition.
                        <p></p>

                        <p>When <span class="function-name">sys_read</span> detects a linefeed, control returns to the program and the users input is located at the memory address you passed in <span class="register-name">ECX.</span></p>

                        <div class="snippet">
                            <span class="filename">helloworld-input.asm</span>
                            <div><div id="highlighter_210244" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Getting input)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-input.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-input.o -o helloworld-input</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-input</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Please enter your name: '</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; message string asking user for input</code></div><div class="line number10 index9 alt1"><code class="asm plain">msg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello, '</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; message string to use after user has entered their name</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number13 index12 alt2"><code class="asm plain">sinput:&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">resb</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">255&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserve a 255 byte space in memory for the users input string</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number16 index15 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_start:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 255&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to read</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, sinput&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; reserved space to store our input (known as a buffer)</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; read from the STDIN file</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_READ (kernel opcode 3)</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg2</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, sinput&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our buffer into eax (Note: input contains a linefeed)</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our print function</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-input.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-input.o -o helloworld-input</span>
                                    <span>~$ ./helloworld-input</span>
                                    <span>Please enter your name: Daniel Givney</span>
                                    <span>Hello, Daniel Givney</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson10">
                    <article class="span12">
                        <header>
                            <h2>Lesson 10</h2>
                            <h4>Count to 10</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>Counting by numbers is not as straight forward as you would think in assembly.  Firstly we need to pass <span class="function-name">sys_write</span> an address in memory so we can't just load our register with a number and call our print function.  Secondly, numbers and strings are very different things in assembly.  Strings are represented by what are called ASCII values.  ASCII stands for <strong>American Standard Code for Information Interchange</strong>.  A good reference for ASCII <a href="http://www.asciitable.com/">can be found here</a>. ASCII was created as a way to standardise the representation of strings across all computers.</p>

                        <p>Remember, we can't print a number - we have to print a string. In order to count to 10 we will need to convert our numbers from standard integers to their ASCII string representations.  Have a look at the ASCII values table and notice that the string representation for the number '1' is actually '49' in ASCII. In fact, adding 48 to our numbers is all we have to do to convert them from integers to their ASCII string representations.</p>

                        <h5>Writing our program</h5>

                        <p>What we will do with our program is count from 1 to 10 using the <span class="register-name">ECX</span> register.  We will then <span class="instruction-name">add</span> 48 to our counter to convert it from a number to it's ASCII string representation.  We will then <span class="instruction-name">push</span> this value to the stack and call our print function passing <span class="register-name">ESP</span> as the memory address to print from.  Once we have finished counting to 10 we will exit our counting loop and call our quit function.</p>

                        <div class="snippet">
                            <span class="filename">helloworld-10.asm</span>
                            <div><div id="highlighter_465982" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Count to 10)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-10.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-10.o -o helloworld-10</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-10</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; ecx is initalised to zero.</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">nextNumber:</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; increment ecx</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the address of our integer into eax</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">add</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; add 48 to our number to convert from integer to ascii for printing</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push eax to the stack</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; get the address of the character on the stack</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our print function</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; clean up the stack so we don't have unneeded bytes taking up space</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; have we reached 10 yet? compare our counter with decimal 10</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jne</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextNumber&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump if not equal and keep counting</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-10.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-10.o -o helloworld-10</span>
                                    <span>~$ ./helloworld-10</span>
                                    <span>1</span>
                                    <span>2</span>
                                    <span>3</span>
                                    <span>4</span>
                                    <span>5</span>
                                    <span>6</span>
                                    <span>7</span>
                                    <span>8</span>
                                    <span>9</span>
                                    <span>:</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-important">Error:</span>
                            Our number 10 prints a colon (:) character instead.  What's going on?
                        </p>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson11">
                    <article class="span12">
                        <header>
                            <h2>Lesson 11</h2>
                            <h4>Count to 10 (itoa)</h4>
                        </header>

                        <p>So why did our program in Lesson 10 print out a colon character instead of the number 10?.  Well lets have a look at our ASCII table.  We can see that the colon character has a ASCII value of 58.  We were adding 48 to our integers to convert them to their ASCII string representations so instead of passing <span class="function-name">sys_write</span> the value '58' to print ten we actually need to pass the ASCII value for the number 1 followed by the ASCII value for the number 0. Passing <span class="function-name">sys_write</span> '4948' is the correct string representation for the number '10'. So we can't just simply <span class="instruction-name">add</span> 48 to our numbers to convert them, we first have to divide them by 10 because each place value needs to be converted individually.</p>

                        <p>We will write 2 new subroutines in this lesson 'iprint' and 'iprintLF'.  These functions will be used when we want to print ASCII string representations of numbers.  We achieve this by passing the number in <span class="register-name">EAX.</span>  We then initialise a counter in <span class="register-name">ECX.</span>  We will repeatedly divide the number by 10 and each time convert the remainder to a string by adding 48.  We will then <span class="instruction-name">push</span> this onto the stack for later use. Once we can no longer divide the number by 10 we will enter our second loop.  In this print loop we will print the now converted string representations from the stack and <span class="instruction-name">pop</span> them off.  Popping them off the stack moves <span class="register-name">ESP</span> forward to the next item on the stack. Each time we print a value we will decrease our counter <span class="register-name">ECX.</span>  Once all numbers have been converted and printed we will return to our program.</p>

                        <h5>How does the divide instruction work?</h5>

                        <p>The <span class="instruction-name">DIV</span> and IDIV instructions work by dividing whatever is in <span class="register-name">EAX</span> by the value passed to the instruction.  The quotient part of the value is left in <span class="register-name">EAX</span> and the remainder part is put into <span class="register-name">EDX</span> (Originally called the data register).

                        </p><p>For example.</p>

                        <div class="snippet">
                            <span class="filename">IDIV instruction example</span>
                            <div><div id="highlighter_365151" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move 10 into eax</code></div><div class="line number2 index1 alt1"><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move 10 into esi</code></div><div class="line number3 index2 alt2"><code class="asm functions bold">idiv</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by esi (eax will equal 1 and edx will equal 0)</code></div><div class="line number4 index3 alt1"><code class="asm functions bold">idiv</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by esi again (eax will equal 0 and edx will equal 1)</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <h5>If we are only storing the remainder won't we have problems?</h5>

                        <p>No, because these are integers, when you divide a number by an even bigger number the quotient in <span class="register-name">EAX</span> is 0 and the remainder is the number itself. This is because the number divides zero times leaving the original value as the remainder in <span class="register-name">EDX.</span> How good is that?</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Only the new functions iprint and iprintLF have comments.
                        </p>

                        <div class="snippet">
                            <span class="filename">functions.asm</span>
                            <div><div id="highlighter_33285" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div><div class="line number108 index107 alt1">108</div><div class="line number109 index108 alt2">109</div><div class="line number110 index109 alt1">110</div><div class="line number111 index110 alt2">111</div><div class="line number112 index111 alt1">112</div><div class="line number113 index112 alt2">113</div><div class="line number114 index113 alt1">114</div><div class="line number115 index114 alt2">115</div><div class="line number116 index115 alt1">116</div><div class="line number117 index116 alt2">117</div><div class="line number118 index117 alt1">118</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number2 index1 alt1"><code class="asm comments">; void iprint(Integer number)</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Integer printing function (itoa)</code></div><div class="line number4 index3 alt1"><code class="asm plain">iprint:</code></div><div class="line number5 index4 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve eax on the stack to be restored after function runs</code></div><div class="line number6 index5 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve ecx on the stack to be restored after function runs</code></div><div class="line number7 index6 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve edx on the stack to be restored after function runs</code></div><div class="line number8 index7 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve esi on the stack to be restored after function runs</code></div><div class="line number9 index8 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; counter of how many bytes we need to print in the end</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">divideLoop:</code></div><div class="line number12 index11 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; count each byte to print - number of characters</code></div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; empty edx</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; mov 10 into esi</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">idiv</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by esi</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">add</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; convert edx to it's ascii representation - edx holds the remainder after a divide instruction</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push edx (string representation of an intger) onto the stack</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; can the integer be divided anymore?</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jnz</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">divideLoop&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump if not zero to the label divideLoop</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="asm plain">printLoop:</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">dec</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; count down each byte that we put on the stack</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; mov the stack pointer into eax for printing</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string print function</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; remove last character from the stack to move esp forward</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; have we printed all bytes we pushed onto the stack?</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jnz</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">printLoop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump is not zero to the label printLoop</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore esi from the value we pushed onto the stack at the start</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore edx from the value we pushed onto the stack at the start</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore ecx from the value we pushed onto the stack at the start</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore eax from the value we pushed onto the stack at the start</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="asm comments">;------------------------------------------</code></div><div class="line number37 index36 alt2"><code class="asm comments">; void iprintLF(Integer number)</code></div><div class="line number38 index37 alt1"><code class="asm comments">; Integer printing function with linefeed (itoa)</code></div><div class="line number39 index38 alt2"><code class="asm plain">iprintLF:</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push eax onto the stack to preserve it while we use the eax register in this function</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0Ah&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move 0Ah into eax - 0Ah is the ascii character for a linefeed</code></div><div class="line number44 index43 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the linefeed onto the stack so we can get the address</code></div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the address of the current stack pointer into eax for sprint</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our sprint function</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; remove our linefeed character from the stack</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore the original value of eax before our function was called</code></div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1"><code class="asm comments">;------------------------------------------</code></div><div class="line number53 index52 alt2"><code class="asm comments">; int slen(String message)</code></div><div class="line number54 index53 alt1"><code class="asm comments">; String length calculation function</code></div><div class="line number55 index54 alt2"><code class="asm plain">slen:</code></div><div class="line number56 index55 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number57 index56 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="asm plain">nextchar:</code></div><div class="line number60 index59 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">[</code><code class="asm color1 bold">eax</code><code class="asm plain">], 0</code></div><div class="line number61 index60 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">finished</code></div><div class="line number62 index61 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number63 index62 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextchar</code></div><div class="line number64 index63 alt1">&nbsp;</div><div class="line number65 index64 alt2"><code class="asm plain">finished:</code></div><div class="line number66 index65 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number67 index66 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number68 index67 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number69 index68 alt2">&nbsp;</div><div class="line number70 index69 alt1">&nbsp;</div><div class="line number71 index70 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number72 index71 alt1"><code class="asm comments">; void sprint(String message)</code></div><div class="line number73 index72 alt2"><code class="asm comments">; String printing function</code></div><div class="line number74 index73 alt1"><code class="asm plain">sprint:</code></div><div class="line number75 index74 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code></div><div class="line number76 index75 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number77 index76 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number78 index77 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number79 index78 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">slen</code></div><div class="line number80 index79 alt1">&nbsp;</div><div class="line number81 index80 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number82 index81 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number83 index82 alt2">&nbsp;</div><div class="line number84 index83 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number85 index84 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number86 index85 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number87 index86 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number88 index87 alt1">&nbsp;</div><div class="line number89 index88 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code></div><div class="line number90 index89 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number91 index90 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code></div><div class="line number92 index91 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number93 index92 alt2">&nbsp;</div><div class="line number94 index93 alt1">&nbsp;</div><div class="line number95 index94 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number96 index95 alt1"><code class="asm comments">; void sprintLF(String message)</code></div><div class="line number97 index96 alt2"><code class="asm comments">; String printing with line feed function</code></div><div class="line number98 index97 alt1"><code class="asm plain">sprintLF:</code></div><div class="line number99 index98 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number100 index99 alt1">&nbsp;</div><div class="line number101 index100 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number102 index101 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0AH</code></div><div class="line number103 index102 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number104 index103 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number105 index104 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint</code></div><div class="line number106 index105 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number107 index106 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code></div><div class="line number108 index107 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div><div class="line number109 index108 alt2">&nbsp;</div><div class="line number110 index109 alt1">&nbsp;</div><div class="line number111 index110 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number112 index111 alt1"><code class="asm comments">; void exit()</code></div><div class="line number113 index112 alt2"><code class="asm comments">; Exit program and restore resources</code></div><div class="line number114 index113 alt1"><code class="asm plain">quit:</code></div><div class="line number115 index114 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 0</code></div><div class="line number116 index115 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1</code></div><div class="line number117 index116 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number118 index117 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <div class="snippet">
                            <span class="filename">helloworld-itoa.asm</span>
                            <div><div id="highlighter_83658" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Hello World Program (Count to 10 itoa)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf helloworld-itoa.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-itoa.o -o helloworld-itoa</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./helloworld-itoa</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">nextNumber:</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ecx</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; NOTE call our new integer printing function (itoa)</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 10</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jne</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextNumber</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf helloworld-itoa.asm</span>
                                    <span>~$ ld -m elf_i386 helloworld-itoa.o -o helloworld-itoa</span>
                                    <span>~$ ./helloworld-itoa</span>
                                    <span>1</span>
                                    <span>2</span>
                                    <span>3</span>
                                    <span>4</span>
                                    <span>5</span>
                                    <span>6</span>
                                    <span>7</span>
                                    <span>8</span>
                                    <span>9</span>
                                    <span>10</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson12">
                    <article class="span12">
                        <header>
                            <h2>Lesson 12</h2>
                            <h4>Calculator - addition</h4>
                        </header>

                        <p>In this program we will be adding the registers <span class="register-name">EAX</span> and <span class="register-name">EBX</span> together and we'll leave our answer in <span class="register-name">EAX.</span> Firstly we use the <span class="instruction-name">MOV</span> instruction to load <span class="register-name">EAX</span> with an integer (in this case 90).  We then <span class="instruction-name">MOV</span> an integer into <span class="register-name">EBX</span> (in this case 9).  Now all we need to do is use the <span class="instruction-name">ADD</span> instruction to perform our addition. <span class="register-name">EBX</span> &amp; <span class="register-name">EAX</span> will be added together leaving our answer in the left most register in this instruction (in our case <span class="register-name">EAX).</span> Then all we need to do is call our integer printing function to complete the program.</p>

                        <div class="snippet">
                            <span class="filename">calculator-addition.asm</span>
                            <div><div id="highlighter_454138" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Calculator (Addition)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf calculator-addition.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-addition.o -o calculator-addition</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./calculator-addition</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 90&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our first number into eax</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 9&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our second number into ebx</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">add</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;  <code class="asm comments">; add ebx to eax</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp; </code> <code class="asm comments">; call our integer print with linefeed function</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf calculator-addition.asm</span>
                                    <span>~$ ld -m elf_i386 calculator-addition.o -o calculator-addition</span>
                                    <span>~$ ./calculator-addition</span>
                                    <span>99</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson13">
                    <article class="span12">
                        <header>
                            <h2>Lesson 13</h2>
                            <h4>Calculator - subtraction</h4>
                        </header>
                        <p>In this program we will be subtracting the value in the register <span class="register-name">EBX</span> from the value in the register <span class="register-name">EAX.</span>  Firstly we load <span class="register-name">EAX</span> and <span class="register-name">EBX</span> with integers in the same way as Lesson 12.  The only difference is we will be using the <span class="instruction-name">SUB</span> instruction to perform our subtraction logic, leaving our answer in the left most register of this instruction (in our case <span class="register-name">EAX).</span> Then all we need to do is call our integer printing function to complete the program.</p>
                        <div class="snippet">
                            <span class="filename">calculator-subtraction.asm</span>
                            <div><div id="highlighter_62710" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Calculator (Subtraction)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf calculator-subtraction.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-subtraction.o -o calculator-subtraction</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./calculator-subtraction</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 90&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our first number into eax</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 9&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our second number into ebx</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;  <code class="asm comments">; subtract ebx from eax</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp; </code> <code class="asm comments">; call our integer print with linefeed function</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf calculator-subtraction.asm</span>
                                    <span>~$ ld -m elf_i386 calculator-subtraction.o -o calculator-subtraction</span>
                                    <span>~$ ./calculator-subtraction</span>
                                    <span>81</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson14">
                    <article class="span12">
                        <header>
                            <h2>Lesson 14</h2>
                            <h4>Calculator - multiplication</h4>
                        </header>

                        <p>In this program we will be multiplying the value in <span class="register-name">EBX</span> by the value present in <span class="register-name">EAX.</span>  Firstly we load <span class="register-name">EAX</span> and <span class="register-name">EBX</span> with integers in the same way as Lesson 12.  This time though we will be calling the <span class="instruction-name">MUL</span> instruction to perform our multiplication logic.  The <span class="instruction-name">MUL</span> instruction is different from many instructions in NASM, in that it only accepts one further argument.  The <span class="instruction-name">MUL</span> instruction always multiples <span class="register-name">EAX</span> by whatever value is passed after it.  The answer is left in <span class="register-name">EAX.</span></p>

                        <div class="snippet">
                            <span class="filename">calculator-multiplication.asm</span>
                            <div><div id="highlighter_569691" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Calculator (Multiplication)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf calculator-multiplication.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-multiplication.o -o calculator-multiplication</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./calculator-multiplication</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 90&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our first number into eax</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 9&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our second number into ebx</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mul</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; multiply eax by ebx</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp; </code> <code class="asm comments">; call our integer print with linefeed function</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf calculator-multiplication.asm</span>
                                    <span>~$ ld -m elf_i386 calculator-multiplication.o -o calculator-multiplication</span>
                                    <span>~$ ./calculator-multiplication</span>
                                    <span>810</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson15">
                    <article class="span12">
                        <header>
                            <h2>Lesson 15</h2>
                            <h4>Calculator - division</h4>
                        </header>

                        <p>In this program we will be dividing the value in <span class="register-name">EBX</span> by the value present in <span class="register-name">EAX.</span>  We've used division before in our integer print subroutine. Our program requires a few extra strings in order to print out the correct answer but otherwise there's nothing complicated going on.</p>

                        <p>Firstly we load <span class="register-name">EAX</span> and <span class="register-name">EBX</span> with integers in the same way as Lesson 12.  Division logic is performed using the <span class="instruction-name">DIV</span> instruction.  The <span class="instruction-name">DIV</span> instruction always divides <span class="register-name">EAX</span> by the value passed after it.  It will leave the quotient part of the answer in <span class="register-name">EAX</span> and put the remainder part in <span class="register-name">EDX</span> (the original data register).  We then <span class="instruction-name">MOV</span> and call our strings and integers to print out the correct answer.</p>

                        <div class="snippet">
                            <span class="filename">calculator-division.asm</span>
                            <div><div id="highlighter_833446" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Calculator (Division)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf calculator-division.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-division.o -o calculator-division</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./calculator-division</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">' remainder '</code>&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; a message string to correctly output result</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number12 index11 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">_start:</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 90&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our first number into eax</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 9&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our second number into ebx</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">div</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by ebx</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprint&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer print function on the quotient</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1&nbsp; </code> <code class="asm comments">; move our message string into eax</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string print function</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">edx</code>&nbsp;&nbsp;  <code class="asm comments">; move our remainder into eax</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing with linefeed function</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf calculator-division.asm</span>
                                    <span>~$ ld -m elf_i386 calculator-division.o -o calculator-division</span>
                                    <span>~$ ./calculator-division</span>
                                    <span>10 remainder 0</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson16">
                    <article class="span12">
                        <header>
                            <h2>Lesson 16</h2>
                            <h4>Calculator (atoi)</h4>
                        </header>

                        <p>Our program will take several command line arguments and <span class="instruction-name">add</span> them together printing out the result in the terminal.</p>

                        <h5>Writing our program</h5>

                        <p>Our program begins by using the <span class="instruction-name">POP</span> instruction to get the number of passed arguments off the stack.  This value is stored in <span class="register-name">ECX</span> (originally known as the counter register).  It will then <span class="instruction-name">POP</span> the next value off the stack containing the program name and remove it from the number of arguments stored in <span class="register-name">ECX.</span>  It will then loop through the rest of the arguments popping each one off the stack and performing our addition logic. As we know, arguments passed via the command line are received by our program as strings.  Before we can <span class="instruction-name">add</span> the arguments together we will need to convert them to integers otherwise our result will not be correct. We do this by calling our Ascii to Integer function (atoi).  This function will convert the ascii value into an integer and place the result in <span class="register-name">EAX.</span>  We can then <span class="instruction-name">add</span> this value to <span class="register-name">EDX</span> (originally known as the data register) where we will store the result of our additions. If the value passed to atoi is not an ascii representation of an integer our function will return zero instead. When all arguments have been converted and added together we will print out the result and call our quit function.</p>

                        <h5>How does the atoi function work</h5>

                        <p>Converting an ascii string into an integer value is not a trivial task.  We know how to convert an integer to an ascii string so the process should essentially work in reverse.  Firstly we take the address of the string and move it into <span class="register-name">ESI</span> (originally known as the source register). We will then move along the string byte by byte (think of each byte as being a single digit or decimal placeholder).  For each digit we will check if it's value is between 48-57 (ascii values for the digits 0-9).</p>

                        <p>Once we have performed this check and determined that the byte can be converted to an integer we will perform the following logic.  We will subtract 48 from the value – converting the ascii value to it's decimal equivalent. We will then <span class="instruction-name">add</span> this value to <span class="register-name">EAX</span> (the general purpose register that will store our result). We will then multiple <span class="register-name">EAX</span> by 10 as each byte represents a decimal placeholder and continue the loop.</p>

                        <p>When all bytes have been converted we need to do one last thing before we return the result.  The last digit of any number represents a single unit (not a multiple of 10) so we have multiplied our result one too many times.  We simple divide it by 10 once to correct this and then return. If no integer arguments were pass however, we skip this divide instruction.</p>

                        <h5>What is the BL register</h5>

                        <p>You may have noticed that the atoi function references the <span class="register-name">BL</span> register.  So far in these tutorials we have been exclusively using 32bit registers.   These 32bit general purpose registers contain segments of memory that can also be referenced. These segments are available in 16bits and 8bits.  We wanted a single byte (8bits) because a byte is the size of memory that is required to store a single ascii character.  If we used a larger memory size we would have copied 8bits of data into 32bits of space leaving us with 'rubbish' bits - because only the first 8bits would be meaningful for our calculation.</p>

                        <p>The <span class="register-name">EBX</span> register is 32bits.  <span class="register-name">EBX's</span> 16 bit segment is referenced as <span class="register-name">BX.</span>  <span class="register-name">BX</span> contains the 8bit segments <span class="register-name">BL</span> and <span class="register-name">BH</span> (Lower and Higher bits).  We wanted the first 8bits (lower bits) of <span class="register-name">EBX</span> and so we referenced that storage area using <span class="register-name">BL.</span></p>

                        <p>Almost every assembly language tutorial begins with a history of the registers, their names and their sizes.  These tutorials however were written to provide a foundation in NASM by first writing code and then understanding the theory. The full story about the size of registers, their history and importance are beyond the scope of this tutorial but we will return to that story in later tutorials.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Only the new function in this file 'atoi' is shown below.
                        </p>

                        <div class="snippet">
                            <span class="filename">functions.asm</span>
                            <div><div id="highlighter_933608" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">;------------------------------------------</code></div><div class="line number2 index1 alt1"><code class="asm comments">; int atoi(Integer number)</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Ascii to integer function (atoi)</code></div><div class="line number4 index3 alt1"><code class="asm plain">atoi:</code></div><div class="line number5 index4 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve ebx on the stack to be restored after function runs</code></div><div class="line number6 index5 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve ecx on the stack to be restored after function runs</code></div><div class="line number7 index6 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve edx on the stack to be restored after function runs</code></div><div class="line number8 index7 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; preserve esi on the stack to be restored after function runs</code></div><div class="line number9 index8 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move pointer in eax into esi (our number to convert)</code></div><div class="line number10 index9 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; initialise eax with decimal value 0</code></div><div class="line number11 index10 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; initialise ecx with decimal value 0</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm plain">.multiplyLoop:</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; resets both lower and uppper bytes of ebx to be 0</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">bl</code><code class="asm plain">, [</code><code class="asm color1 bold">esi</code><code class="asm plain">+</code><code class="asm color1 bold">ecx</code><code class="asm plain">]&nbsp; </code> <code class="asm comments">; move a single byte into ebx register's lower half</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">bl</code><code class="asm plain">, 48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; compare ebx register's lower half value against ascii value 48 (char value 0)</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jl</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump if less than to label finished</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">bl</code><code class="asm plain">, 57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; compare ebx register's lower half value against ascii value 57 (char value 9)</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jg</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump if greater than to label finished</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">bl</code><code class="asm plain">, 48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; convert ebx register's lower half to decimal representation of ascii value</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">add</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; add ebx to our integer value in eax</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move decimal value 10 into ebx</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mul</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; multiply eax by ebx to get place value</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; increment ecx (our counter register)</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.multiplyLoop&nbsp; </code> <code class="asm comments">; continue multiply loop</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm plain">.finished:</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; compare ecx register's value against decimal 0 (our counter register)</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">je</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.restore&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump if equal to 0 (no integer arguments were passed to atoi)</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move decimal value 10 into ebx</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">div</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by value in ebx (in this case 10)</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="asm plain">.restore:</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore esi from the value we pushed onto the stack at the start</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore edx from the value we pushed onto the stack at the start</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore ecx from the value we pushed onto the stack at the start</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; restore ebx from the value we pushed onto the stack at the start</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">ret</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <div class="snippet">
                            <span class="filename">calculator-atoi.asm</span>
                            <div><div id="highlighter_265405" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Calculator (ATOI)</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf calculator-atoi.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-atoi.o -o calculator-atoi</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./calculator-atoi 20 1000 317</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; first value on the stack is the number of arguments</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; second value on the stack is the program name (discarded when we initialise edx)</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">sub</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; decrease ecx by 1 (number of arguments without program name)</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; initialise our data register to store additions</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">nextArg:</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; check to see if we have any arguments left</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">noMoreArgs&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if zero flag is set jump to noMoreArgs label (jumping over the end of the loop)</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; pop the next argument off the stack</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">atoi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; convert our ascii string to decimal integer</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">add</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; perform our addition logic</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">dec</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; decrease ecx (number of arguments left) by 1</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextArg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump to nextArg label</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="asm plain">noMoreArgs:</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move our data result into eax for printing</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing with linefeed function</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf calculator-atoi.asm</span>
                                    <span>~$ ld -m elf_i386 calculator-atoi.o -o calculator-atoi</span>
                                    <span>~$ ./calculator-atoi 20 1000 317</span>
                                    <span>1337</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson17">
                    <article class="span12">
                        <header>
                            <h2>Lesson 17</h2>
                            <h4>Namespace</h4>
                        </header>

                        <p>Namespace is a necessary construct in any software project that involves a codebase that is larger than a few simple functions.  Namespace provides scope to your identifiers and allows you to reuse naming conventions to make your code more readable and maintainable.  In assembly language where subroutines are identified by global labels, namespace can be achieved by using local labels.</p>

                        <p>Up until the last few tutorials we have been using global labels exclusively.  This means that <span class="register-name">blocks</span> of logic that essentially perform the same task needed a label with a unique identifier.  A good example would be our "finished" labels.  These were global in scope meaning when we needed to break out of a loop in one function we could jump to a "finished" label.  But if we needed to break out of a loop in a different function we would need to name this same task something else maybe calling it "done" or "continue". Being able to reuse the label "finished" would mean that someone reading the code would know that these <span class="register-name">blocks</span> of logic perform almost the same task.</p>

                        <p>Local labels are prepended with a "." at the beginning of their name for example ".finished". You may have noticed them appearing as our code base in functions.asm grew.  A local label is given the namespace of the first global label above it. You can jump to a local label by using the <span class="instruction-name">JMP</span> instruction and the compiler will calculate which local label you are referencing by determining in what scope (based on the above global labels) the instruction was called.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            The file <a href="https://github.com/DGivney/assemblytutorials/blob/master/code/lesson17/functions.asm" target="_blank">functions.asm</a> was modified adding namespaces in all the subroutines. This is particularly important in the "slen" subroutine which contains a "finished" global label.
                        </p>

                        <div class="snippet">
                            <span class="filename">namespace.asm</span>
                            <div><div id="highlighter_623158" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Namespace</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf namespace.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 namespace.o -o namespace</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./namespace</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Jumping to finished label.'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number10 index9 alt1"><code class="asm plain">msg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Inside subroutine number: '</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number11 index10 alt2"><code class="asm plain">msg3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Inside subroutine "finished".'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number14 index13 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm plain">_start:</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">subrountineOne:</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of msg1 into eax</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing with linefeed function</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump to the local label under the subrountineOne scope</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm plain">.finished:</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of msg2 into eax</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the value one into eax (for subroutine number one)</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function with linefeed function</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="asm plain">subrountineTwo:</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of msg1 into eax</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string print with linefeed function</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump to the local label under the subrountineTwo scope</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="asm plain">.finished:</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of msg2 into eax</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the value two into eax (for subroutine number two)</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function with linefeed function</code></div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of msg1 into eax</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing with linefeed function</code></div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump to the global label finished</code></div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1"><code class="asm plain">finished:</code></div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the address of msg3 into eax</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing with linefeed function</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf namespace.asm</span>
                                    <span>~$ ld -m elf_i386 namespace.o -o namespace</span>
                                    <span>~$ ./namespace</span>
                                    <span>Jumping to finished label.</span>
                                    <span>Inside subroutine number: 1</span>
                                    <span>Jumping to finished label.</span>
                                    <span>Inside subroutine number: 2</span>
                                    <span>Jumping to finished label.</span>
                                    <span>Inside subroutine "finished".</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson18">
                    <article class="span12">
                        <header>
                            <h2>Lesson 18</h2>
                            <h4>Fizz Buzz</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>FizzBuzz is group word game played in schools to teach children division.  Players take turns to count aloud integers from 1 to 100 replacing any number divisible by 3 with the word "fizz" and any number divisible by 5 with the word "buzz".  Numbers that are both divisible by 3 and 5 are replaced by the word "fizzbuzz".  This children's game has also become a defacto interview screening question for computer programming jobs as it's thought to easily discover candidates that can't construct a simple logic gate.</p>

                        <h5>Writing our program</h5>

                        <p>There are a number of code solutions to this simple game and some languages offer very trivial and elegant solutions.  Depending on how you choose to solve it, the solution almost always involves an if statement and possibly an else statement depending whether you choose to exploit the mathematical property that anything divisible by 5 &amp; 3 would also be divisible by 3 * 5.  Being that this is an assembly language tutorial we will provide a solution that involves a structure of two cascading if statements to print the words "fizz" and/or "buzz" and an else statement in case these fail, to print the integer as an ascii value.  Each iteration of our loop will then print a line feed. Once we reach 100 we call our program exit function.</p>

                        <div class="snippet">
                            <span class="filename">fizzbuzz.asm</span>
                            <div><div id="highlighter_276677" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Fizzbuzz</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf fizzbuzz.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 fizzbuzz.o -o fizzbuzz</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./fizzbuzz</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">fizz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Fizz'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number10 index9 alt1"><code class="asm plain">buzz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Buzz'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; initialise our checkFizz boolean variable</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; initialise our checkBuzz boolean variable</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; initialise our counter variable</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="asm plain">nextNumber:</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">inc</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; increment our counter variable</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="asm plain">.checkFizz:</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; clear the edx register - this will hold our remainder after division</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the value of our counter into eax for division</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our number to divide by into ebx (in this case the value is 3)</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">div</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by ebx</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move our remainder into edi (our checkFizz boolean variable)</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; compare if the remainder is zero (meaning the counter divides by 3)</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jne</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.checkBuzz&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if the remainder is not equal to zero jump to local label checkBuzz</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, fizz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; else move the address of our fizz string into eax for printing</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="asm plain">.checkBuzz:</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; clear the edx register - this will hold our remainder after division</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the value of our counter into eax for division</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our number to divide by into ebx (in this case the value is 5)</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">div</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; divide eax by ebx</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">edx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move our remainder into edi (our checkBuzz boolean variable)</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; compare if the remainder is zero (meaning the counter divides by 5)</code></div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jne</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.checkInt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if the remainder is not equal to zero jump to local label checkInt</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, buzz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; else move the address of our buzz string into eax for printing</code></div><div class="line number44 index43 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number45 index44 alt2">&nbsp;</div><div class="line number46 index45 alt1"><code class="asm plain">.checkInt:</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; edi contains the remainder after the division in checkFizz</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">je</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.continue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if equal (counter divides by 3) skip printing the integer</code></div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; esi contains the remainder after the division in checkBuzz</code></div><div class="line number50 index49 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">je</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">.continue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if equal (counter divides by 5) skip printing the integer</code></div><div class="line number51 index50 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; else move the value in ecx (our counter) into eax for printing</code></div><div class="line number52 index51 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function</code></div><div class="line number53 index52 alt2">&nbsp;</div><div class="line number54 index53 alt1"><code class="asm plain">.continue:</code></div><div class="line number55 index54 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0Ah&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move an ascii linefeed character into eax</code></div><div class="line number56 index55 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the address of eax onto the stack for printing</code></div><div class="line number57 index56 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; get the stack pointer (address on the stack of our linefeed char)</code></div><div class="line number58 index57 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function to print a line feed</code></div><div class="line number59 index58 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">pop</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; pop the stack so we don't waste resources</code></div><div class="line number60 index59 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; compare if our counter is equal to 100</code></div><div class="line number61 index60 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jne</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">nextNumber&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if not equal jump to the start of the loop</code></div><div class="line number62 index61 alt1">&nbsp;</div><div class="line number63 index62 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; else call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf fizzbuzz.asm</span>
                                    <span>~$ ld -m elf_i386 fizzbuzz.o -o fizzbuzz</span>
                                    <span>~$ ./fizzbuzz</span>
                                    <span>1</span>
                                    <span>2</span>
                                    <span>Fizz</span>
                                    <span>4</span>
                                    <span>Buzz</span>
                                    <span>Fizz</span>
                                    <span>7</span>
                                    <span>8</span>
                                    <span>Fizz</span>
                                    <span>Buzz</span>
                                    <span>11</span>
                                    <span>Fizz</span>
                                    <span>13</span>
                                    <span>14</span>
                                    <span>FizzBuzz</span>
                                    <span>16</span>
                                    <span>...</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson19">
                    <article class="span12">
                        <header>
                            <h2>Lesson 19</h2>
                            <h4>Execute Command</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>The EXEC family of functions replace the currently running process with a new process, that executes the command you specified when calling it.  We will be using the <span class="function-name">SYS_EXECVE</span> function in this lesson to replace our program's running process with a new process that will execute the linux program /bin/echo to print out “Hello World!”.</p>

                        <h5>Naming convention</h5>

                        <p>The naming convention used for this family of functions is <strong>exec</strong> (execute) followed by one or more of the following letters.</p>

                        <ul>
                            <li><span class="instruction-name">e</span> - An array of pointers to environment variables is explicitly passed to the new process image.</li>
                            <li><span class="instruction-name">l</span> - Command-line arguments are passed individually to the function.</li>
                            <li><span class="instruction-name">p</span> - Uses the PATH environment variable to find the file named in the path argument to be executed.</li>
                            <li><span class="instruction-name">v</span> - Command-line arguments are passed to the function as an array of pointers.</li>
                        </ul>

                        <h5>Writing our program</h5>

                        <p>The <span class="instruction-name">V</span> &amp; <span class="instruction-name">E</span> at the end of our function name means we will need to pass our arguments in the following format:  The first argument is a string containing the command to execute, then an array of arguments to pass to that command and then another array of environment variables that the new process will use.  As we are calling a simple command we won't pass any special environment variables to the new process and instead will pass 0h (null).</p>

                        <p>Both the command arguments and the environment arguments need to be passed as an array of pointers (addresses to memory).  That's why we define our strings first and then define a simple null-terminated struct (array) of the variables names.  This is then passed to <span class="function-name">SYS_EXECVE.</span> We call the function and the process is replaced by our command and output is returned to the terminal.</p>

                        <div class="snippet">
                            <span class="filename">execute.asm</span>
                            <div><div id="highlighter_880032" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Execute</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf execute.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 execute.o -o execute</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./execute</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">command&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'/bin/echo'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; command to execute</code></div><div class="line number10 index9 alt1"><code class="asm plain">arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Hello World!'</code><code class="asm plain">, 0h</code></div><div class="line number11 index10 alt2"><code class="asm plain">arguments&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">dd</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">command</code></div><div class="line number12 index11 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm keyword bold">dd</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; arguments to pass to commandline (in this case just one)</code></div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm keyword bold">dd</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; end the struct</code></div><div class="line number14 index13 alt1"><code class="asm plain">environment&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">dd</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; arguments to pass as environment variables (inthis case none) end the struct</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number17 index16 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="asm plain">_start:</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, environment&nbsp;&nbsp; </code> <code class="asm comments">; address of environment variables</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, arguments&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; address of the arguments to pass to the commandline</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, command&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; address of the file to execute</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_EXECVE (kernel opcode 11)</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf execute.asm</span>
                                    <span>~$ ld -m elf_i386 execute.o -o execute</span>
                                    <span>~$ ./execute</span>
                                    <span>Hello World!</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-info">Note:</span>
                            Here are a couple other commands to try.
                        </p>

                        <div class="snippet">
                            <span class="filename">execute.asm</span>
                            <div><div id="highlighter_202688" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number8 index0 alt1">8</div><div class="line number9 index1 alt2">9</div><div class="line number10 index2 alt1">10</div></td><td class="code"><div class="container"><div class="line number8 index0 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index1 alt2"><code class="asm plain">command&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'/bin/ls'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; command to execute</code></div><div class="line number10 index2 alt1"><code class="asm plain">arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'-l'</code><code class="asm plain">, 0h</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <div class="snippet">
                            <span class="filename">execute.asm</span>
                            <div><div id="highlighter_411723" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number8 index0 alt1">8</div><div class="line number9 index1 alt2">9</div><div class="line number10 index2 alt1">10</div></td><td class="code"><div class="container"><div class="line number8 index0 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index1 alt2"><code class="asm plain">command&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'/bin/sleep'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; command to execute</code></div><div class="line number10 index2 alt1"><code class="asm plain">arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'5'</code><code class="asm plain">, 0h</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson20">
                    <article class="span12">
                        <header>
                            <h2>Lesson 20</h2>
                            <h4>Process Forking</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>In this lesson we will use <span class="function-name">SYS_FORK</span> to create a new process that duplicates our current process.  <span class="function-name">SYS_FORK</span> takes no arguments - you just call fork and the new process is created.  Both processes run concurrently. We can test the return value (in <span class="register-name">eax)</span> to test whether we are currently in the parent or child process.  The parent process returns a non-negative, non-zero integer.  In the child process <span class="register-name">EAX</span> is zero.  This can be used to branch your logic between the parent and child.</p>

                        <p>In our program we exploit this fact to print out different messages in each process.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Each process is responsible for safely exiting.
                        </p>

                        <div class="snippet">
                            <span class="filename">fork.asm</span>
                            <div><div id="highlighter_13536" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Fork</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf fork.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 fork.o -o fork</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./fork</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">childMsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'This is the child process'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number10 index9 alt1"><code class="asm plain">parentMsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'This is the parent process'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_FORK (kernel opcode 2)</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if eax is zero we are in the child process</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">child&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jump if eax is zero to child label</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm plain">parent:</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, parentMsg&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; inside our parent process move parentMsg into eax</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing with linefeed function</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; quit the parent process</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="asm plain">child:</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, childMsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; inside our child process move childMsg into eax</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing with linefeed function</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; quit the child process</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf fork.asm</span>
                                    <span>~$ ld -m elf_i386 fork.o -o fork</span>
                                    <span>~$ ./fork</span>
                                    <span>This is the parent process</span>
                                    <span>This is the child process</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson21">
                    <article class="span12">
                        <header>
                            <h2>Lesson 21</h2>
                            <h4>Telling the time</h4>
                        </header>

                        <p>Generating a unix timestamp in NASM is easy with the <span class="function-name">SYS_TIME</span> function of the linux kernel.  Simply pass OPCODE 13 to the kernel with no arguments and you are returned the <a href="https://en.wikipedia.org/wiki/Unix_epoch">Unix Epoch</a> in the <span class="register-name">EAX</span> register.</p>

                        <p>That is the number of seconds that have elapsed since January 1st 1970 UTC.</p>

                        <div class="snippet">
                            <span class="filename">time.asm</span>
                            <div><div id="highlighter_794409" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Time</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf time.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 time.o -o time</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./time</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm keyword bold">db</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm string">'Seconds since Jan 01 1970: '</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; a message string</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number12 index11 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">_start:</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move our message string into eax for printing</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_TIME (kernel opcode 13)</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function with linefeed</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf time.asm</span>
                                    <span>~$ ld -m elf_i386 time.o -o time</span>
                                    <span>~$ ./time</span>
                                    <span>Seconds since Jan 01 1970: 1374995660</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson22">
                    <article class="span12">
                        <header>
                            <h2>Lesson 22</h2>
                            <h4>File Handling - Create</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>File Handling in Linux is achieved through a small number of system calls related to creating, updating and deleting files. These functions require a <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> which is a unique, non-negative integer that identifies the file on the system.</p>

                        <h5>Writing our program</h5>

                        <p>We begin the tutorial by creating a file using <span class="function-name">sys_creat.</span>  We will then build upon our program in each of the following file handling lessons, adding code as we go. Eventually we will have a full program that can create, update, open, close and delete files.</p>

                        <p><span class="function-name">sys_creat</span> expects 2 arguments - the file permissions in <span class="register-name">ECX</span> and the filename in <span class="register-name">EBX.</span>  The <span class="function-name">sys_creat</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to create the file. The file descriptor of the created file is returned in <span class="register-name">EAX.</span> This file descriptor can then be used for all other file handling functions.</p>

                        <div class="snippet">
                            <span class="filename">create.asm</span>
                            <div><div id="highlighter_179013" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Create</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf create.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 create.o -o create</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./create</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to create</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number12 index11 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">_start:</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0777o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; set all permissions to read, write, execute</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; filename we will create</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_CREAT (kernel opcode 8)</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf create.asm</span>
                                    <span>~$ ld -m elf_i386 create.o -o create</span>
                                    <span>~$ ./create</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-info">Note:</span>
                            The file 'readme.txt' will now have been created in the folder.
                        </p>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson23">
                    <article class="span12">
                        <header>
                            <h2>Lesson 23</h2>
                            <h4>File Handling - Write</h4>
                        </header>

                        <p>Building upon the previous lesson we will now use <span class="function-name">sys_write</span> to write content to a newly created file.</p>

                        <p><span class="function-name">sys_write</span> expects 3 arguments - the number of bytes to write in <span class="register-name">EDX,</span> the contents string to write in <span class="register-name">ECX</span> and the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span>  The <span class="function-name">sys_write</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to write the content to the file. In this lesson we will first call <span class="function-name">sys_creat</span> to get a file descriptor which we will then load into <span class="register-name">EBX.</span></p>

                        <div class="snippet">
                            <span class="filename">write.asm</span>
                            <div><div id="highlighter_800056" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Write</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf write.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 write.o -o write</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./write</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to create</code></div><div class="line number10 index9 alt1"><code class="asm plain">contents </code><code class="asm keyword bold">db</code> <code class="asm string">'Hello world!'</code><code class="asm plain">, 0h </code> <code class="asm comments">; the contents to write</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0777o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; code continues from lesson 22</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 8</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to write - one for each letter of our contents string</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, contents&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our contents string into ecx</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the file descriptor of the file we created into ebx</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_WRITE (kernel opcode 4)</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf write.asm</span>
                                    <span>~$ ld -m elf_i386 write.o -o write</span>
                                    <span>~$ ./write</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-info">Note:</span>
                            Open the newly created file 'readme.txt' in this folder and you will see the content 'Hello world!'.
                        </p>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson24">
                    <article class="span12">
                        <header>
                            <h2>Lesson 24</h2>
                            <h4>File Handling - Open</h4>
                        </header>

                        <p>Building upon the previous lesson we will now use <span class="function-name">sys_open</span> to obtain the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> of the newly created file. This file descriptor can then be used for all other file handling functions.</p>

                        <p><span class="function-name">sys_open</span> expects 2 arguments - the access mode (table below) in <span class="register-name">ECX</span> and the filename in <span class="register-name">EBX.</span>  The <span class="function-name">sys_open</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to open the file and return the file descriptor.</p>

                        <p><span class="function-name">sys_open</span> additionally accepts zero or more file creation flags and file status flags in <span class="register-name">EDX.</span> <a href="http://man7.org/linux/man-pages/man2/open.2.html" target="_blank">Click here for more information about the access mode, file creation flags and file status flags</a>.</p>

                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Description</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><b>O_RDONLY</b></td>
                                            <td>open file in read only mode</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td><b>O_WRONLY</b></td>
                                            <td>open file in write only mode</td>
                                            <td>1</td>
                                        </tr>
                                        <tr>
                                            <td><b>O_RDWR</b></td>
                                            <td>open file in read and write mode</td>
                                            <td>2</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <p>
                            <span class="label label-info">Note:</span>
                            <span class="function-name">sys_open</span> returns the file descriptor in <span class="register-name">EAX.</span> On linux this will be a unique, non-negative integer which we will print using our integer printing function.
                        </p>

                        <div class="snippet">
                            <span class="filename">open.asm</span>
                            <div><div id="highlighter_31279" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Open</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf open.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 open.o -o open</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./open</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to create</code></div><div class="line number10 index9 alt1"><code class="asm plain">contents </code><code class="asm keyword bold">db</code> <code class="asm string">'Hello world!'</code><code class="asm plain">, 0h </code> <code class="asm comments">; the contents to write</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0777o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Create file from lesson 22</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 8</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Write contents to file from lesson 23</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, contents</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; flag for readonly access mode (O_RDONLY)</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; filename we created above</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_OPEN (kernel opcode 5)</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf open.asm</span>
                                    <span>~$ ld -m elf_i386 open.o -o open</span>
                                    <span>~$ ./open</span>
                                    <span>4</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson25">
                    <article class="span12">
                        <header>
                            <h2>Lesson 25</h2>
                            <h4>File Handling - Read</h4>
                        </header>

                        <p>Building upon the previous lesson we will now use <span class="function-name">sys_read</span> to read the content of a newly created and opened file. We will store this string in a variable.</p>

                        <p><span class="function-name">sys_read</span> expects 3 arguments - the number of bytes to read in <span class="register-name">EDX,</span> the memory address of our variable in <span class="register-name">ECX</span> and the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span>  We will use the previous lessons <span class="function-name">sys_open</span> code to obtain the file descriptor which we will then load into <span class="register-name">EBX.</span> The <span class="function-name">sys_read</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to read the file contents into our variable and is then printed to the screen.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            We will reserve 255 bytes in the .bss section to store the contents of the file. <a href="./#lesson9">See Lesson 9 for more information on the .bss section.</a>
                        </p>

                        <div class="snippet">
                            <span class="filename">read.asm</span>
                            <div><div id="highlighter_498214" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Read</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf read.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 read.o -o read</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./read</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to create</code></div><div class="line number10 index9 alt1"><code class="asm plain">contents </code><code class="asm keyword bold">db</code> <code class="asm string">'Hello world!'</code><code class="asm plain">, 0h </code> <code class="asm comments">; the contents to write</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number13 index12 alt2"><code class="asm plain">fileContents </code><code class="asm keyword bold">resb</code> <code class="asm plain">255,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; variable to store file contents</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number16 index15 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_start:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0777o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Create file from lesson 22</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 8</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Write contents to file from lesson 23</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, contents</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Open file from lesson 24</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 5</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to read - one for each letter of the file contents</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, fileContents&nbsp; </code> <code class="asm comments">; move the memory address of our file contents variable into ecx</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the opened file descriptor into EBX</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_READ (kernel opcode 3)</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, fileContents&nbsp; </code> <code class="asm comments">; move the memory address of our file contents variable into eax for printing</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf read.asm</span>
                                    <span>~$ ld -m elf_i386 read.o -o read</span>
                                    <span>~$ ./read</span>
                                    <span>Hello world!</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson26">
                    <article class="span12">
                        <header>
                            <h2>Lesson 26</h2>
                            <h4>File Handling - Close</h4>
                        </header>

                        <p>Building upon the previous lesson we will now use <span class="function-name">sys_close</span> to properly close an open file.</p>

                        <p><span class="function-name">sys_close</span> expects 1 argument - the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span>  We will use the previous lessons code to obtain the file descriptor which we will then load into <span class="register-name">EBX.</span> The <span class="function-name">sys_close</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to close the file and remove the active file descriptor.</p>

                        <div class="snippet">
                            <span class="filename">close.asm</span>
                            <div><div id="highlighter_708950" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Close</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf close.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 close.o -o close</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./close</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to create</code></div><div class="line number10 index9 alt1"><code class="asm plain">contents </code><code class="asm keyword bold">db</code> <code class="asm string">'Hello world!'</code><code class="asm plain">, 0h </code> <code class="asm comments">; the contents to write</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number13 index12 alt2"><code class="asm plain">fileContents </code><code class="asm keyword bold">resb</code> <code class="asm plain">255,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; variable to store file contents</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number16 index15 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_start:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0777o&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Create file from lesson 22</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 8</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Write contents to file from lesson 23</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, contents</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Open file from lesson 24</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 5</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; Read file from lesson 25</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, fileContents</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, fileContents</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; not needed but used to demonstrate that SYS_CLOSE takes a file descriptor from EBX</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_CLOSE (kernel opcode 6)</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number48 index47 alt1">&nbsp;</div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf close.asm</span>
                                    <span>~$ ld -m elf_i386 close.o -o close</span>
                                    <span>~$ ./close</span>
                                    <span>Hello world!</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-info">Note:</span>
                            We have properly closed the file and removed the active file descriptor.
                        </p>

                    </article>
                </div>

                <hr>

                <div class="row-fluid" id="lesson27">
                    <article class="span12">
                        <header>
                            <h2>Lesson 27</h2>
                            <h4>File Handling - Seek</h4>
                        </header>

                        <p>In this lesson we will open a file and update the file contents at the end of the file using <span class="function-name">sys_lseek.</span></p>

                        <p>Using <span class="function-name">sys_lseek</span> you can move the cursor within the file by an offset in bytes.  The below example will move the cursor to the end of the file, then pass 0 bytes as the offset (so we append to the end of the file and not beyond) before writing a string in that position.  Try different values in <span class="register-name">ECX</span> and <span class="register-name">EDX</span> to write the content to different positions within the opened file.</p>

                        <p><span class="function-name">sys_lseek</span> expects 3 arguments - the whence argument (table below) in <span class="register-name">EDX,</span> the offset in bytes in <span class="register-name">ECX,</span> and the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span> The <span class="function-name">sys_lseek</span> opcode is then loaded into <span class="register-name">EAX</span> and we call the kernel to move the file pointer to the correct offset.  We then use <span class="function-name">sys_write</span> to update the content at that position.</p>

                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Description</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><b>SEEK_SET</b></td>
                                            <td>beginning of the file</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td><b>SEEK_CUR</b></td>
                                            <td>current file offset</td>
                                            <td>1</td>
                                        </tr>
                                        <tr>
                                            <td><b>SEEK_END</b></td>
                                            <td>end of the file</td>
                                            <td>2</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <br>

                        <p>
                            <span class="label label-info">Note:</span>
                            A file 'readme.txt' has been included in the code folder for this lesson. This file will be updated after running the program.
                        </p>

                        <div class="snippet">
                            <span class="filename">seek.asm</span>
                            <div><div id="highlighter_897413" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Seek</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf seek.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 seek.o -o seek</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./seek</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to create</code></div><div class="line number10 index9 alt1"><code class="asm plain">contents&nbsp; </code><code class="asm keyword bold">db</code> <code class="asm string">'-updated-'</code><code class="asm plain">, 0h&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; the contents to write at the start of the file</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number13 index12 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm plain">_start:</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; flag for writeonly access mode (O_WRONLY)</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; filename of the file to open</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_OPEN (kernel opcode 5)</code></div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; whence argument (SEEK_END)</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the cursor 0 bytes</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the opened file descriptor into EBX</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 19&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_LSEEK (kernel opcode 19)</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to write - one for each letter of our contents string</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, contents&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our contents string into ecx</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move the opened file descriptor into EBX (not required as EBX already has the FD)</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_WRITE (kernel opcode 4)</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf seek.asm</span>
                                    <span>~$ ld -m elf_i386 seek.o -o seek</span>
                                    <span>~$ ./seek</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson28">
                    <article class="span12">
                        <header>
                            <h2>Lesson 28</h2>
                            <h4>File Handling - Delete</h4>
                        </header>

                        <p>Deleting a file on linux is achieved by calling <span class="function-name">sys_unlink.</span></p>

                        <p><span class="function-name">sys_unlink</span> expects 1 argument - the filename in <span class="register-name">EBX.</span>  The <span class="function-name">sys_unlink</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to delete the file.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            A file 'readme.txt' has been included in the code folder for this lesson. This file will be deleted after running the program.
                        </p>

                        <div class="snippet">
                            <span class="filename">unlink.asm</span>
                            <div><div id="highlighter_21022" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Unlink</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf unlink.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 unlink.o -o unlink</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./unlink</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm plain">filename </code><code class="asm keyword bold">db</code> <code class="asm string">'readme.txt'</code><code class="asm plain">, 0h&nbsp;&nbsp; </code> <code class="asm comments">; the filename to delete</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number12 index11 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">_start:</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; filename we will delete</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_UNLINK (kernel opcode 10)</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf unlink.asm</span>
                                    <span>~$ ld -m elf_i386 unlink.o -o unlink</span>
                                    <span>~$ ./unlink</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson29">
                    <article class="span12">
                        <header>
                            <h2>Lesson 29</h2>
                            <h4>Sockets - Create</h4>
                        </header>

                        <h5>Firstly, some background</h5>

                        <p>Socket Programming in Linux is achieved through the use of the <span class="function-name">SYS_SOCKETCALL</span> kernel function. The <span class="function-name">SYS_SOCKETCALL</span> function is somewhat unique in that it encapsulates a number of different subroutines, all related to socket operations, within the one function. By passing different integer values in <span class="register-name">EBX</span> we can change the behaviour of this function to create, listen, send, receive, close and more. <a href="https://gist.github.com/DGivney/7196bd7a9f21a12c9397bdcf9ae040d2" target="_blank">Click here</a> to view the full commented source code of the completed program.</p>

                        <h5>Writing our program</h5>

                        <p>We begin the tutorial by first initalizing some of our registers which we will use later to store important values.  We will then create a socket using <span class="function-name">SYS_SOCKETCALL's</span> first subroutine which is called 'socket'.  We will then build upon our program in each of the following socket programming lessons, adding code as we go. Eventually we will have a full program that can create, bind, listen, accept, read, write and close sockets.</p>

                        <p><span class="function-name">SYS_SOCKETCALL's</span> subroutine 'socket' expects 2 arguments - a pointer to an array of arguments in <span class="register-name">ECX</span> and the integer value 1 in <span class="register-name">EBX.</span>  The <span class="function-name">SYS_SOCKETCALL</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to create the socket. Because everything in linux is a file, we recieve back the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> of the created socket in <span class="register-name">EAX.</span> This file descriptor can then be used for performing other socket programming functions.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            XORing a register by itself is an efficent way of ensuring the register is initalised with the integer value zero and doesn't contain an unexpected value that could corrupt your program.
                        </p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_309899" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init eax 0</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init ebx 0</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init edi 0</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init esi 0</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_socket:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 6 onto the stack (IPPROTO_TCP)</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 1 onto the stack (SOCK_STREAM)</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 2 onto the stack (PF_INET)</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of arguments into ecx</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke subroutine SOCKET (1)</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_SOCKETCALL (kernel opcode 102)</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">iprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our integer printing function (print the file descriptor in EAX or -1 on error)</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm plain">_exit:</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                    <span>3</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson30">
                    <article class="span12">
                        <header>
                            <h2>Lesson 30</h2>
                            <h4>Sockets - Bind</h4>
                        </header>

                        <p>Building on the previous lesson we will now associate the created socket with a local IP address and port which will allow us to connect to it.  We do this by calling the second subroutine of <span class="function-name">SYS_SOCKETCALL</span> which is called 'bind'.</p>

                        <p>We begin by storing the file descriptor we recieved in lesson 29 into <span class="register-name">EDI.</span>  <span class="register-name">EDI</span> was originally called the Destination Index and is traditionally used in copy routines to store the location of a target file.</p>

                        <p><span class="function-name">SYS_SOCKETCALL's</span> subroutine 'bind' expects 2 arguments - a pointer to an array of arguments in <span class="register-name">ECX</span> and the integer value 2 in <span class="register-name">EBX.</span>  The <span class="function-name">SYS_SOCKETCALL</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to bind the socket.</p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_778944" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; initialize some registers</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_socket:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; create socket from lesson 29</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm plain">_bind:</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move return value of SYS_SOCKETCALL into edi (file descriptor for new socket, or -1 on error)</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x00000000&nbsp;&nbsp; </code> <code class="asm comments">; push 0 dec onto the stack IP ADDRESS (0.0.0.0)</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x2923&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 9001 dec onto stack PORT (reverse byte order)</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 2 dec onto stack AF_INET</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of stack pointer into ecx</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 16 dec onto stack (arguments length)</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the address of arguments onto stack</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the file descriptor onto stack</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of arguments into ecx</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke subroutine BIND (2)</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_SOCKETCALL (kernel opcode 102)</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2"><code class="asm plain">_exit:</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson31">
                    <article class="span12">
                        <header>
                            <h2>Lesson 31</h2>
                            <h4>Sockets - Listen</h4>
                        </header>

                        <p>In the previous lessons we created a socket and used the 'bind' subroutine to associate it with a local IP address and port.  In this lesson we will use the 'listen' subroutine of <span class="function-name">SYS_SOCKETCALL</span> to tell our socket to listen for incoming TCP requests. This will allow us to read and write to anyone who connects to our socket.</p>

                        <p><span class="function-name">SYS_SOCKETCALL's</span> subroutine 'listen' expects 2 arguments - a pointer to an array of arguments in <span class="register-name">ECX</span> and the integer value 4 in <span class="register-name">EBX.</span>  The <span class="function-name">SYS_SOCKETCALL</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called. If succesful the socket will begin listening for incoming requests.</p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_384022" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; initialize some registers</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_socket:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; create socket from lesson 29</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm plain">_bind:</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; bind socket from lesson 30</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x00000000</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x2923</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 2</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2"><code class="asm plain">_listen:</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move 1 onto stack (max queue length argument)</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the file descriptor onto stack</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of arguments into ecx</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke subroutine LISTEN (4)</code></div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_SOCKETCALL (kernel opcode 102)</code></div><div class="line number50 index49 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1"><code class="asm plain">_exit:</code></div><div class="line number53 index52 alt2">&nbsp;</div><div class="line number54 index53 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson32">
                    <article class="span12">
                        <header>
                            <h2>Lesson 32</h2>
                            <h4>Sockets - Accept</h4>
                        </header>

                        <p>In the previous lessons we created a socket and used the 'bind' subroutine to associate it with a local IP address and port.  We then used the 'listen' subroutine of <span class="function-name">SYS_SOCKETCALL</span> to tell our socket to listen for incoming TCP requests. Now we will use the 'accept' subroutine of <span class="function-name">SYS_SOCKETCALL</span> to tell our socket to accept those incoming requests. Our socket will then be ready to read and write to remote connections.</p>

                        <p><span class="function-name">SYS_SOCKETCALL's</span> subroutine 'accept' expects 2 arguments - a pointer to an array of arguments in <span class="register-name">ECX</span> and the integer value 5 in <span class="register-name">EBX.</span>  The <span class="function-name">SYS_SOCKETCALL</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called. The 'accept' subroutine will create another file descriptor, this time identifying the incoming socket connection. We will use this file descriptor to read and write to the incoming connection in later lessons.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Run the program and use the command <kbd>sudo netstat -plnt</kbd> in another terminal to view the socket listening on port 9001.
                        </p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_450951" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number9 index8 alt2"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm plain">_start:</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; initialize some registers</code></div><div class="line number14 index13 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number15 index14 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code></div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_socket:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; create socket from lesson 29</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="asm plain">_bind:</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; bind socket from lesson 30</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x00000000</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x2923</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 2</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number42 index41 alt1">&nbsp;</div><div class="line number43 index42 alt2"><code class="asm plain">_listen:</code></div><div class="line number44 index43 alt1">&nbsp;</div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; listen socket from lesson 31</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 4</code></div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number50 index49 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1"><code class="asm plain">_accept:</code></div><div class="line number53 index52 alt2">&nbsp;</div><div class="line number54 index53 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 0 dec onto stack (address length argument)</code></div><div class="line number55 index54 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 0 dec onto stack (address argument)</code></div><div class="line number56 index55 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the file descriptor onto stack</code></div><div class="line number57 index56 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of arguments into ecx</code></div><div class="line number58 index57 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke subroutine ACCEPT (5)</code></div><div class="line number59 index58 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_SOCKETCALL (kernel opcode 102)</code></div><div class="line number60 index59 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number61 index60 alt2">&nbsp;</div><div class="line number62 index61 alt1"><code class="asm plain">_exit:</code></div><div class="line number63 index62 alt2">&nbsp;</div><div class="line number64 index63 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson33">
                    <article class="span12">
                        <header>
                            <h2>Lesson 33</h2>
                            <h4>Sockets - Read</h4>
                        </header>

                        <p>When an incoming connection is accepted by our socket, a new file descriptor identifying the incoming socket connection is returned in <span class="register-name">EAX.</span>  In this lesson we will use this file descriptor to read the incoming request headers from the connection.</p>

                        <p>We begin by storing the file descriptor we recieved in lesson 32 into <span class="register-name">ESI.</span>  <span class="register-name">ESI</span> was originally called the Source Index and is traditionally used in copy routines to store the location of a target file.</p>

                        <p>We will use the kernel function <span class="function-name">sys_read</span> to read from the incoming socket connection.  As we have done in previous lessons, we will create a variable to store the contents being read from the file descriptor. Our socket will be using the HTTP protocol to communicate.  Parsing HTTP request headers to determine the length of the incoming message and accepted response formats is beyond the scope of this tutorial.  We will instead just read up to the first 255 bytes and print that to standardout.</p>

                        <p>Once the incoming connection has been accepted, it is very common for webservers to spawn a child process to manage the read/write communication. The parent process is then free to return to the listening/accept state and accept any new incoming requests in parallel. We will implement this design pattern below using <span class="function-name">SYS_FORK</span> and the <span class="instruction-name">JMP</span> instruction prior to reading the request headers in the child process.</p>

                        <p>To generate valid request headers we will use the commandline tool <kbd>curl</kbd> to connect to our listening socket. But you can also use a standard web browser to connect in the same way.</p>

                        <p><span class="function-name">sys_read</span> expects 3 arguments - the number of bytes to read in <span class="register-name">EDX,</span> the memory address of our variable in <span class="register-name">ECX</span> and the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span> The <span class="function-name">sys_read</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to read the contents into our variable which is then printed to the screen.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            We will reserve 255 bytes in the .bss section to store the contents being read from the file descriptor. <a href="./#lesson9">See Lesson 9 for more information on the .bss section.</a>
                        </p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Run the program and use the command <kbd>curl http://localhost:9001</kbd> in another terminal to view the request headers being read by our program.
                        </p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_797890" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number9 index8 alt2"><code class="asm plain">buffer </code><code class="asm keyword bold">resb</code> <code class="asm plain">255,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; variable to store request headers</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number12 index11 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="asm plain">_start:</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; initialize some registers</code></div><div class="line number17 index16 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number18 index17 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code></div><div class="line number19 index18 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="asm plain">_socket:</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; create socket from lesson 29</code></div><div class="line number24 index23 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1</code></div><div class="line number25 index24 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2</code></div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="asm plain">_bind:</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; bind socket from lesson 30</code></div><div class="line number34 index33 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x00000000</code></div><div class="line number35 index34 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x2923</code></div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 2</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number44 index43 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number45 index44 alt2">&nbsp;</div><div class="line number46 index45 alt1"><code class="asm plain">_listen:</code></div><div class="line number47 index46 alt2">&nbsp;</div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; listen socket from lesson 31</code></div><div class="line number49 index48 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number50 index49 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number51 index50 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 4</code></div><div class="line number52 index51 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number53 index52 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number54 index53 alt1">&nbsp;</div><div class="line number55 index54 alt2"><code class="asm plain">_accept:</code></div><div class="line number56 index55 alt1">&nbsp;</div><div class="line number57 index56 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; accept socket from lesson 32</code></div><div class="line number58 index57 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0</code></div><div class="line number59 index58 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number60 index59 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number61 index60 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 5</code></div><div class="line number62 index61 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number63 index62 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number64 index63 alt1">&nbsp;</div><div class="line number65 index64 alt2"><code class="asm plain">_fork:</code></div><div class="line number66 index65 alt1">&nbsp;</div><div class="line number67 index66 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move return value of SYS_SOCKETCALL into esi (file descriptor for accepted socket, or -1 on error)</code></div><div class="line number68 index67 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_FORK (kernel opcode 2)</code></div><div class="line number69 index68 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number70 index69 alt1">&nbsp;</div><div class="line number71 index70 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if return value of SYS_FORK in eax is zero we are in the child process</code></div><div class="line number72 index71 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jmp in child process to _read</code></div><div class="line number73 index72 alt2">&nbsp;</div><div class="line number74 index73 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_accept&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jmp in parent process to _accept</code></div><div class="line number75 index74 alt2">&nbsp;</div><div class="line number76 index75 alt1"><code class="asm plain">_read:</code></div><div class="line number77 index76 alt2">&nbsp;</div><div class="line number78 index77 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 255&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to read (we will only read the first 255 bytes for simplicity)</code></div><div class="line number79 index78 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our buffer variable into ecx</code></div><div class="line number80 index79 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move esi into ebx (accepted socket file descriptor)</code></div><div class="line number81 index80 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_READ (kernel opcode 3)</code></div><div class="line number82 index81 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number83 index82 alt2">&nbsp;</div><div class="line number84 index83 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our buffer variable into eax for printing</code></div><div class="line number85 index84 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number86 index85 alt1">&nbsp;</div><div class="line number87 index86 alt2"><code class="asm plain">_exit:</code></div><div class="line number88 index87 alt1">&nbsp;</div><div class="line number89 index88 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                    <span>GET / HTTP/1.1</span>
                                    <span>Host: localhost:9001</span>
                                    <span>User-Agent: curl/x.xx.x</span>
                                    <span>Accept: */*</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson34">
                    <article class="span12">
                        <header>
                            <h2>Lesson 34</h2>
                            <h4>Sockets - Write</h4>
                        </header>

                        <p>When an incoming connection is accepted by our socket, a new file descriptor identifying the incoming socket connection is returned in <span class="register-name">EAX.</span>  In this lesson we will use this file descriptor to send our response to the connection.</p>

                        <p>We will use the kernel function <span class="function-name">sys_write</span> to write to the incoming socket connection. As our socket will be communicating using the HTTP protocol, we will need to send some compulsory headers in order to allow HTTP speaking clients to connect.  We will send these following the formatting rules set out in the <a href="https://tools.ietf.org/html/rfc2616?spm=5176.doc32013.2.3.Aimyd7#section-4.2" target="_blank">RFC Standard</a>.</p>

                        <p><span class="function-name">sys_write</span> expects 3 arguments - the number of bytes to write in <span class="register-name">EDX,</span> the response string to write in <span class="register-name">ECX</span> and the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span>  The <span class="function-name">sys_write</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to send our response back through our socket to the incoming connection.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            We will create a variable in the .data section to store the response we will write to the file descriptor. <a href="./#lesson1">See Lesson 1 for more information on the .data section.</a>
                        </p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Run the program and use the command <kbd>curl http://localhost:9001</kbd> in another terminal to view the response sent via our socket. Or connect to the same address using any standard web browser.
                        </p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_111353" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm comments">; our response string</code></div><div class="line number10 index9 alt1"><code class="asm plain">response </code><code class="asm keyword bold">db</code> <code class="asm string">'HTTP/1.1 200 OK'</code><code class="asm plain">, 0Dh, 0Ah, </code><code class="asm string">'Content-Type: text/html'</code><code class="asm plain">, 0Dh, 0Ah, </code><code class="asm string">'Content-Length: 14'</code><code class="asm plain">, 0Dh, 0Ah, 0Dh, 0Ah, </code><code class="asm string">'Hello World!'</code><code class="asm plain">, 0Dh, 0Ah, 0h</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number13 index12 alt2"><code class="asm plain">buffer </code><code class="asm keyword bold">resb</code> <code class="asm plain">255,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; variable to store request headers</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number16 index15 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_start:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; initialize some registers</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="asm plain">_socket:</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; create socket from lesson 29</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="asm plain">_bind:</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; bind socket from lesson 30</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x00000000</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x2923</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number44 index43 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 2</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number49 index48 alt2">&nbsp;</div><div class="line number50 index49 alt1"><code class="asm plain">_listen:</code></div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; listen socket from lesson 31</code></div><div class="line number53 index52 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number54 index53 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number55 index54 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 4</code></div><div class="line number56 index55 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number57 index56 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="asm plain">_accept:</code></div><div class="line number60 index59 alt1">&nbsp;</div><div class="line number61 index60 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; accept socket from lesson 32</code></div><div class="line number62 index61 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0</code></div><div class="line number63 index62 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number64 index63 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number65 index64 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 5</code></div><div class="line number66 index65 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number67 index66 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number68 index67 alt1">&nbsp;</div><div class="line number69 index68 alt2"><code class="asm plain">_fork:</code></div><div class="line number70 index69 alt1">&nbsp;</div><div class="line number71 index70 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; fork socket from lesson 33</code></div><div class="line number72 index71 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 2</code></div><div class="line number73 index72 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number74 index73 alt1">&nbsp;</div><div class="line number75 index74 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0</code></div><div class="line number76 index75 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_read</code></div><div class="line number77 index76 alt2">&nbsp;</div><div class="line number78 index77 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_accept</code></div><div class="line number79 index78 alt2">&nbsp;</div><div class="line number80 index79 alt1"><code class="asm plain">_read:</code></div><div class="line number81 index80 alt2">&nbsp;</div><div class="line number82 index81 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 255&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; read socket from lesson 33</code></div><div class="line number83 index82 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, buffer</code></div><div class="line number84 index83 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number85 index84 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3</code></div><div class="line number86 index85 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number87 index86 alt2">&nbsp;</div><div class="line number88 index87 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, buffer</code></div><div class="line number89 index88 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF</code></div><div class="line number90 index89 alt1">&nbsp;</div><div class="line number91 index90 alt2"><code class="asm plain">_write:</code></div><div class="line number92 index91 alt1">&nbsp;</div><div class="line number93 index92 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 78&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move 78 dec into edx (length in bytes to write)</code></div><div class="line number94 index93 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, response&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move address of our response variable into ecx</code></div><div class="line number95 index94 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move file descriptor into ebx (accepted socket id)</code></div><div class="line number96 index95 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_WRITE (kernel opcode 4)</code></div><div class="line number97 index96 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number98 index97 alt1">&nbsp;</div><div class="line number99 index98 alt2"><code class="asm plain">_exit:</code></div><div class="line number100 index99 alt1">&nbsp;</div><div class="line number101 index100 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                </div>
                            </div>

                            <br>

                            <span class="filename">New terminal window</span>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ curl http://localhost:9001</span>
                                    <span>Hello World!</span>
                                </div>
                            </div>
                        </div>

                    </article>
                </div>

                <div class="row-fluid" id="lesson35">
                    <article class="span12">
                        <header>
                            <h2>Lesson 35</h2>
                            <h4>Sockets - Close</h4>
                        </header>

                        <p>In this lesson we will use <span class="function-name">sys_close</span> to properly close the active socket connection in the child process after our response has been sent. This will free up some resources that can be used to accept new incoming connections.</p>

                        <p><span class="function-name">sys_close</span> expects 1 argument - the <a href="https://en.wikipedia.org/wiki/File_descriptor" target="_blank">file descriptor</a> in <span class="register-name">EBX.</span> The <span class="function-name">sys_close</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to close the socket and remove the active file descriptor.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            Run the program and use the command <kbd>curl http://localhost:9001</kbd> in another terminal or connect to the same address using any standard web browser.
                        </p>

                        <div class="snippet">
                            <span class="filename">socket.asm</span>
                            <div><div id="highlighter_953902" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Socket</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf socket.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./socket</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm comments">; our response string</code></div><div class="line number10 index9 alt1"><code class="asm plain">response </code><code class="asm keyword bold">db</code> <code class="asm string">'HTTP/1.1 200 OK'</code><code class="asm plain">, 0Dh, 0Ah, </code><code class="asm string">'Content-Type: text/html'</code><code class="asm plain">, 0Dh, 0Ah, </code><code class="asm string">'Content-Length: 14'</code><code class="asm plain">, 0Dh, 0Ah, 0Dh, 0Ah, </code><code class="asm string">'Hello World!'</code><code class="asm plain">, 0Dh, 0Ah, 0h</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number13 index12 alt2"><code class="asm plain">buffer </code><code class="asm keyword bold">resb</code> <code class="asm plain">255,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; variable to store request headers</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number16 index15 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_start:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; initialize some registers</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code></div><div class="line number23 index22 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="asm plain">_socket:</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; create socket from lesson 29</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number33 index32 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="asm plain">_bind:</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; bind socket from lesson 30</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x00000000</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x2923</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code></div><div class="line number44 index43 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 2</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number48 index47 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number49 index48 alt2">&nbsp;</div><div class="line number50 index49 alt1"><code class="asm plain">_listen:</code></div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; listen socket from lesson 31</code></div><div class="line number53 index52 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number54 index53 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number55 index54 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 4</code></div><div class="line number56 index55 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number57 index56 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="asm plain">_accept:</code></div><div class="line number60 index59 alt1">&nbsp;</div><div class="line number61 index60 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; accept socket from lesson 32</code></div><div class="line number62 index61 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">0</code></div><div class="line number63 index62 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code></div><div class="line number64 index63 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code></div><div class="line number65 index64 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 5</code></div><div class="line number66 index65 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102</code></div><div class="line number67 index66 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number68 index67 alt1">&nbsp;</div><div class="line number69 index68 alt2"><code class="asm plain">_fork:</code></div><div class="line number70 index69 alt1">&nbsp;</div><div class="line number71 index70 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">esi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; fork socket from lesson 33</code></div><div class="line number72 index71 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 2</code></div><div class="line number73 index72 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number74 index73 alt1">&nbsp;</div><div class="line number75 index74 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0</code></div><div class="line number76 index75 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_read</code></div><div class="line number77 index76 alt2">&nbsp;</div><div class="line number78 index77 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_accept</code></div><div class="line number79 index78 alt2">&nbsp;</div><div class="line number80 index79 alt1"><code class="asm plain">_read:</code></div><div class="line number81 index80 alt2">&nbsp;</div><div class="line number82 index81 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 255&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; read socket from lesson 33</code></div><div class="line number83 index82 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, buffer</code></div><div class="line number84 index83 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number85 index84 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3</code></div><div class="line number86 index85 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number87 index86 alt2">&nbsp;</div><div class="line number88 index87 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, buffer</code></div><div class="line number89 index88 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprintLF</code></div><div class="line number90 index89 alt1">&nbsp;</div><div class="line number91 index90 alt2"><code class="asm plain">_write:</code></div><div class="line number92 index91 alt1">&nbsp;</div><div class="line number93 index92 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 78&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; write socket from lesson 34</code></div><div class="line number94 index93 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, response</code></div><div class="line number95 index94 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code></div><div class="line number96 index95 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4</code></div><div class="line number97 index96 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h</code></div><div class="line number98 index97 alt1">&nbsp;</div><div class="line number99 index98 alt2"><code class="asm plain">_close:</code></div><div class="line number100 index99 alt1">&nbsp;</div><div class="line number101 index100 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">esi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move esi into ebx (accepted socket file descriptor)</code></div><div class="line number102 index101 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_CLOSE (kernel opcode 6)</code></div><div class="line number103 index102 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number104 index103 alt1">&nbsp;</div><div class="line number105 index104 alt2"><code class="asm plain">_exit:</code></div><div class="line number106 index105 alt1">&nbsp;</div><div class="line number107 index106 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf socket.asm</span>
                                    <span>~$ ld -m elf_i386 socket.o -o socket</span>
                                    <span>~$ ./socket</span>
                                </div>
                            </div>

                            <br>

                            <span class="filename">New terminal window</span>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ curl http://localhost:9001</span>
                                    <span>Hello World!</span>
                                </div>
                            </div>
                        </div>

                        <p>
                            <span class="label label-info">Note:</span>
                            We have properly closed the socket connections and removed their active file descriptors.
                        </p>

                    </article>
                </div>

                <div class="row-fluid" id="lesson36">
                    <article class="span12">
                        <header>
                            <h2>Lesson 36</h2>
                            <h4>Download a Webpage</h4>
                        </header>

                        <p>In the previous lessons we have been learning how to use the many subroutines of the <span class="function-name">SYS_SOCKETCALL</span> kernel function to create, manage and transfer data through Linux sockets. We will continue that theme in this lesson by using the 'connect' subroutine of <span class="function-name">SYS_SOCKETCALL</span> to connect to a remote webserver and download a webpage.</p>

                        <p>These are the steps we need to follow to connect a socket to a remote server:
                            </p><ul>
                                <li> Call <span class="function-name">SYS_SOCKETCALL's</span> subroutine 'socket' to create an active socket that we will use to send outbound requests.</li>
                                <li> Call <span class="function-name">SYS_SOCKETCALL's</span> subroutine 'connect' to connect our socket with a socket on the remote webserver.</li>
                                <li> Use <span class="function-name">SYS_WRITE</span> to send a HTTP formatted request through our socket to the remote webserver.</li>
                                <li> Use <span class="function-name">SYS_READ</span> to recieve the HTTP formatted response from the webserver.</li>
                            </ul>
                            We will then use our string printing function to print the response to our terminal.
                        <p></p>

                        <h5>What is a HTTP Request</h5>

                        <p>The HTTP specification has evolved through a number of standard versions including <a href="https://tools.ietf.org/html/rfc1945" target="_blank">1.0 in RFC1945</a>, <a href="https://tools.ietf.org/html/rfc2068" target="_blank">1.1 in RFC2068</a> and <a href="https://tools.ietf.org/html/rfc7540" target="_blank">2.0 in RFC7540</a>.  Version 1.1 is still the most common today.</p>

                        <p>A HTTP/1.1 request is comprised of 3 sections:
                            </p><ol>
                                <li> A line containing the <i>request method</i>, <i>request url</i>, and <i>http version</i></li>
                                <li> An optional section of <i><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">request headers</a></i></li>
                                <li> An <i>empty line</i> that tells the remote server you have finished sending the request and you will begin waiting for the response.</li>
                            </ol>
                        <p></p>

                        <p>A typical HTTP request for the root document on this server would look like this:</p>

                        <div class="snippet">
                            <div><div id="highlighter_422533" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm plain">GET / HTTP/1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; A line containing the request method, url and version</code></div><div class="line number2 index1 alt1"><code class="asm plain">Host: asmtutor.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; A section of request headers</code></div><div class="line number3 index2 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="asm comments">; A required empty line</code></div></div></td></tr></tbody></table></div></div>
                        </div>

                        <h5>Writing our program</h5>

                        <p>This tutorial starts out like the previous ones by calling <span class="function-name">SYS_SOCKETCALL's</span> subroutine 'socket' to initially create our socket.  However, instead of calling 'bind' on this socket we will call 'connect' with an IP Address and Port Number to connect our socket to a remote webserver. We will then use the <span class="function-name">SYS_WRITE</span> and <span class="function-name">SYS_READ</span> kernel methods to transfer data between the two sockets by sending a HTTP request and reading the HTTP response.</p>

                        <p><span class="function-name">SYS_SOCKETCALL's</span> subroutine 'connect' expects 2 arguments - a pointer to an array of arguments in <span class="register-name">ECX</span> and the integer value 3 in <span class="register-name">EBX.</span>  The <span class="function-name">SYS_SOCKETCALL</span> opcode is then loaded into <span class="register-name">EAX</span> and the kernel is called to connect to the socket.</p>

                        <p>
                            <span class="label label-info">Note:</span>
                            In Linux we can use the following command <kbd>./crawler &gt; index.html</kbd> to save the output of our program to a file instead.
                        </p>

                        <div class="snippet">
                            <span class="filename">crawler.asm</span>
                            <div><div id="highlighter_968930" class="syntaxhighlighter  asm"><div class="toolbar"><span><a href="./#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="asm comments">; Crawler</code></div><div class="line number2 index1 alt1"><code class="asm comments">; Compile with: nasm -f elf crawler.asm</code></div><div class="line number3 index2 alt2"><code class="asm comments">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 crawler.o -o crawler</code></div><div class="line number4 index3 alt1"><code class="asm comments">; Run with: ./crawler</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="asm plain">%</code><code class="asm keyword bold">include</code>&nbsp;&nbsp;&nbsp; <code class="asm string">'functions.asm'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.data</code></div><div class="line number9 index8 alt2"><code class="asm comments">; our request string</code></div><div class="line number10 index9 alt1"><code class="asm plain">request </code><code class="asm keyword bold">db</code> <code class="asm string">'GET / HTTP/1.1'</code><code class="asm plain">, 0Dh, 0Ah, </code><code class="asm string">'Host: 139.162.39.66:80'</code><code class="asm plain">, 0Dh, 0Ah, 0Dh, 0Ah, 0h</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.bss</code></div><div class="line number13 index12 alt2"><code class="asm plain">buffer </code><code class="asm keyword bold">resb</code> <code class="asm plain">1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; variable to store response</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="asm keyword bold">SECTION</code> <code class="asm plain">.text</code></div><div class="line number16 index15 alt1"><code class="asm keyword bold">global</code>&nbsp; <code class="asm plain">_start</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="asm plain">_start:</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init eax 0</code></div><div class="line number21 index20 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">ebx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init ebx 0</code></div><div class="line number22 index21 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">xor</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; init edi 0</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="asm plain">_socket:</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 6 onto the stack (IPPROTO_TCP)</code></div><div class="line number27 index26 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 1 onto the stack (SOCK_STREAM)</code></div><div class="line number28 index27 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 2 onto the stack (PF_INET)</code></div><div class="line number29 index28 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of arguments into ecx</code></div><div class="line number30 index29 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke subroutine SOCKET (1)</code></div><div class="line number31 index30 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_SOCKETCALL (kernel opcode 102)</code></div><div class="line number32 index31 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="asm plain">_connect:</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code><code class="asm plain">, </code><code class="asm color1 bold">eax</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move return value of SYS_SOCKETCALL into edi (file descriptor for new socket, or -1 on error)</code></div><div class="line number37 index36 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">dword</code> <code class="asm plain">0x4227a28b&nbsp;&nbsp; </code> <code class="asm comments">; push 139.162.39.66 onto the stack IP ADDRESS (reverse byte order)</code></div><div class="line number38 index37 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">0x5000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 80 onto stack PORT (reverse byte order)</code></div><div class="line number39 index38 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">word</code> <code class="asm plain">2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 2 dec onto stack AF_INET</code></div><div class="line number40 index39 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of stack pointer into ecx</code></div><div class="line number41 index40 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm keyword bold">byte</code> <code class="asm plain">16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; push 16 dec onto stack (arguments length)</code></div><div class="line number42 index41 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the address of arguments onto stack</code></div><div class="line number43 index42 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">push</code>&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; push the file descriptor onto stack</code></div><div class="line number44 index43 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, </code><code class="asm color1 bold">esp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move address of arguments into ecx</code></div><div class="line number45 index44 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke subroutine CONNECT (3)</code></div><div class="line number46 index45 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 102&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_SOCKETCALL (kernel opcode 102)</code></div><div class="line number47 index46 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number48 index47 alt1">&nbsp;</div><div class="line number49 index48 alt2"><code class="asm plain">_write:</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move 43 dec into edx (length in bytes to write)</code></div><div class="line number52 index51 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, request&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move address of our request variable into ecx</code></div><div class="line number53 index52 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move file descriptor into ebx (created socket file descriptor)</code></div><div class="line number54 index53 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_WRITE (kernel opcode 4)</code></div><div class="line number55 index54 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number56 index55 alt1">&nbsp;</div><div class="line number57 index56 alt2"><code class="asm plain">_read:</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">edx</code><code class="asm plain">, 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; number of bytes to read (we will read 1 byte at a time)</code></div><div class="line number60 index59 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ecx</code><code class="asm plain">, buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our buffer variable into ecx</code></div><div class="line number61 index60 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move edi into ebx (created socket file descriptor)</code></div><div class="line number62 index61 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_READ (kernel opcode 3)</code></div><div class="line number63 index62 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number64 index63 alt1">&nbsp;</div><div class="line number65 index64 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; if return value of SYS_READ in eax is zero, we have reached the end of the file</code></div><div class="line number66 index65 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jz</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_close&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jmp to _close if we have reached the end of the file (zero flag set)</code></div><div class="line number67 index66 alt2">&nbsp;</div><div class="line number68 index67 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; move the memory address of our buffer variable into eax for printing</code></div><div class="line number69 index68 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">sprint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our string printing function</code></div><div class="line number70 index69 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">jmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">_read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; jmp to _read</code></div><div class="line number71 index70 alt2">&nbsp;</div><div class="line number72 index71 alt1"><code class="asm plain">_close:</code></div><div class="line number73 index72 alt2">&nbsp;</div><div class="line number74 index73 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">ebx</code><code class="asm plain">, </code><code class="asm color1 bold">edi</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <code class="asm comments">; move edi into ebx (connected socket file descriptor)</code></div><div class="line number75 index74 alt2"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">mov</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm color1 bold">eax</code><code class="asm plain">, 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; invoke SYS_CLOSE (kernel opcode 6)</code></div><div class="line number76 index75 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">int</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="asm plain">80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call the kernel</code></div><div class="line number77 index76 alt2">&nbsp;</div><div class="line number78 index77 alt1"><code class="asm plain">_exit:</code></div><div class="line number79 index78 alt2">&nbsp;</div><div class="line number80 index79 alt1"><code class="asm spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="asm functions bold">call</code>&nbsp;&nbsp;&nbsp; <code class="asm plain">quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code> <code class="asm comments">; call our quit function</code></div></div></td></tr></tbody></table></div></div>
                            <div class="output">
                                <div class="inner">
                                    <span>~$ nasm -f elf crawler.asm</span>
                                    <span>~$ ld -m elf_i386 crawler.o -o crawler</span>
                                    <span>~$ ./crawler</span>
                                    <span>HTTP/1.1 200 OK</span>
                                    <span>Content-Type: text/html</span>
                                    <span>&nbsp;</span>
                                    <span>&lt;!DOCTYPE html&gt;</span>
                                    <span>&lt;html lang="en"&gt;</span>
                                    <span>...</span>
                                    <span>&lt;/html&gt;</span>
                                </div>
                            </div>
                        </div>
                    </article>
                </div>

                <a href="./#" class="btn-float hidden-phone hidden-tablet" style="display: none;">
                    <i class="fas fa-arrow-up"></i>
                </a>

            </div>
        </div>

        <hr>

        <footer>
            <p>Learn assembly language at <a href="https://asmtutor.com/">https://asmtutor.com</a></p>
        </footer>

    </div>

    <script src="./assets/jquery.min.js"></script>
    <script src="./assets/bootstrap.min.js"></script>
    <script src="./assets/script.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41213327-1', 'asmtutor.com');
      ga('send', 'pageview');

    </script>

  

</body><div id="immersive-translate-popup" style="all: initial"><template shadowrootmode="open"><style>@charset "UTF-8";
/*!
 * Pico.css v1.5.6 (https://picocss.com)
 * Copyright 2019-2022 - Licensed under MIT
 */
/**
 * Theme: default
 */
#mount {
  --font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
    "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  --line-height: 1.5;
  --font-weight: 400;
  --font-size: 16px;
  --border-radius: 0.25rem;
  --border-width: 1px;
  --outline-width: 3px;
  --spacing: 1rem;
  --typography-spacing-vertical: 1.5rem;
  --block-spacing-vertical: calc(var(--spacing) * 2);
  --block-spacing-horizontal: var(--spacing);
  --grid-spacing-vertical: 0;
  --grid-spacing-horizontal: var(--spacing);
  --form-element-spacing-vertical: 0.75rem;
  --form-element-spacing-horizontal: 1rem;
  --nav-element-spacing-vertical: 1rem;
  --nav-element-spacing-horizontal: 0.5rem;
  --nav-link-spacing-vertical: 0.5rem;
  --nav-link-spacing-horizontal: 0.5rem;
  --form-label-font-weight: var(--font-weight);
  --transition: 0.2s ease-in-out;
  --modal-overlay-backdrop-filter: blur(0.25rem);
}
@media (min-width: 576px) {
  #mount {
    --font-size: 17px;
  }
}
@media (min-width: 768px) {
  #mount {
    --font-size: 18px;
  }
}
@media (min-width: 992px) {
  #mount {
    --font-size: 19px;
  }
}
@media (min-width: 1200px) {
  #mount {
    --font-size: 20px;
  }
}

@media (min-width: 576px) {
  #mount > header,
  #mount > main,
  #mount > footer,
  section {
    --block-spacing-vertical: calc(var(--spacing) * 2.5);
  }
}
@media (min-width: 768px) {
  #mount > header,
  #mount > main,
  #mount > footer,
  section {
    --block-spacing-vertical: calc(var(--spacing) * 3);
  }
}
@media (min-width: 992px) {
  #mount > header,
  #mount > main,
  #mount > footer,
  section {
    --block-spacing-vertical: calc(var(--spacing) * 3.5);
  }
}
@media (min-width: 1200px) {
  #mount > header,
  #mount > main,
  #mount > footer,
  section {
    --block-spacing-vertical: calc(var(--spacing) * 4);
  }
}

@media (min-width: 576px) {
  article {
    --block-spacing-horizontal: calc(var(--spacing) * 1.25);
  }
}
@media (min-width: 768px) {
  article {
    --block-spacing-horizontal: calc(var(--spacing) * 1.5);
  }
}
@media (min-width: 992px) {
  article {
    --block-spacing-horizontal: calc(var(--spacing) * 1.75);
  }
}
@media (min-width: 1200px) {
  article {
    --block-spacing-horizontal: calc(var(--spacing) * 2);
  }
}

dialog > article {
  --block-spacing-vertical: calc(var(--spacing) * 2);
  --block-spacing-horizontal: var(--spacing);
}
@media (min-width: 576px) {
  dialog > article {
    --block-spacing-vertical: calc(var(--spacing) * 2.5);
    --block-spacing-horizontal: calc(var(--spacing) * 1.25);
  }
}
@media (min-width: 768px) {
  dialog > article {
    --block-spacing-vertical: calc(var(--spacing) * 3);
    --block-spacing-horizontal: calc(var(--spacing) * 1.5);
  }
}

a {
  --text-decoration: none;
}
a.secondary,
a.contrast {
  --text-decoration: underline;
}

small {
  --font-size: 0.875em;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  --font-weight: 700;
}

h1 {
  --font-size: 2rem;
  --typography-spacing-vertical: 3rem;
}

h2 {
  --font-size: 1.75rem;
  --typography-spacing-vertical: 2.625rem;
}

h3 {
  --font-size: 1.5rem;
  --typography-spacing-vertical: 2.25rem;
}

h4 {
  --font-size: 1.25rem;
  --typography-spacing-vertical: 1.874rem;
}

h5 {
  --font-size: 1.125rem;
  --typography-spacing-vertical: 1.6875rem;
}

[type="checkbox"],
[type="radio"] {
  --border-width: 2px;
}

[type="checkbox"][role="switch"] {
  --border-width: 3px;
}

thead th,
thead td,
tfoot th,
tfoot td {
  --border-width: 3px;
}

:not(thead, tfoot) > * > td {
  --font-size: 0.875em;
}

pre,
code,
kbd,
samp {
  --font-family: "Menlo", "Consolas", "Roboto Mono", "Ubuntu Monospace",
    "Noto Mono", "Oxygen Mono", "Liberation Mono", monospace,
    "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
}

kbd {
  --font-weight: bolder;
}

[data-theme="light"],
#mount:not([data-theme="dark"]) {
  --background-color: #fff;
  --background-light-green: #F5F7F9;
  --color: hsl(205deg, 20%, 32%);
  --h1-color: hsl(205deg, 30%, 15%);
  --h2-color: #24333e;
  --h3-color: hsl(205deg, 25%, 23%);
  --h4-color: #374956;
  --h5-color: hsl(205deg, 20%, 32%);
  --h6-color: #4d606d;
  --muted-color: hsl(205deg, 10%, 50%);
  --muted-border-color: hsl(205deg, 20%, 94%);
  --primary: hsl(195deg, 85%, 41%);
  --primary-hover: hsl(195deg, 90%, 32%);
  --primary-focus: rgba(16, 149, 193, 0.125);
  --primary-inverse: #fff;
  --secondary: hsl(205deg, 15%, 41%);
  --secondary-hover: hsl(205deg, 20%, 32%);
  --secondary-focus: rgba(89, 107, 120, 0.125);
  --secondary-inverse: #fff;
  --contrast: hsl(205deg, 30%, 15%);
  --contrast-hover: #000;
  --contrast-focus: rgba(89, 107, 120, 0.125);
  --contrast-inverse: #fff;
  --mark-background-color: #fff2ca;
  --mark-color: #543a26;
  --ins-color: #388e3c;
  --del-color: #c62828;
  --blockquote-border-color: var(--muted-border-color);
  --blockquote-footer-color: var(--muted-color);
  --button-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  --button-hover-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  --form-element-background-color: transparent;
  --form-element-border-color: hsl(205deg, 14%, 68%);
  --form-element-color: var(--color);
  --form-element-placeholder-color: var(--muted-color);
  --form-element-active-background-color: transparent;
  --form-element-active-border-color: var(--primary);
  --form-element-focus-color: var(--primary-focus);
  --form-element-disabled-background-color: hsl(205deg, 18%, 86%);
  --form-element-disabled-border-color: hsl(205deg, 14%, 68%);
  --form-element-disabled-opacity: 0.5;
  --form-element-invalid-border-color: #c62828;
  --form-element-invalid-active-border-color: #d32f2f;
  --form-element-invalid-focus-color: rgba(211, 47, 47, 0.125);
  --form-element-valid-border-color: #388e3c;
  --form-element-valid-active-border-color: #43a047;
  --form-element-valid-focus-color: rgba(67, 160, 71, 0.125);
  --switch-background-color: hsl(205deg, 16%, 77%);
  --switch-color: var(--primary-inverse);
  --switch-checked-background-color: var(--primary);
  --range-border-color: hsl(205deg, 18%, 86%);
  --range-active-border-color: hsl(205deg, 16%, 77%);
  --range-thumb-border-color: var(--background-color);
  --range-thumb-color: var(--secondary);
  --range-thumb-hover-color: var(--secondary-hover);
  --range-thumb-active-color: var(--primary);
  --table-border-color: var(--muted-border-color);
  --table-row-stripped-background-color: #f6f8f9;
  --code-background-color: hsl(205deg, 20%, 94%);
  --code-color: var(--muted-color);
  --code-kbd-background-color: var(--contrast);
  --code-kbd-color: var(--contrast-inverse);
  --code-tag-color: hsl(330deg, 40%, 50%);
  --code-property-color: hsl(185deg, 40%, 40%);
  --code-value-color: hsl(40deg, 20%, 50%);
  --code-comment-color: hsl(205deg, 14%, 68%);
  --accordion-border-color: var(--muted-border-color);
  --accordion-close-summary-color: var(--color);
  --accordion-open-summary-color: var(--muted-color);
  --card-background-color: var(--background-color);
  --card-border-color: var(--muted-border-color);
  --card-box-shadow: 0.0145rem 0.029rem 0.174rem rgba(27, 40, 50, 0.01698),
    0.0335rem 0.067rem 0.402rem rgba(27, 40, 50, 0.024),
    0.0625rem 0.125rem 0.75rem rgba(27, 40, 50, 0.03),
    0.1125rem 0.225rem 1.35rem rgba(27, 40, 50, 0.036),
    0.2085rem 0.417rem 2.502rem rgba(27, 40, 50, 0.04302),
    0.5rem 1rem 6rem rgba(27, 40, 50, 0.06),
    0 0 0 0.0625rem rgba(27, 40, 50, 0.015);
  --card-sectionning-background-color: #fbfbfc;
  --dropdown-background-color: #fbfbfc;
  --dropdown-border-color: #e1e6eb;
  --dropdown-box-shadow: var(--card-box-shadow);
  --dropdown-color: var(--color);
  --dropdown-hover-background-color: hsl(205deg, 20%, 94%);
  --modal-overlay-background-color: rgba(213, 220, 226, 0.7);
  --progress-background-color: hsl(205deg, 18%, 86%);
  --progress-color: var(--primary);
  --loading-spinner-opacity: 0.5;
  --tooltip-background-color: var(--contrast);
  --tooltip-color: var(--contrast-inverse);
  --icon-checkbox: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-chevron: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(65, 84, 98)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-chevron-button: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-chevron-button-inverse: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-close: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(115, 130, 140)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E%3C/svg%3E");
  --icon-date: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(65, 84, 98)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
  --icon-invalid: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(198, 40, 40)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E");
  --icon-minus: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='5' y1='12' x2='19' y2='12'%3E%3C/line%3E%3C/svg%3E");
  --icon-search: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(65, 84, 98)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
  --icon-time: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(65, 84, 98)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-valid: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(56, 142, 60)' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-share: url("data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0nMjQnIGhlaWdodD0nMjQnIHZpZXdCb3g9JzAgMCAyNCAyNCcgZmlsbD0nbm9uZScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJz48cGF0aCBkPSdNMTguOTM0OCA4LjY0ODQ0QzIwLjg5NDEgOC42NDg0NCAyMi40ODU1IDcuMDU0NjkgMjIuNDg1NSA1LjA5NzY2QzIyLjQ4NTUgMy4xNDA2MiAyMC44OTE4IDEuNTQ2ODggMTguOTM0OCAxLjU0Njg4QzE2Ljk3NTQgMS41NDY4OCAxNS4zODQgMy4xNDA2MiAxNS4zODQgNS4wOTc2NkMxNS4zODQgNS4yOTkyMiAxNS40MDA0IDUuNDkzNzUgMTUuNDMzMiA1LjY4NTk0TDcuMzIzODMgOS4zNTM5MUM2LjcwOTc3IDguODQ1MzEgNS45MjIyNyA4LjU0MDYyIDUuMDY0NDUgOC41NDA2MkMzLjEwNTA4IDguNTQwNjIgMS41MTM2NyAxMC4xMzQ0IDEuNTEzNjcgMTIuMDkxNEMxLjUxMzY3IDE0LjA0ODQgMy4xMDc0MiAxNS42NDIyIDUuMDY0NDUgMTUuNjQyMkM1LjgzMzIgMTUuNjQyMiA2LjU0NTcgMTUuMzk2MSA3LjEyNjk1IDE0Ljk4MTNMMTIuNDk0MSAxNy45OTUzQzEyLjQxNjggMTguMjg1OSAxMi4zNzcgMTguNTg4MyAxMi4zNzcgMTguOTAyM0MxMi4zNzcgMjAuODYxNyAxMy45NzA3IDIyLjQ1MzEgMTUuOTI3NyAyMi40NTMxQzE3Ljg4NzEgMjIuNDUzMSAxOS40Nzg1IDIwLjg1OTQgMTkuNDc4NSAxOC45MDIzQzE5LjQ3ODUgMTYuOTQzIDE3Ljg4NDggMTUuMzUxNiAxNS45Mjc3IDE1LjM1MTZDMTQuOTU3NCAxNS4zNTE2IDE0LjA3ODUgMTUuNzQzIDEzLjQzNjMgMTYuMzczNEw4LjMyMjI3IDEzLjUwNDdDOC41MDk3NyAxMy4wNzExIDguNjE1MjMgMTIuNTk1MyA4LjYxNTIzIDEyLjA5MzhDOC42MTUyMyAxMS42ODEyIDguNTQ0OTIgMTEuMjg3NSA4LjQxNjAyIDEwLjkxOTVMMTYuMjIzIDcuMzg3NUMxNi44NzQ2IDguMTU2MjUgMTcuODQ5NiA4LjY0ODQ0IDE4LjkzNDggOC42NDg0NFpNNS4wNjQ0NSAxMy43Njk1QzQuMTQxMDIgMTMuNzY5NSAzLjM4ODY3IDEzLjAxNzIgMy4zODg2NyAxMi4wOTM4QzMuMzg4NjcgMTEuMTcwMyA0LjE0MTAyIDEwLjQxOCA1LjA2NDQ1IDEwLjQxOEM1Ljk4Nzg5IDEwLjQxOCA2Ljc0MDIzIDExLjE3MDMgNi43NDAyMyAxMi4wOTM4QzYuNzQwMjMgMTMuMDE3MiA1Ljk4Nzg5IDEzLjc2OTUgNS4wNjQ0NSAxMy43Njk1Wk0xNS45Mjc3IDE3LjIyNjZDMTYuODUxMiAxNy4yMjY2IDE3LjYwMzUgMTcuOTc4OSAxNy42MDM1IDE4LjkwMjNDMTcuNjAzNSAxOS44MjU4IDE2Ljg1MTIgMjAuNTc4MSAxNS45Mjc3IDIwLjU3ODFDMTUuMDA0MyAyMC41NzgxIDE0LjI1MiAxOS44MjU4IDE0LjI1MiAxOC45MDIzQzE0LjI1MiAxNy45Nzg5IDE1LjAwMiAxNy4yMjY2IDE1LjkyNzcgMTcuMjI2NlpNMTguOTM0OCAzLjQxOTUzQzE5Ljg1ODIgMy40MTk1MyAyMC42MTA1IDQuMTcxODcgMjAuNjEwNSA1LjA5NTMxQzIwLjYxMDUgNi4wMTg3NSAxOS44NTgyIDYuNzcxMDkgMTguOTM0OCA2Ljc3MTA5QzE4LjAxMTMgNi43NzEwOSAxNy4yNTkgNi4wMTg3NSAxNy4yNTkgNS4wOTUzMUMxNy4yNTkgNC4xNzE4NyAxOC4wMTEzIDMuNDE5NTMgMTguOTM0OCAzLjQxOTUzWicgZmlsbD0nIzgzODM4MycvPjwvc3ZnPiA=");
  --float-ball-more-button-border-color: #F6F6F6;
  --float-ball-more-button-background-color: #FCFCFC;
  --float-ball-more-button-svg-color: #6C6F73;
  color-scheme: light;
  --service-bg-hover:#F7FAFF;
}

@media only screen and (prefers-color-scheme: dark) {
  #mount:not([data-theme="light"]) {
    --background-color: #11191f;
    --background-light-green: #141e26;
    --color: hsl(205deg, 16%, 77%);
    --h1-color: hsl(205deg, 20%, 94%);
    --h2-color: #e1e6eb;
    --h3-color: hsl(205deg, 18%, 86%);
    --h4-color: #c8d1d8;
    --h5-color: hsl(205deg, 16%, 77%);
    --h6-color: #afbbc4;
    --muted-color: hsl(205deg, 10%, 50%);
    --muted-border-color: #1f2d38;
    --primary: hsl(195deg, 85%, 41%);
    --primary-hover: hsl(195deg, 80%, 50%);
    --primary-focus: rgba(16, 149, 193, 0.25);
    --primary-inverse: #fff;
    --secondary: hsl(205deg, 15%, 41%);
    --secondary-hover: hsl(205deg, 10%, 50%);
    --secondary-focus: rgba(115, 130, 140, 0.25);
    --secondary-inverse: #fff;
    --contrast: hsl(205deg, 20%, 94%);
    --contrast-hover: #fff;
    --contrast-focus: rgba(115, 130, 140, 0.25);
    --contrast-inverse: #000;
    --mark-background-color: #d1c284;
    --mark-color: #11191f;
    --ins-color: #388e3c;
    --del-color: #c62828;
    --blockquote-border-color: var(--muted-border-color);
    --blockquote-footer-color: var(--muted-color);
    --button-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    --button-hover-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    --form-element-background-color: #11191f;
    --form-element-border-color: #374956;
    --form-element-color: var(--color);
    --form-element-placeholder-color: var(--muted-color);
    --form-element-active-background-color: var(
      --form-element-background-color
    );
    --form-element-active-border-color: var(--primary);
    --form-element-focus-color: var(--primary-focus);
    --form-element-disabled-background-color: hsl(205deg, 25%, 23%);
    --form-element-disabled-border-color: hsl(205deg, 20%, 32%);
    --form-element-disabled-opacity: 0.5;
    --form-element-invalid-border-color: #b71c1c;
    --form-element-invalid-active-border-color: #c62828;
    --form-element-invalid-focus-color: rgba(198, 40, 40, 0.25);
    --form-element-valid-border-color: #2e7d32;
    --form-element-valid-active-border-color: #388e3c;
    --form-element-valid-focus-color: rgba(56, 142, 60, 0.25);
    --switch-background-color: #374956;
    --switch-color: var(--primary-inverse);
    --switch-checked-background-color: var(--primary);
    --range-border-color: #24333e;
    --range-active-border-color: hsl(205deg, 25%, 23%);
    --range-thumb-border-color: var(--background-color);
    --range-thumb-color: var(--secondary);
    --range-thumb-hover-color: var(--secondary-hover);
    --range-thumb-active-color: var(--primary);
    --table-border-color: var(--muted-border-color);
    --table-row-stripped-background-color: rgba(115, 130, 140, 0.05);
    --code-background-color: #18232c;
    --code-color: var(--muted-color);
    --code-kbd-background-color: var(--contrast);
    --code-kbd-color: var(--contrast-inverse);
    --code-tag-color: hsl(330deg, 30%, 50%);
    --code-property-color: hsl(185deg, 30%, 50%);
    --code-value-color: hsl(40deg, 10%, 50%);
    --code-comment-color: #4d606d;
    --accordion-border-color: var(--muted-border-color);
    --accordion-active-summary-color: var(--primary);
    --accordion-close-summary-color: var(--color);
    --accordion-open-summary-color: var(--muted-color);
    --card-background-color: #141e26;
    --card-border-color: var(--card-background-color);
    --card-box-shadow: 0.0145rem 0.029rem 0.174rem rgba(0, 0, 0, 0.01698),
      0.0335rem 0.067rem 0.402rem rgba(0, 0, 0, 0.024),
      0.0625rem 0.125rem 0.75rem rgba(0, 0, 0, 0.03),
      0.1125rem 0.225rem 1.35rem rgba(0, 0, 0, 0.036),
      0.2085rem 0.417rem 2.502rem rgba(0, 0, 0, 0.04302),
      0.5rem 1rem 6rem rgba(0, 0, 0, 0.06), 0 0 0 0.0625rem rgba(0, 0, 0, 0.015);
    --card-sectionning-background-color: #18232c;
    --dropdown-background-color: hsl(205deg, 30%, 15%);
    --dropdown-border-color: #24333e;
    --dropdown-box-shadow: var(--card-box-shadow);
    --dropdown-color: var(--color);
    --dropdown-hover-background-color: rgba(36, 51, 62, 0.75);
    --modal-overlay-background-color: rgba(36, 51, 62, 0.8);
    --progress-background-color: #24333e;
    --progress-color: var(--primary);
    --loading-spinner-opacity: 0.5;
    --tooltip-background-color: var(--contrast);
    --tooltip-color: var(--contrast-inverse);
    --icon-checkbox: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
    --icon-chevron: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    --icon-chevron-button: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    --icon-chevron-button-inverse: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(0, 0, 0)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    --icon-close: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(115, 130, 140)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E%3C/svg%3E");
    --icon-date: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
    --icon-invalid: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(183, 28, 28)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E");
    --icon-minus: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='5' y1='12' x2='19' y2='12'%3E%3C/line%3E%3C/svg%3E");
    --icon-search: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
    --icon-time: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
    --icon-valid: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(46, 125, 50)' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
    --icon-share: url("data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0nMjInIGhlaWdodD0nMjInIHZpZXdCb3g9JzAgMCAyMiAyMicgZmlsbD0nbm9uZScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJz48cGF0aCBkPSdNMTcuOTM0OCA3LjY0ODQ0QzE5Ljg5NDEgNy42NDg0NCAyMS40ODU1IDYuMDU0NjkgMjEuNDg1NSA0LjA5NzY2QzIxLjQ4NTUgMi4xNDA2MiAxOS44OTE4IDAuNTQ2ODc1IDE3LjkzNDggMC41NDY4NzVDMTUuOTc1NCAwLjU0Njg3NSAxNC4zODQgMi4xNDA2MiAxNC4zODQgNC4wOTc2NkMxNC4zODQgNC4yOTkyMiAxNC40MDA0IDQuNDkzNzUgMTQuNDMzMiA0LjY4NTk0TDYuMzIzODMgOC4zNTM5MUM1LjcwOTc3IDcuODQ1MzEgNC45MjIyNyA3LjU0MDYyIDQuMDY0NDUgNy41NDA2MkMyLjEwNTA4IDcuNTQwNjIgMC41MTM2NzIgOS4xMzQzOCAwLjUxMzY3MiAxMS4wOTE0QzAuNTEzNjcyIDEzLjA0ODQgMi4xMDc0MiAxNC42NDIyIDQuMDY0NDUgMTQuNjQyMkM0LjgzMzIgMTQuNjQyMiA1LjU0NTcgMTQuMzk2MSA2LjEyNjk1IDEzLjk4MTNMMTEuNDk0MSAxNi45OTUzQzExLjQxNjggMTcuMjg1OSAxMS4zNzcgMTcuNTg4MyAxMS4zNzcgMTcuOTAyM0MxMS4zNzcgMTkuODYxNyAxMi45NzA3IDIxLjQ1MzEgMTQuOTI3NyAyMS40NTMxQzE2Ljg4NzEgMjEuNDUzMSAxOC40Nzg1IDE5Ljg1OTQgMTguNDc4NSAxNy45MDIzQzE4LjQ3ODUgMTUuOTQzIDE2Ljg4NDggMTQuMzUxNiAxNC45Mjc3IDE0LjM1MTZDMTMuOTU3NCAxNC4zNTE2IDEzLjA3ODUgMTQuNzQzIDEyLjQzNjMgMTUuMzczNEw3LjMyMjI3IDEyLjUwNDdDNy41MDk3NyAxMi4wNzExIDcuNjE1MjMgMTEuNTk1MyA3LjYxNTIzIDExLjA5MzhDNy42MTUyMyAxMC42ODEyIDcuNTQ0OTIgMTAuMjg3NSA3LjQxNjAyIDkuOTE5NTNMMTUuMjIzIDYuMzg3NUMxNS44NzQ2IDcuMTU2MjUgMTYuODQ5NiA3LjY0ODQ0IDE3LjkzNDggNy42NDg0NFpNNC4wNjQ0NSAxMi43Njk1QzMuMTQxMDIgMTIuNzY5NSAyLjM4ODY3IDEyLjAxNzIgMi4zODg2NyAxMS4wOTM4QzIuMzg4NjcgMTAuMTcwMyAzLjE0MTAyIDkuNDE3OTcgNC4wNjQ0NSA5LjQxNzk3QzQuOTg3ODkgOS40MTc5NyA1Ljc0MDIzIDEwLjE3MDMgNS43NDAyMyAxMS4wOTM4QzUuNzQwMjMgMTIuMDE3MiA0Ljk4Nzg5IDEyLjc2OTUgNC4wNjQ0NSAxMi43Njk1Wk0xNC45Mjc3IDE2LjIyNjZDMTUuODUxMiAxNi4yMjY2IDE2LjYwMzUgMTYuOTc4OSAxNi42MDM1IDE3LjkwMjNDMTYuNjAzNSAxOC44MjU4IDE1Ljg1MTIgMTkuNTc4MSAxNC45Mjc3IDE5LjU3ODFDMTQuMDA0MyAxOS41NzgxIDEzLjI1MiAxOC44MjU4IDEzLjI1MiAxNy45MDIzQzEzLjI1MiAxNi45Nzg5IDE0LjAwMiAxNi4yMjY2IDE0LjkyNzcgMTYuMjI2NlpNMTcuOTM0OCAyLjQxOTUzQzE4Ljg1ODIgMi40MTk1MyAxOS42MTA1IDMuMTcxODcgMTkuNjEwNSA0LjA5NTMxQzE5LjYxMDUgNS4wMTg3NSAxOC44NTgyIDUuNzcxMDkgMTcuOTM0OCA1Ljc3MTA5QzE3LjAxMTMgNS43NzEwOSAxNi4yNTkgNS4wMTg3NSAxNi4yNTkgNC4wOTUzMUMxNi4yNTkgMy4xNzE4NyAxNy4wMTEzIDIuNDE5NTMgMTcuOTM0OCAyLjQxOTUzWicgZmlsbD0nI0I2QjZCNicvPjwvc3ZnPiA=");
    color-scheme: dark;
    --service-bg-hover:#22292F;
  }
}
[data-theme="dark"] {
  --background-color: #11191f;
  --background-light-green: #141e26;
  --color: hsl(205deg, 16%, 77%);
  --h1-color: hsl(205deg, 20%, 94%);
  --h2-color: #e1e6eb;
  --h3-color: hsl(205deg, 18%, 86%);
  --h4-color: #c8d1d8;
  --h5-color: hsl(205deg, 16%, 77%);
  --h6-color: #afbbc4;
  --muted-color: hsl(205deg, 10%, 50%);
  --muted-border-color: #1f2d38;
  --primary: hsl(195deg, 85%, 41%);
  --primary-hover: hsl(195deg, 80%, 50%);
  --primary-focus: rgba(16, 149, 193, 0.25);
  --primary-inverse: #fff;
  --secondary: hsl(205deg, 15%, 41%);
  --secondary-hover: hsl(205deg, 10%, 50%);
  --secondary-focus: rgba(115, 130, 140, 0.25);
  --secondary-inverse: #fff;
  --contrast: hsl(205deg, 20%, 94%);
  --contrast-hover: #fff;
  --contrast-focus: rgba(115, 130, 140, 0.25);
  --contrast-inverse: #000;
  --mark-background-color: #d1c284;
  --mark-color: #11191f;
  --ins-color: #388e3c;
  --del-color: #c62828;
  --blockquote-border-color: var(--muted-border-color);
  --blockquote-footer-color: var(--muted-color);
  --button-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  --button-hover-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  --form-element-background-color: #11191f;
  --form-element-border-color: #374956;
  --form-element-color: var(--color);
  --form-element-placeholder-color: var(--muted-color);
  --form-element-active-background-color: var(--form-element-background-color);
  --form-element-active-border-color: var(--primary);
  --form-element-focus-color: var(--primary-focus);
  --form-element-disabled-background-color: hsl(205deg, 25%, 23%);
  --form-element-disabled-border-color: hsl(205deg, 20%, 32%);
  --form-element-disabled-opacity: 0.5;
  --form-element-invalid-border-color: #b71c1c;
  --form-element-invalid-active-border-color: #c62828;
  --form-element-invalid-focus-color: rgba(198, 40, 40, 0.25);
  --form-element-valid-border-color: #2e7d32;
  --form-element-valid-active-border-color: #388e3c;
  --form-element-valid-focus-color: rgba(56, 142, 60, 0.25);
  --switch-background-color: #374956;
  --switch-color: var(--primary-inverse);
  --switch-checked-background-color: var(--primary);
  --range-border-color: #24333e;
  --range-active-border-color: hsl(205deg, 25%, 23%);
  --range-thumb-border-color: var(--background-color);
  --range-thumb-color: var(--secondary);
  --range-thumb-hover-color: var(--secondary-hover);
  --range-thumb-active-color: var(--primary);
  --table-border-color: var(--muted-border-color);
  --table-row-stripped-background-color: rgba(115, 130, 140, 0.05);
  --code-background-color: #18232c;
  --code-color: var(--muted-color);
  --code-kbd-background-color: var(--contrast);
  --code-kbd-color: var(--contrast-inverse);
  --code-tag-color: hsl(330deg, 30%, 50%);
  --code-property-color: hsl(185deg, 30%, 50%);
  --code-value-color: hsl(40deg, 10%, 50%);
  --code-comment-color: #4d606d;
  --accordion-border-color: var(--muted-border-color);
  --accordion-active-summary-color: var(--primary);
  --accordion-close-summary-color: var(--color);
  --accordion-open-summary-color: var(--muted-color);
  --card-background-color: #141e26;
  --card-border-color: var(--card-background-color);
  --card-box-shadow: 0.0145rem 0.029rem 0.174rem rgba(0, 0, 0, 0.01698),
    0.0335rem 0.067rem 0.402rem rgba(0, 0, 0, 0.024),
    0.0625rem 0.125rem 0.75rem rgba(0, 0, 0, 0.03),
    0.1125rem 0.225rem 1.35rem rgba(0, 0, 0, 0.036),
    0.2085rem 0.417rem 2.502rem rgba(0, 0, 0, 0.04302),
    0.5rem 1rem 6rem rgba(0, 0, 0, 0.06), 0 0 0 0.0625rem rgba(0, 0, 0, 0.015);
  --card-sectionning-background-color: #18232c;
  --dropdown-background-color: hsl(205deg, 30%, 15%);
  --dropdown-border-color: #24333e;
  --dropdown-box-shadow: var(--card-box-shadow);
  --dropdown-color: var(--color);
  --dropdown-hover-background-color: rgba(36, 51, 62, 0.75);
  --modal-overlay-background-color: rgba(36, 51, 62, 0.8);
  --progress-background-color: #24333e;
  --progress-color: var(--primary);
  --loading-spinner-opacity: 0.5;
  --tooltip-background-color: var(--contrast);
  --tooltip-color: var(--contrast-inverse);
  --icon-checkbox: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-chevron: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-chevron-button: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-chevron-button-inverse: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(0, 0, 0)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-close: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(115, 130, 140)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E%3C/svg%3E");
  --icon-date: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
  --icon-invalid: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(183, 28, 28)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E");
  --icon-minus: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(255, 255, 255)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='5' y1='12' x2='19' y2='12'%3E%3C/line%3E%3C/svg%3E");
  --icon-search: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
  --icon-time: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(162, 175, 185)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-valid: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgb(46, 125, 50)' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
  --icon-share: url("data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0nMjInIGhlaWdodD0nMjInIHZpZXdCb3g9JzAgMCAyMiAyMicgZmlsbD0nbm9uZScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJz48cGF0aCBkPSdNMTcuOTM0OCA3LjY0ODQ0QzE5Ljg5NDEgNy42NDg0NCAyMS40ODU1IDYuMDU0NjkgMjEuNDg1NSA0LjA5NzY2QzIxLjQ4NTUgMi4xNDA2MiAxOS44OTE4IDAuNTQ2ODc1IDE3LjkzNDggMC41NDY4NzVDMTUuOTc1NCAwLjU0Njg3NSAxNC4zODQgMi4xNDA2MiAxNC4zODQgNC4wOTc2NkMxNC4zODQgNC4yOTkyMiAxNC40MDA0IDQuNDkzNzUgMTQuNDMzMiA0LjY4NTk0TDYuMzIzODMgOC4zNTM5MUM1LjcwOTc3IDcuODQ1MzEgNC45MjIyNyA3LjU0MDYyIDQuMDY0NDUgNy41NDA2MkMyLjEwNTA4IDcuNTQwNjIgMC41MTM2NzIgOS4xMzQzOCAwLjUxMzY3MiAxMS4wOTE0QzAuNTEzNjcyIDEzLjA0ODQgMi4xMDc0MiAxNC42NDIyIDQuMDY0NDUgMTQuNjQyMkM0LjgzMzIgMTQuNjQyMiA1LjU0NTcgMTQuMzk2MSA2LjEyNjk1IDEzLjk4MTNMMTEuNDk0MSAxNi45OTUzQzExLjQxNjggMTcuMjg1OSAxMS4zNzcgMTcuNTg4MyAxMS4zNzcgMTcuOTAyM0MxMS4zNzcgMTkuODYxNyAxMi45NzA3IDIxLjQ1MzEgMTQuOTI3NyAyMS40NTMxQzE2Ljg4NzEgMjEuNDUzMSAxOC40Nzg1IDE5Ljg1OTQgMTguNDc4NSAxNy45MDIzQzE4LjQ3ODUgMTUuOTQzIDE2Ljg4NDggMTQuMzUxNiAxNC45Mjc3IDE0LjM1MTZDMTMuOTU3NCAxNC4zNTE2IDEzLjA3ODUgMTQuNzQzIDEyLjQzNjMgMTUuMzczNEw3LjMyMjI3IDEyLjUwNDdDNy41MDk3NyAxMi4wNzExIDcuNjE1MjMgMTEuNTk1MyA3LjYxNTIzIDExLjA5MzhDNy42MTUyMyAxMC42ODEyIDcuNTQ0OTIgMTAuMjg3NSA3LjQxNjAyIDkuOTE5NTNMMTUuMjIzIDYuMzg3NUMxNS44NzQ2IDcuMTU2MjUgMTYuODQ5NiA3LjY0ODQ0IDE3LjkzNDggNy42NDg0NFpNNC4wNjQ0NSAxMi43Njk1QzMuMTQxMDIgMTIuNzY5NSAyLjM4ODY3IDEyLjAxNzIgMi4zODg2NyAxMS4wOTM4QzIuMzg4NjcgMTAuMTcwMyAzLjE0MTAyIDkuNDE3OTcgNC4wNjQ0NSA5LjQxNzk3QzQuOTg3ODkgOS40MTc5NyA1Ljc0MDIzIDEwLjE3MDMgNS43NDAyMyAxMS4wOTM4QzUuNzQwMjMgMTIuMDE3MiA0Ljk4Nzg5IDEyLjc2OTUgNC4wNjQ0NSAxMi43Njk1Wk0xNC45Mjc3IDE2LjIyNjZDMTUuODUxMiAxNi4yMjY2IDE2LjYwMzUgMTYuOTc4OSAxNi42MDM1IDE3LjkwMjNDMTYuNjAzNSAxOC44MjU4IDE1Ljg1MTIgMTkuNTc4MSAxNC45Mjc3IDE5LjU3ODFDMTQuMDA0MyAxOS41NzgxIDEzLjI1MiAxOC44MjU4IDEzLjI1MiAxNy45MDIzQzEzLjI1MiAxNi45Nzg5IDE0LjAwMiAxNi4yMjY2IDE0LjkyNzcgMTYuMjI2NlpNMTcuOTM0OCAyLjQxOTUzQzE4Ljg1ODIgMi40MTk1MyAxOS42MTA1IDMuMTcxODcgMTkuNjEwNSA0LjA5NTMxQzE5LjYxMDUgNS4wMTg3NSAxOC44NTgyIDUuNzcxMDkgMTcuOTM0OCA1Ljc3MTA5QzE3LjAxMTMgNS43NzEwOSAxNi4yNTkgNS4wMTg3NSAxNi4yNTkgNC4wOTUzMUMxNi4yNTkgMy4xNzE4NyAxNy4wMTEzIDIuNDE5NTMgMTcuOTM0OCAyLjQxOTUzWicgZmlsbD0nI0I2QjZCNicvPjwvc3ZnPiA=");
  color-scheme: dark;
}

progress,
[type="checkbox"],
[type="radio"],
[type="range"] {
  accent-color: var(--primary);
}

/**
 * Document
 * Content-box & Responsive typography
 */
*,
*::before,
*::after {
  box-sizing: border-box;
  background-repeat: no-repeat;
}

::before,
::after {
  text-decoration: inherit;
  vertical-align: inherit;
}

:where(#mount) {
  -webkit-tap-highlight-color: transparent;
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  text-size-adjust: 100%;
  background-color: var(--background-color);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: var(--font-size);
  line-height: var(--line-height);
  font-family: var(--font-family);
  text-rendering: optimizeLegibility;
  overflow-wrap: break-word;
  cursor: default;
  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;
}

/**
 * Sectioning
 * Container and responsive spacings for header, main, footer
 */
main {
  display: block;
}

#mount {
  width: 100%;
  margin: 0;
}
#mount > header,
#mount > main,
#mount > footer {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding: var(--block-spacing-vertical) var(--block-spacing-horizontal);
}
@media (min-width: 576px) {
  #mount > header,
  #mount > main,
  #mount > footer {
    max-width: 510px;
    padding-right: 0;
    padding-left: 0;
  }
}
@media (min-width: 768px) {
  #mount > header,
  #mount > main,
  #mount > footer {
    max-width: 700px;
  }
}
@media (min-width: 992px) {
  #mount > header,
  #mount > main,
  #mount > footer {
    max-width: 920px;
  }
}
@media (min-width: 1200px) {
  #mount > header,
  #mount > main,
  #mount > footer {
    max-width: 1130px;
  }
}

/**
* Container
*/
.container,
.container-fluid {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding-right: var(--spacing);
  padding-left: var(--spacing);
}

@media (min-width: 576px) {
  .container {
    max-width: 510px;
    padding-right: 0;
    padding-left: 0;
  }
}
@media (min-width: 768px) {
  .container {
    max-width: 700px;
  }
}
@media (min-width: 992px) {
  .container {
    max-width: 920px;
  }
}
@media (min-width: 1200px) {
  .container {
    max-width: 1130px;
  }
}

/**
 * Section
 * Responsive spacings for section
 */
section {
  margin-bottom: var(--block-spacing-vertical);
}

/**
* Grid
* Minimal grid system with auto-layout columns
*/
.grid {
  grid-column-gap: var(--grid-spacing-horizontal);
  grid-row-gap: var(--grid-spacing-vertical);
  display: grid;
  grid-template-columns: 1fr;
  margin: 0;
}
@media (min-width: 992px) {
  .grid {
    grid-template-columns: repeat(auto-fit, minmax(0%, 1fr));
  }
}
.grid > * {
  min-width: 0;
}

/**
 * Horizontal scroller (<figure>)
 */
figure {
  display: block;
  margin: 0;
  padding: 0;
  overflow-x: auto;
}
figure figcaption {
  padding: calc(var(--spacing) * 0.5) 0;
  color: var(--muted-color);
}

/**
 * Typography
 */
b,
strong {
  font-weight: bolder;
}

sub,
sup {
  position: relative;
  font-size: 0.75em;
  line-height: 0;
  vertical-align: baseline;
}

sub {
  bottom: -0.25em;
}

sup {
  top: -0.5em;
}

address,
blockquote,
dl,
figure,
form,
ol,
p,
pre,
table,
ul {
  margin-top: 0;
  margin-bottom: var(--typography-spacing-vertical);
  color: var(--color);
  font-style: normal;
  font-weight: var(--font-weight);
  font-size: var(--font-size);
}

a,
[role="link"] {
  --color: var(--primary);
  --background-color: transparent;
  outline: none;
  background-color: var(--background-color);
  color: var(--color);
  -webkit-text-decoration: var(--text-decoration);
  text-decoration: var(--text-decoration);
  transition: background-color var(--transition), color var(--transition),
    box-shadow var(--transition), -webkit-text-decoration var(--transition);
  transition: background-color var(--transition), color var(--transition),
    text-decoration var(--transition), box-shadow var(--transition);
  transition: background-color var(--transition), color var(--transition),
    text-decoration var(--transition), box-shadow var(--transition),
    -webkit-text-decoration var(--transition);
}
a:is([aria-current], :hover, :active, :focus),
[role="link"]:is([aria-current], :hover, :active, :focus) {
  --color: var(--primary-hover);
  --text-decoration: underline;
}
a:focus,
[role="link"]:focus {
  --background-color: var(--primary-focus);
}
a.secondary,
[role="link"].secondary {
  --color: var(--secondary);
}
a.secondary:is([aria-current], :hover, :active, :focus),
[role="link"].secondary:is([aria-current], :hover, :active, :focus) {
  --color: var(--secondary-hover);
}
a.secondary:focus,
[role="link"].secondary:focus {
  --background-color: var(--secondary-focus);
}
a.contrast,
[role="link"].contrast {
  --color: var(--contrast);
}
a.contrast:is([aria-current], :hover, :active, :focus),
[role="link"].contrast:is([aria-current], :hover, :active, :focus) {
  --color: var(--contrast-hover);
}
a.contrast:focus,
[role="link"].contrast:focus {
  --background-color: var(--contrast-focus);
}

h1,
h2,
h3,
h4,
h5,
h6 {
  margin-top: 0;
  margin-bottom: var(--typography-spacing-vertical);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: var(--font-size);
  font-family: var(--font-family);
}

h1 {
  --color: var(--h1-color);
}

h2 {
  --color: var(--h2-color);
}

h3 {
  --color: var(--h3-color);
}

h4 {
  --color: var(--h4-color);
}

h5 {
  --color: var(--h5-color);
}

h6 {
  --color: var(--h6-color);
}

:where(address, blockquote, dl, figure, form, ol, p, pre, table, ul)
  ~ :is(h1, h2, h3, h4, h5, h6) {
  margin-top: var(--typography-spacing-vertical);
}

hgroup,
.headings {
  margin-bottom: var(--typography-spacing-vertical);
}
hgroup > *,
.headings > * {
  margin-bottom: 0;
}
hgroup > *:last-child,
.headings > *:last-child {
  --color: var(--muted-color);
  --font-weight: unset;
  font-size: 1rem;
  font-family: unset;
}

p {
  margin-bottom: var(--typography-spacing-vertical);
}

small {
  font-size: var(--font-size);
}

:where(dl, ol, ul) {
  padding-right: 0;
  padding-left: var(--spacing);
  -webkit-padding-start: var(--spacing);
  padding-inline-start: var(--spacing);
  -webkit-padding-end: 0;
  padding-inline-end: 0;
}
:where(dl, ol, ul) li {
  margin-bottom: calc(var(--typography-spacing-vertical) * 0.25);
}

:where(dl, ol, ul) :is(dl, ol, ul) {
  margin: 0;
  margin-top: calc(var(--typography-spacing-vertical) * 0.25);
}

ul li {
  list-style: square;
}

mark {
  padding: 0.125rem 0.25rem;
  background-color: var(--mark-background-color);
  color: var(--mark-color);
  vertical-align: baseline;
}

blockquote {
  display: block;
  margin: var(--typography-spacing-vertical) 0;
  padding: var(--spacing);
  border-right: none;
  border-left: 0.25rem solid var(--blockquote-border-color);
  -webkit-border-start: 0.25rem solid var(--blockquote-border-color);
  border-inline-start: 0.25rem solid var(--blockquote-border-color);
  -webkit-border-end: none;
  border-inline-end: none;
}
blockquote footer {
  margin-top: calc(var(--typography-spacing-vertical) * 0.5);
  color: var(--blockquote-footer-color);
}

abbr[title] {
  border-bottom: 1px dotted;
  text-decoration: none;
  cursor: help;
}

ins {
  color: var(--ins-color);
  text-decoration: none;
}

del {
  color: var(--del-color);
}

::-moz-selection {
  background-color: var(--primary-focus);
}

::selection {
  background-color: var(--primary-focus);
}

/**
 * Embedded content
 */
:where(audio, canvas, iframe, img, svg, video) {
  vertical-align: middle;
}

audio,
video {
  display: inline-block;
}

audio:not([controls]) {
  display: none;
  height: 0;
}

:where(iframe) {
  border-style: none;
}

img {
  max-width: 100%;
  height: auto;
  border-style: none;
}

:where(svg:not([fill])) {
  fill: currentColor;
}

svg:not(#mount) {
  overflow: hidden;
}

/**
 * Button
 */
button {
  margin: 0;
  overflow: visible;
  font-family: inherit;
  text-transform: none;
}

button,
[type="button"],
[type="reset"],
[type="submit"] {
  -webkit-appearance: button;
}

button {
  display: block;
  width: 100%;
  margin-bottom: var(--spacing);
}

[role="button"] {
  display: inline-block;
  text-decoration: none;
}

button,
input[type="submit"],
input[type="button"],
input[type="reset"],
[role="button"] {
  --background-color: var(--primary);
  --border-color: var(--primary);
  --color: var(--primary-inverse);
  --box-shadow: var(--button-box-shadow, 0 0 0 rgba(0, 0, 0, 0));
  padding: var(--form-element-spacing-vertical)
    var(--form-element-spacing-horizontal);
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: 1rem;
  line-height: var(--line-height);
  text-align: center;
  cursor: pointer;
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}
button:is([aria-current], :hover, :active, :focus),
input[type="submit"]:is([aria-current], :hover, :active, :focus),
input[type="button"]:is([aria-current], :hover, :active, :focus),
input[type="reset"]:is([aria-current], :hover, :active, :focus),
[role="button"]:is([aria-current], :hover, :active, :focus) {
  --background-color: var(--primary-hover);
  --border-color: var(--primary-hover);
  --box-shadow: var(--button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0));
  --color: var(--primary-inverse);
}
button:focus,
input[type="submit"]:focus,
input[type="button"]:focus,
input[type="reset"]:focus,
[role="button"]:focus {
  --box-shadow: var(--button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0)),
    0 0 0 var(--outline-width) var(--primary-focus);
}

:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).secondary,
input[type="reset"] {
  --background-color: var(--secondary);
  --border-color: var(--secondary);
  --color: var(--secondary-inverse);
  cursor: pointer;
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).secondary:is([aria-current], :hover, :active, :focus),
input[type="reset"]:is([aria-current], :hover, :active, :focus) {
  --background-color: var(--secondary-hover);
  --border-color: var(--secondary-hover);
  --color: var(--secondary-inverse);
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).secondary:focus,
input[type="reset"]:focus {
  --box-shadow: var(--button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0)),
    0 0 0 var(--outline-width) var(--secondary-focus);
}

:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).contrast {
  --background-color: var(--contrast);
  --border-color: var(--contrast);
  --color: var(--contrast-inverse);
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).contrast:is([aria-current], :hover, :active, :focus) {
  --background-color: var(--contrast-hover);
  --border-color: var(--contrast-hover);
  --color: var(--contrast-inverse);
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).contrast:focus {
  --box-shadow: var(--button-hover-box-shadow, 0 0 0 rgba(0, 0, 0, 0)),
    0 0 0 var(--outline-width) var(--contrast-focus);
}

:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).outline,
input[type="reset"].outline {
  --background-color: transparent;
  --color: var(--primary);
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).outline:is([aria-current], :hover, :active, :focus),
input[type="reset"].outline:is([aria-current], :hover, :active, :focus) {
  --background-color: transparent;
  --color: var(--primary-hover);
}

:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).outline.secondary,
input[type="reset"].outline {
  --color: var(--secondary);
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).outline.secondary:is([aria-current], :hover, :active, :focus),
input[type="reset"].outline:is([aria-current], :hover, :active, :focus) {
  --color: var(--secondary-hover);
}

:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).outline.contrast {
  --color: var(--contrast);
}
:is(
    button,
    input[type="submit"],
    input[type="button"],
    [role="button"]
  ).outline.contrast:is([aria-current], :hover, :active, :focus) {
  --color: var(--contrast-hover);
}

:where(
    button,
    [type="submit"],
    [type="button"],
    [type="reset"],
    [role="button"]
  )[disabled],
:where(fieldset[disabled])
  :is(
    button,
    [type="submit"],
    [type="button"],
    [type="reset"],
    [role="button"]
  ),
a[role="button"]:not([href]) {
  opacity: 0.5;
  pointer-events: none;
}

/**
 * Form elements
 */
input,
optgroup,
select,
textarea {
  margin: 0;
  font-size: 1rem;
  line-height: var(--line-height);
  font-family: inherit;
  letter-spacing: inherit;
}

input {
  overflow: visible;
}

select {
  text-transform: none;
}

legend {
  max-width: 100%;
  padding: 0;
  color: inherit;
  white-space: normal;
}

textarea {
  overflow: auto;
}

[type="checkbox"],
[type="radio"] {
  padding: 0;
}

::-webkit-inner-spin-button,
::-webkit-outer-spin-button {
  height: auto;
}

[type="search"] {
  -webkit-appearance: textfield;
  outline-offset: -2px;
}

[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

::-webkit-file-upload-button {
  -webkit-appearance: button;
  font: inherit;
}

::-moz-focus-inner {
  padding: 0;
  border-style: none;
}

:-moz-focusring {
  outline: none;
}

:-moz-ui-invalid {
  box-shadow: none;
}

::-ms-expand {
  display: none;
}

[type="file"],
[type="range"] {
  padding: 0;
  border-width: 0;
}

input:not([type="checkbox"], [type="radio"], [type="range"]) {
  height: calc(
    1rem * var(--line-height) + var(--form-element-spacing-vertical) * 2 +
      var(--border-width) * 2
  );
}

fieldset {
  margin: 0;
  margin-bottom: var(--spacing);
  padding: 0;
  border: 0;
}

label,
fieldset legend {
  display: block;
  margin-bottom: calc(var(--spacing) * 0.25);
  font-weight: var(--form-label-font-weight, var(--font-weight));
}

input:not([type="checkbox"], [type="radio"]),
select,
textarea {
  width: 100%;
}

input:not([type="checkbox"], [type="radio"], [type="range"], [type="file"]),
select,
textarea {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  padding: var(--form-element-spacing-vertical)
    var(--form-element-spacing-horizontal);
}

input,
select,
textarea {
  --background-color: var(--form-element-background-color);
  --border-color: var(--form-element-border-color);
  --color: var(--form-element-color);
  --box-shadow: none;
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}

input:not(
    [type="submit"],
    [type="button"],
    [type="reset"],
    [type="checkbox"],
    [type="radio"],
    [readonly]
  ):is(:active, :focus),
:where(select, textarea):is(:active, :focus) {
  --background-color: var(--form-element-active-background-color);
}

input:not(
    [type="submit"],
    [type="button"],
    [type="reset"],
    [role="switch"],
    [readonly]
  ):is(:active, :focus),
:where(select, textarea):is(:active, :focus) {
  --border-color: var(--form-element-active-border-color);
}

input:not(
    [type="submit"],
    [type="button"],
    [type="reset"],
    [type="range"],
    [type="file"],
    [readonly]
  ):focus,
select:focus,
textarea:focus {
  --box-shadow: 0 0 0 var(--outline-width) var(--form-element-focus-color);
}

input:not([type="submit"], [type="button"], [type="reset"])[disabled],
select[disabled],
textarea[disabled],
:where(fieldset[disabled])
  :is(
    input:not([type="submit"], [type="button"], [type="reset"]),
    select,
    textarea
  ) {
  --background-color: var(--form-element-disabled-background-color);
  --border-color: var(--form-element-disabled-border-color);
  opacity: var(--form-element-disabled-opacity);
  pointer-events: none;
}

:where(input, select, textarea):not(
    [type="checkbox"],
    [type="radio"],
    [type="date"],
    [type="datetime-local"],
    [type="month"],
    [type="time"],
    [type="week"]
  )[aria-invalid] {
  padding-right: calc(
    var(--form-element-spacing-horizontal) + 1.5rem
  ) !important;
  padding-left: var(--form-element-spacing-horizontal);
  -webkit-padding-start: var(--form-element-spacing-horizontal) !important;
  padding-inline-start: var(--form-element-spacing-horizontal) !important;
  -webkit-padding-end: calc(
    var(--form-element-spacing-horizontal) + 1.5rem
  ) !important;
  padding-inline-end: calc(
    var(--form-element-spacing-horizontal) + 1.5rem
  ) !important;
  background-position: center right 0.75rem;
  background-size: 1rem auto;
  background-repeat: no-repeat;
}
:where(input, select, textarea):not(
    [type="checkbox"],
    [type="radio"],
    [type="date"],
    [type="datetime-local"],
    [type="month"],
    [type="time"],
    [type="week"]
  )[aria-invalid="false"] {
  background-image: var(--icon-valid);
}
:where(input, select, textarea):not(
    [type="checkbox"],
    [type="radio"],
    [type="date"],
    [type="datetime-local"],
    [type="month"],
    [type="time"],
    [type="week"]
  )[aria-invalid="true"] {
  background-image: var(--icon-invalid);
}
:where(input, select, textarea)[aria-invalid="false"] {
  --border-color: var(--form-element-valid-border-color);
}
:where(input, select, textarea)[aria-invalid="false"]:is(:active, :focus) {
  --border-color: var(--form-element-valid-active-border-color) !important;
  --box-shadow: 0 0 0 var(--outline-width) var(--form-element-valid-focus-color) !important;
}
:where(input, select, textarea)[aria-invalid="true"] {
  --border-color: var(--form-element-invalid-border-color);
}
:where(input, select, textarea)[aria-invalid="true"]:is(:active, :focus) {
  --border-color: var(--form-element-invalid-active-border-color) !important;
  --box-shadow: 0 0 0 var(--outline-width)
    var(--form-element-invalid-focus-color) !important;
}

[dir="rtl"]
  :where(input, select, textarea):not([type="checkbox"], [type="radio"]):is(
    [aria-invalid],
    [aria-invalid="true"],
    [aria-invalid="false"]
  ) {
  background-position: center left 0.75rem;
}

input::placeholder,
input::-webkit-input-placeholder,
textarea::placeholder,
textarea::-webkit-input-placeholder,
select:invalid {
  color: var(--form-element-placeholder-color);
  opacity: 1;
}

input:not([type="checkbox"], [type="radio"]),
select,
textarea {
  margin-bottom: var(--spacing);
}

select::-ms-expand {
  border: 0;
  background-color: transparent;
}
select:not([multiple], [size]) {
  padding-right: calc(var(--form-element-spacing-horizontal) + 1.5rem);
  padding-left: var(--form-element-spacing-horizontal);
  -webkit-padding-start: var(--form-element-spacing-horizontal);
  padding-inline-start: var(--form-element-spacing-horizontal);
  -webkit-padding-end: calc(var(--form-element-spacing-horizontal) + 1.5rem);
  padding-inline-end: calc(var(--form-element-spacing-horizontal) + 1.5rem);
  background-image: var(--icon-chevron);
  background-position: center right 0.75rem;
  background-size: 1rem auto;
  background-repeat: no-repeat;
}

[dir="rtl"] select:not([multiple], [size]) {
  background-position: center left 0.75rem;
}

:where(input, select, textarea) + small {
  display: block;
  width: 100%;
  margin-top: calc(var(--spacing) * -0.75);
  margin-bottom: var(--spacing);
  color: var(--muted-color);
}

label > :where(input, select, textarea) {
  margin-top: calc(var(--spacing) * 0.25);
}

/**
 * Form elements
 * Checkboxes & Radios
 */
[type="checkbox"],
[type="radio"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 1.25em;
  height: 1.25em;
  margin-top: -0.125em;
  margin-right: 0.375em;
  margin-left: 0;
  -webkit-margin-start: 0;
  margin-inline-start: 0;
  -webkit-margin-end: 0.375em;
  margin-inline-end: 0.375em;
  border-width: var(--border-width);
  font-size: inherit;
  vertical-align: middle;
  cursor: pointer;
}
[type="checkbox"]::-ms-check,
[type="radio"]::-ms-check {
  display: none;
}
[type="checkbox"]:checked,
[type="checkbox"]:checked:active,
[type="checkbox"]:checked:focus,
[type="radio"]:checked,
[type="radio"]:checked:active,
[type="radio"]:checked:focus {
  --background-color: var(--primary);
  --border-color: var(--primary);
  background-image: var(--icon-checkbox);
  background-position: center;
  background-size: 0.75em auto;
  background-repeat: no-repeat;
}
[type="checkbox"] ~ label,
[type="radio"] ~ label {
  display: inline-block;
  margin-right: 0.375em;
  margin-bottom: 0;
  cursor: pointer;
}

[type="checkbox"]:indeterminate {
  --background-color: var(--primary);
  --border-color: var(--primary);
  background-image: var(--icon-minus);
  background-position: center;
  background-size: 0.75em auto;
  background-repeat: no-repeat;
}

[type="radio"] {
  border-radius: 50%;
}
[type="radio"]:checked,
[type="radio"]:checked:active,
[type="radio"]:checked:focus {
  --background-color: var(--primary-inverse);
  border-width: 0.35em;
  background-image: none;
}

[type="checkbox"][role="switch"] {
  --background-color: var(--switch-background-color);
  --border-color: var(--switch-background-color);
  --color: var(--switch-color);
  width: 2.25em;
  height: 1.25em;
  border: var(--border-width) solid var(--border-color);
  border-radius: 1.25em;
  background-color: var(--background-color);
  line-height: 1.25em;
}
[type="checkbox"][role="switch"]:focus {
  --background-color: var(--switch-background-color);
  --border-color: var(--switch-background-color);
}
[type="checkbox"][role="switch"]:checked {
  --background-color: var(--switch-checked-background-color);
  --border-color: var(--switch-checked-background-color);
}
[type="checkbox"][role="switch"]:before {
  display: block;
  width: calc(1.25em - (var(--border-width) * 2));
  height: 100%;
  border-radius: 50%;
  background-color: var(--color);
  content: "";
  transition: margin 0.1s ease-in-out;
}
[type="checkbox"][role="switch"]:checked {
  background-image: none;
}
[type="checkbox"][role="switch"]:checked::before {
  margin-left: calc(1.125em - var(--border-width));
  -webkit-margin-start: calc(1.125em - var(--border-width));
  margin-inline-start: calc(1.125em - var(--border-width));
}

[type="checkbox"][aria-invalid="false"],
[type="checkbox"]:checked[aria-invalid="false"],
[type="radio"][aria-invalid="false"],
[type="radio"]:checked[aria-invalid="false"],
[type="checkbox"][role="switch"][aria-invalid="false"],
[type="checkbox"][role="switch"]:checked[aria-invalid="false"] {
  --border-color: var(--form-element-valid-border-color);
}
[type="checkbox"][aria-invalid="true"],
[type="checkbox"]:checked[aria-invalid="true"],
[type="radio"][aria-invalid="true"],
[type="radio"]:checked[aria-invalid="true"],
[type="checkbox"][role="switch"][aria-invalid="true"],
[type="checkbox"][role="switch"]:checked[aria-invalid="true"] {
  --border-color: var(--form-element-invalid-border-color);
}

/**
 * Form elements
 * Alternatives input types (Not Checkboxes & Radios)
 */
[type="color"]::-webkit-color-swatch-wrapper {
  padding: 0;
}
[type="color"]::-moz-focus-inner {
  padding: 0;
}
[type="color"]::-webkit-color-swatch {
  border: 0;
  border-radius: calc(var(--border-radius) * 0.5);
}
[type="color"]::-moz-color-swatch {
  border: 0;
  border-radius: calc(var(--border-radius) * 0.5);
}

input:not([type="checkbox"], [type="radio"], [type="range"], [type="file"]):is(
    [type="date"],
    [type="datetime-local"],
    [type="month"],
    [type="time"],
    [type="week"]
  ) {
  --icon-position: 0.75rem;
  --icon-width: 1rem;
  padding-right: calc(var(--icon-width) + var(--icon-position));
  background-image: var(--icon-date);
  background-position: center right var(--icon-position);
  background-size: var(--icon-width) auto;
  background-repeat: no-repeat;
}
input:not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="time"] {
  background-image: var(--icon-time);
}

[type="date"]::-webkit-calendar-picker-indicator,
[type="datetime-local"]::-webkit-calendar-picker-indicator,
[type="month"]::-webkit-calendar-picker-indicator,
[type="time"]::-webkit-calendar-picker-indicator,
[type="week"]::-webkit-calendar-picker-indicator {
  width: var(--icon-width);
  margin-right: calc(var(--icon-width) * -1);
  margin-left: var(--icon-position);
  opacity: 0;
}

[dir="rtl"]
  :is(
    [type="date"],
    [type="datetime-local"],
    [type="month"],
    [type="time"],
    [type="week"]
  ) {
  text-align: right;
}

[type="file"] {
  --color: var(--muted-color);
  padding: calc(var(--form-element-spacing-vertical) * 0.5) 0;
  border: 0;
  border-radius: 0;
  background: none;
}
[type="file"]::file-selector-button {
  --background-color: var(--secondary);
  --border-color: var(--secondary);
  --color: var(--secondary-inverse);
  margin-right: calc(var(--spacing) / 2);
  margin-left: 0;
  -webkit-margin-start: 0;
  margin-inline-start: 0;
  -webkit-margin-end: calc(var(--spacing) / 2);
  margin-inline-end: calc(var(--spacing) / 2);
  padding: calc(var(--form-element-spacing-vertical) * 0.5)
    calc(var(--form-element-spacing-horizontal) * 0.5);
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: 1rem;
  line-height: var(--line-height);
  text-align: center;
  cursor: pointer;
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}
[type="file"]::file-selector-button:is(:hover, :active, :focus) {
  --background-color: var(--secondary-hover);
  --border-color: var(--secondary-hover);
}
[type="file"]::-webkit-file-upload-button {
  --background-color: var(--secondary);
  --border-color: var(--secondary);
  --color: var(--secondary-inverse);
  margin-right: calc(var(--spacing) / 2);
  margin-left: 0;
  -webkit-margin-start: 0;
  margin-inline-start: 0;
  -webkit-margin-end: calc(var(--spacing) / 2);
  margin-inline-end: calc(var(--spacing) / 2);
  padding: calc(var(--form-element-spacing-vertical) * 0.5)
    calc(var(--form-element-spacing-horizontal) * 0.5);
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: 1rem;
  line-height: var(--line-height);
  text-align: center;
  cursor: pointer;
  -webkit-transition: background-color var(--transition),
    border-color var(--transition), color var(--transition),
    box-shadow var(--transition);
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}
[type="file"]::-webkit-file-upload-button:is(:hover, :active, :focus) {
  --background-color: var(--secondary-hover);
  --border-color: var(--secondary-hover);
}
[type="file"]::-ms-browse {
  --background-color: var(--secondary);
  --border-color: var(--secondary);
  --color: var(--secondary-inverse);
  margin-right: calc(var(--spacing) / 2);
  margin-left: 0;
  margin-inline-start: 0;
  margin-inline-end: calc(var(--spacing) / 2);
  padding: calc(var(--form-element-spacing-vertical) * 0.5)
    calc(var(--form-element-spacing-horizontal) * 0.5);
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: 1rem;
  line-height: var(--line-height);
  text-align: center;
  cursor: pointer;
  -ms-transition: background-color var(--transition),
    border-color var(--transition), color var(--transition),
    box-shadow var(--transition);
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}
[type="file"]::-ms-browse:is(:hover, :active, :focus) {
  --background-color: var(--secondary-hover);
  --border-color: var(--secondary-hover);
}

[type="range"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 100%;
  height: 1.25rem;
  background: none;
}
[type="range"]::-webkit-slider-runnable-track {
  width: 100%;
  height: 0.25rem;
  border-radius: var(--border-radius);
  background-color: var(--range-border-color);
  -webkit-transition: background-color var(--transition),
    box-shadow var(--transition);
  transition: background-color var(--transition), box-shadow var(--transition);
}
[type="range"]::-moz-range-track {
  width: 100%;
  height: 0.25rem;
  border-radius: var(--border-radius);
  background-color: var(--range-border-color);
  -moz-transition: background-color var(--transition),
    box-shadow var(--transition);
  transition: background-color var(--transition), box-shadow var(--transition);
}
[type="range"]::-ms-track {
  width: 100%;
  height: 0.25rem;
  border-radius: var(--border-radius);
  background-color: var(--range-border-color);
  -ms-transition: background-color var(--transition),
    box-shadow var(--transition);
  transition: background-color var(--transition), box-shadow var(--transition);
}
[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 1.25rem;
  height: 1.25rem;
  margin-top: -0.5rem;
  border: 2px solid var(--range-thumb-border-color);
  border-radius: 50%;
  background-color: var(--range-thumb-color);
  cursor: pointer;
  -webkit-transition: background-color var(--transition),
    transform var(--transition);
  transition: background-color var(--transition), transform var(--transition);
}
[type="range"]::-moz-range-thumb {
  -webkit-appearance: none;
  width: 1.25rem;
  height: 1.25rem;
  margin-top: -0.5rem;
  border: 2px solid var(--range-thumb-border-color);
  border-radius: 50%;
  background-color: var(--range-thumb-color);
  cursor: pointer;
  -moz-transition: background-color var(--transition),
    transform var(--transition);
  transition: background-color var(--transition), transform var(--transition);
}
[type="range"]::-ms-thumb {
  -webkit-appearance: none;
  width: 1.25rem;
  height: 1.25rem;
  margin-top: -0.5rem;
  border: 2px solid var(--range-thumb-border-color);
  border-radius: 50%;
  background-color: var(--range-thumb-color);
  cursor: pointer;
  -ms-transition: background-color var(--transition),
    transform var(--transition);
  transition: background-color var(--transition), transform var(--transition);
}
[type="range"]:hover,
[type="range"]:focus {
  --range-border-color: var(--range-active-border-color);
  --range-thumb-color: var(--range-thumb-hover-color);
}
[type="range"]:active {
  --range-thumb-color: var(--range-thumb-active-color);
}
[type="range"]:active::-webkit-slider-thumb {
  transform: scale(1.25);
}
[type="range"]:active::-moz-range-thumb {
  transform: scale(1.25);
}
[type="range"]:active::-ms-thumb {
  transform: scale(1.25);
}

input:not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="search"] {
  -webkit-padding-start: calc(var(--form-element-spacing-horizontal) + 1.75rem);
  padding-inline-start: calc(var(--form-element-spacing-horizontal) + 1.75rem);
  border-radius: 5rem;
  background-image: var(--icon-search);
  background-position: center left 1.125rem;
  background-size: 1rem auto;
  background-repeat: no-repeat;
}
input:not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="search"][aria-invalid] {
  -webkit-padding-start: calc(
    var(--form-element-spacing-horizontal) + 1.75rem
  ) !important;
  padding-inline-start: calc(
    var(--form-element-spacing-horizontal) + 1.75rem
  ) !important;
  background-position: center left 1.125rem, center right 0.75rem;
}
input:not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="search"][aria-invalid="false"] {
  background-image: var(--icon-search), var(--icon-valid);
}
input:not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="search"][aria-invalid="true"] {
  background-image: var(--icon-search), var(--icon-invalid);
}

[type="search"]::-webkit-search-cancel-button {
  -webkit-appearance: none;
  display: none;
}

[dir="rtl"]
  :where(input):not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="search"] {
  background-position: center right 1.125rem;
}
[dir="rtl"]
  :where(input):not(
    [type="checkbox"],
    [type="radio"],
    [type="range"],
    [type="file"]
  )[type="search"][aria-invalid] {
  background-position: center right 1.125rem, center left 0.75rem;
}

/**
 * Table
 */
:where(table) {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  text-indent: 0;
}

th,
td {
  padding: calc(var(--spacing) / 2) var(--spacing);
  border-bottom: var(--border-width) solid var(--table-border-color);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: var(--font-size);
  text-align: left;
  text-align: start;
}

tfoot th,
tfoot td {
  border-top: var(--border-width) solid var(--table-border-color);
  border-bottom: 0;
}

table[role="grid"] tbody tr:nth-child(odd) {
  background-color: var(--table-row-stripped-background-color);
}

/**
 * Code
 */
pre,
code,
kbd,
samp {
  font-size: 0.875em;
  font-family: var(--font-family);
}

pre {
  -ms-overflow-style: scrollbar;
  overflow: auto;
}

pre,
code,
kbd {
  border-radius: var(--border-radius);
  background: var(--code-background-color);
  color: var(--code-color);
  font-weight: var(--font-weight);
  line-height: initial;
}

code,
kbd {
  display: inline-block;
  padding: 0.375rem 0.5rem;
}

pre {
  display: block;
  margin-bottom: var(--spacing);
  overflow-x: auto;
}
pre > code {
  display: block;
  padding: var(--spacing);
  background: none;
  font-size: 14px;
  line-height: var(--line-height);
}

code b {
  color: var(--code-tag-color);
  font-weight: var(--font-weight);
}
code i {
  color: var(--code-property-color);
  font-style: normal;
}
code u {
  color: var(--code-value-color);
  text-decoration: none;
}
code em {
  color: var(--code-comment-color);
  font-style: normal;
}

kbd {
  background-color: var(--code-kbd-background-color);
  color: var(--code-kbd-color);
  vertical-align: baseline;
}

/**
 * Miscs
 */
hr {
  height: 0;
  border: 0;
  border-top: 1px solid var(--muted-border-color);
  color: inherit;
}

[hidden],
template {
  display: none !important;
}

canvas {
  display: inline-block;
}

/**
 * Accordion (<details>)
 */
details {
  display: block;
  margin-bottom: var(--spacing);
  padding-bottom: var(--spacing);
  border-bottom: var(--border-width) solid var(--accordion-border-color);
}
details summary {
  line-height: 1rem;
  list-style-type: none;
  cursor: pointer;
  transition: color var(--transition);
}
details summary:not([role]) {
  color: var(--accordion-close-summary-color);
}
details summary::-webkit-details-marker {
  display: none;
}
details summary::marker {
  display: none;
}
details summary::-moz-list-bullet {
  list-style-type: none;
}
details summary::after {
  display: block;
  width: 1rem;
  height: 1rem;
  -webkit-margin-start: calc(var(--spacing, 1rem) * 0.5);
  margin-inline-start: calc(var(--spacing, 1rem) * 0.5);
  float: right;
  transform: rotate(-90deg);
  background-image: var(--icon-chevron);
  background-position: right center;
  background-size: 1rem auto;
  background-repeat: no-repeat;
  content: "";
  transition: transform var(--transition);
}
details summary:focus {
  outline: none;
}
details summary:focus:not([role="button"]) {
  color: var(--accordion-active-summary-color);
}
details summary[role="button"] {
  width: 100%;
  text-align: left;
}
details summary[role="button"]::after {
  height: calc(1rem * var(--line-height, 1.5));
  background-image: var(--icon-chevron-button);
}
details summary[role="button"]:not(.outline).contrast::after {
  background-image: var(--icon-chevron-button-inverse);
}
details[open] > summary {
  margin-bottom: calc(var(--spacing));
}
details[open] > summary:not([role]):not(:focus) {
  color: var(--accordion-open-summary-color);
}
details[open] > summary::after {
  transform: rotate(0);
}

[dir="rtl"] details summary {
  text-align: right;
}
[dir="rtl"] details summary::after {
  float: left;
  background-position: left center;
}

/**
 * Card (<article>)
 */
article {
  margin: var(--block-spacing-vertical) 0;
  padding: var(--block-spacing-vertical) var(--block-spacing-horizontal);
  border-radius: var(--border-radius);
  background: var(--card-background-color);
  box-shadow: var(--card-box-shadow);
}
article > header,
article > footer {
  margin-right: calc(var(--block-spacing-horizontal) * -1);
  margin-left: calc(var(--block-spacing-horizontal) * -1);
  padding: calc(var(--block-spacing-vertical) * 0.66)
    var(--block-spacing-horizontal);
  background-color: var(--card-sectionning-background-color);
}
article > header {
  margin-top: calc(var(--block-spacing-vertical) * -1);
  margin-bottom: var(--block-spacing-vertical);
  border-bottom: var(--border-width) solid var(--card-border-color);
  border-top-right-radius: var(--border-radius);
  border-top-left-radius: var(--border-radius);
}
article > footer {
  margin-top: var(--block-spacing-vertical);
  margin-bottom: calc(var(--block-spacing-vertical) * -1);
  border-top: var(--border-width) solid var(--card-border-color);
  border-bottom-right-radius: var(--border-radius);
  border-bottom-left-radius: var(--border-radius);
}

/**
 * Modal (<dialog>)
 */
#mount {
  --scrollbar-width: 0px;
}

dialog {
  display: flex;
  z-index: 999;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  align-items: center;
  justify-content: center;
  width: inherit;
  min-width: 100%;
  height: inherit;
  min-height: 100%;
  padding: var(--spacing);
  border: 0;
  -webkit-backdrop-filter: var(--modal-overlay-backdrop-filter);
  backdrop-filter: var(--modal-overlay-backdrop-filter);
  background-color: var(--modal-overlay-background-color);
  color: var(--color);
}
dialog article {
  max-height: calc(100vh - var(--spacing) * 2);
  overflow: auto;
}
@media (min-width: 576px) {
  dialog article {
    max-width: 510px;
  }
}
@media (min-width: 768px) {
  dialog article {
    max-width: 700px;
  }
}
dialog article > header,
dialog article > footer {
  padding: calc(var(--block-spacing-vertical) * 0.5)
    var(--block-spacing-horizontal);
}
dialog article > header .close {
  margin: 0;
  margin-left: var(--spacing);
  float: right;
}
dialog article > footer {
  text-align: right;
}
dialog article > footer [role="button"] {
  margin-bottom: 0;
}
dialog article > footer [role="button"]:not(:first-of-type) {
  margin-left: calc(var(--spacing) * 0.5);
}
dialog article p:last-of-type {
  margin: 0;
}
dialog article .close {
  display: block;
  width: 1rem;
  height: 1rem;
  margin-top: calc(var(--block-spacing-vertical) * -0.5);
  margin-bottom: var(--typography-spacing-vertical);
  margin-left: auto;
  background-image: var(--icon-close);
  background-position: center;
  background-size: auto 1rem;
  background-repeat: no-repeat;
  opacity: 0.5;
  transition: opacity var(--transition);
}
dialog article .close:is([aria-current], :hover, :active, :focus) {
  opacity: 1;
}
dialog:not([open]),
dialog[open="false"] {
  display: none;
}

.modal-is-open {
  padding-right: var(--scrollbar-width, 0px);
  overflow: hidden;
  pointer-events: none;
}
.modal-is-open dialog {
  pointer-events: auto;
}

:where(.modal-is-opening, .modal-is-closing) dialog,
:where(.modal-is-opening, .modal-is-closing) dialog > article {
  animation-duration: 0.2s;
  animation-timing-function: ease-in-out;
  animation-fill-mode: both;
}
:where(.modal-is-opening, .modal-is-closing) dialog {
  animation-duration: 0.8s;
  animation-name: modal-overlay;
}
:where(.modal-is-opening, .modal-is-closing) dialog > article {
  animation-delay: 0.2s;
  animation-name: modal;
}

.modal-is-closing dialog,
.modal-is-closing dialog > article {
  animation-delay: 0s;
  animation-direction: reverse;
}

@keyframes modal-overlay {
  from {
    -webkit-backdrop-filter: none;
    backdrop-filter: none;
    background-color: transparent;
  }
}
@keyframes modal {
  from {
    transform: translateY(-100%);
    opacity: 0;
  }
}
/**
 * Nav
 */
:where(nav li)::before {
  float: left;
  content: "​";
}

nav,
nav ul {
  display: flex;
}

nav {
  justify-content: space-between;
}
nav ol,
nav ul {
  align-items: center;
  margin-bottom: 0;
  padding: 0;
  list-style: none;
}
nav ol:first-of-type,
nav ul:first-of-type {
  margin-left: calc(var(--nav-element-spacing-horizontal) * -1);
}
nav ol:last-of-type,
nav ul:last-of-type {
  margin-right: calc(var(--nav-element-spacing-horizontal) * -1);
}
nav li {
  display: inline-block;
  margin: 0;
  padding: var(--nav-element-spacing-vertical)
    var(--nav-element-spacing-horizontal);
}
nav li > * {
  --spacing: 0;
}
nav :where(a, [role="link"]) {
  display: inline-block;
  margin: calc(var(--nav-link-spacing-vertical) * -1)
    calc(var(--nav-link-spacing-horizontal) * -1);
  padding: var(--nav-link-spacing-vertical) var(--nav-link-spacing-horizontal);
  border-radius: var(--border-radius);
  text-decoration: none;
}
nav :where(a, [role="link"]):is([aria-current], :hover, :active, :focus) {
  text-decoration: none;
}
nav[aria-label="breadcrumb"] {
  align-items: center;
  justify-content: start;
}
nav[aria-label="breadcrumb"] ul li:not(:first-child) {
  -webkit-margin-start: var(--nav-link-spacing-horizontal);
  margin-inline-start: var(--nav-link-spacing-horizontal);
}
nav[aria-label="breadcrumb"] ul li:not(:last-child) ::after {
  position: absolute;
  width: calc(var(--nav-link-spacing-horizontal) * 2);
  -webkit-margin-start: calc(var(--nav-link-spacing-horizontal) / 2);
  margin-inline-start: calc(var(--nav-link-spacing-horizontal) / 2);
  content: "/";
  color: var(--muted-color);
  text-align: center;
}
nav[aria-label="breadcrumb"] a[aria-current] {
  background-color: transparent;
  color: inherit;
  text-decoration: none;
  pointer-events: none;
}
nav [role="button"] {
  margin-right: inherit;
  margin-left: inherit;
  padding: var(--nav-link-spacing-vertical) var(--nav-link-spacing-horizontal);
}

aside nav,
aside ol,
aside ul,
aside li {
  display: block;
}
aside li {
  padding: calc(var(--nav-element-spacing-vertical) * 0.5)
    var(--nav-element-spacing-horizontal);
}
aside li a {
  display: block;
}
aside li [role="button"] {
  margin: inherit;
}

[dir="rtl"] nav[aria-label="breadcrumb"] ul li:not(:last-child) ::after {
  content: "\\";
}

/**
 * Progress
 */
progress {
  display: inline-block;
  vertical-align: baseline;
}

progress {
  -webkit-appearance: none;
  -moz-appearance: none;
  display: inline-block;
  appearance: none;
  width: 100%;
  height: 0.5rem;
  margin-bottom: calc(var(--spacing) * 0.5);
  overflow: hidden;
  border: 0;
  border-radius: var(--border-radius);
  background-color: var(--progress-background-color);
  color: var(--progress-color);
}
progress::-webkit-progress-bar {
  border-radius: var(--border-radius);
  background: none;
}
progress[value]::-webkit-progress-value {
  background-color: var(--progress-color);
}
progress::-moz-progress-bar {
  background-color: var(--progress-color);
}
@media (prefers-reduced-motion: no-preference) {
  progress:indeterminate {
    background: var(--progress-background-color)
      linear-gradient(
        to right,
        var(--progress-color) 30%,
        var(--progress-background-color) 30%
      )
      top left/150% 150% no-repeat;
    animation: progress-indeterminate 1s linear infinite;
  }
  progress:indeterminate[value]::-webkit-progress-value {
    background-color: transparent;
  }
  progress:indeterminate::-moz-progress-bar {
    background-color: transparent;
  }
}

@media (prefers-reduced-motion: no-preference) {
  [dir="rtl"] progress:indeterminate {
    animation-direction: reverse;
  }
}

@keyframes progress-indeterminate {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}
/**
 * Dropdown ([role="list"])
 */
details[role="list"],
li[role="list"] {
  position: relative;
}

details[role="list"] summary + ul,
li[role="list"] > ul {
  display: flex;
  z-index: 99;
  position: absolute;
  top: auto;
  right: 0;
  left: 0;
  flex-direction: column;
  margin: 0;
  padding: 0;
  border: var(--border-width) solid var(--dropdown-border-color);
  border-radius: var(--border-radius);
  border-top-right-radius: 0;
  border-top-left-radius: 0;
  background-color: var(--dropdown-background-color);
  box-shadow: var(--card-box-shadow);
  color: var(--dropdown-color);
  white-space: nowrap;
}
details[role="list"] summary + ul li,
li[role="list"] > ul li {
  width: 100%;
  margin-bottom: 0;
  padding: calc(var(--form-element-spacing-vertical) * 0.5)
    var(--form-element-spacing-horizontal);
  list-style: none;
}
details[role="list"] summary + ul li:first-of-type,
li[role="list"] > ul li:first-of-type {
  margin-top: calc(var(--form-element-spacing-vertical) * 0.5);
}
details[role="list"] summary + ul li:last-of-type,
li[role="list"] > ul li:last-of-type {
  margin-bottom: calc(var(--form-element-spacing-vertical) * 0.5);
}
details[role="list"] summary + ul li a,
li[role="list"] > ul li a {
  display: block;
  margin: calc(var(--form-element-spacing-vertical) * -0.5)
    calc(var(--form-element-spacing-horizontal) * -1);
  padding: calc(var(--form-element-spacing-vertical) * 0.5)
    var(--form-element-spacing-horizontal);
  overflow: hidden;
  color: var(--dropdown-color);
  text-decoration: none;
  text-overflow: ellipsis;
}
details[role="list"] summary + ul li a:hover,
li[role="list"] > ul li a:hover {
  background-color: var(--dropdown-hover-background-color);
}

details[role="list"] summary::after,
li[role="list"] > a::after {
  display: block;
  width: 1rem;
  height: calc(1rem * var(--line-height, 1.5));
  -webkit-margin-start: 0.5rem;
  margin-inline-start: 0.5rem;
  float: right;
  transform: rotate(0deg);
  background-position: right center;
  background-size: 1rem auto;
  background-repeat: no-repeat;
  content: "";
}

details[role="list"] {
  padding: 0;
  border-bottom: none;
}
details[role="list"] summary {
  margin-bottom: 0;
}
details[role="list"] summary:not([role]) {
  height: calc(
    1rem * var(--line-height) + var(--form-element-spacing-vertical) * 2 +
      var(--border-width) * 2
  );
  padding: var(--form-element-spacing-vertical)
    var(--form-element-spacing-horizontal);
  border: var(--border-width) solid var(--form-element-border-color);
  border-radius: var(--border-radius);
  background-color: var(--form-element-background-color);
  color: var(--form-element-placeholder-color);
  line-height: inherit;
  cursor: pointer;
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}
details[role="list"] summary:not([role]):active,
details[role="list"] summary:not([role]):focus {
  border-color: var(--form-element-active-border-color);
  background-color: var(--form-element-active-background-color);
}
details[role="list"] summary:not([role]):focus {
  box-shadow: 0 0 0 var(--outline-width) var(--form-element-focus-color);
}
details[role="list"][open] summary {
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
details[role="list"][open] summary::before {
  display: block;
  z-index: 1;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: none;
  content: "";
  cursor: default;
}

nav details[role="list"] summary,
nav li[role="list"] a {
  display: flex;
  direction: ltr;
}

nav details[role="list"] summary + ul,
nav li[role="list"] > ul {
  min-width: -moz-fit-content;
  min-width: fit-content;
  border-radius: var(--border-radius);
}
nav details[role="list"] summary + ul li a,
nav li[role="list"] > ul li a {
  border-radius: 0;
}

nav details[role="list"] summary,
nav details[role="list"] summary:not([role]) {
  height: auto;
  padding: var(--nav-link-spacing-vertical) var(--nav-link-spacing-horizontal);
}
nav details[role="list"][open] summary {
  border-radius: var(--border-radius);
}
nav details[role="list"] summary + ul {
  margin-top: var(--outline-width);
  -webkit-margin-start: 0;
  margin-inline-start: 0;
}
nav details[role="list"] summary[role="link"] {
  margin-bottom: calc(var(--nav-link-spacing-vertical) * -1);
  line-height: var(--line-height);
}
nav details[role="list"] summary[role="link"] + ul {
  margin-top: calc(var(--nav-link-spacing-vertical) + var(--outline-width));
  -webkit-margin-start: calc(var(--nav-link-spacing-horizontal) * -1);
  margin-inline-start: calc(var(--nav-link-spacing-horizontal) * -1);
}

li[role="list"]:hover > ul,
li[role="list"] a:active ~ ul,
li[role="list"] a:focus ~ ul {
  display: flex;
}
li[role="list"] > ul {
  display: none;
  margin-top: calc(var(--nav-link-spacing-vertical) + var(--outline-width));
  -webkit-margin-start: calc(
    var(--nav-element-spacing-horizontal) - var(--nav-link-spacing-horizontal)
  );
  margin-inline-start: calc(
    var(--nav-element-spacing-horizontal) - var(--nav-link-spacing-horizontal)
  );
}
li[role="list"] > a::after {
  background-image: var(--icon-chevron);
}

/**
 * Loading ([aria-busy=true])
 */
[aria-busy="true"] {
  cursor: progress;
}

[aria-busy="true"]:not(input, select, textarea)::before {
  display: inline-block;
  width: 1em;
  height: 1em;
  border: 0.1875em solid currentColor;
  border-radius: 1em;
  border-right-color: transparent;
  content: "";
  vertical-align: text-bottom;
  vertical-align: -0.125em;
  animation: spinner 0.75s linear infinite;
  opacity: var(--loading-spinner-opacity);
}
[aria-busy="true"]:not(input, select, textarea):not(:empty)::before {
  margin-right: calc(var(--spacing) * 0.5);
  margin-left: 0;
  -webkit-margin-start: 0;
  margin-inline-start: 0;
  -webkit-margin-end: calc(var(--spacing) * 0.5);
  margin-inline-end: calc(var(--spacing) * 0.5);
}
[aria-busy="true"]:not(input, select, textarea):empty {
  text-align: center;
}

button[aria-busy="true"],
input[type="submit"][aria-busy="true"],
input[type="button"][aria-busy="true"],
input[type="reset"][aria-busy="true"],
a[aria-busy="true"] {
  pointer-events: none;
}

@keyframes spinner {
  to {
    transform: rotate(360deg);
  }
}
/**
 * Tooltip ([data-tooltip])
 */
[data-tooltip] {
  position: relative;
}
[data-tooltip]:not(a, button, input) {
  border-bottom: 1px dotted;
  text-decoration: none;
  cursor: help;
}
[data-tooltip][data-placement="top"]::before,
[data-tooltip][data-placement="top"]::after,
[data-tooltip]::before,
[data-tooltip]::after {
  display: block;
  z-index: 99;
  position: absolute;
  bottom: 100%;
  left: 50%;
  padding: 0.25rem 0.5rem;
  overflow: hidden;
  transform: translate(-50%, -0.25rem);
  border-radius: var(--border-radius);
  background: var(--tooltip-background-color);
  content: attr(data-tooltip);
  color: var(--tooltip-color);
  font-style: normal;
  font-weight: var(--font-weight);
  font-size: 0.875rem;
  text-decoration: none;
  text-overflow: ellipsis;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
}
[data-tooltip][data-placement="top"]::after,
[data-tooltip]::after {
  padding: 0;
  transform: translate(-50%, 0rem);
  border-top: 0.3rem solid;
  border-right: 0.3rem solid transparent;
  border-left: 0.3rem solid transparent;
  border-radius: 0;
  background-color: transparent;
  content: "";
  color: var(--tooltip-background-color);
}
[data-tooltip][data-placement="bottom"]::before,
[data-tooltip][data-placement="bottom"]::after {
  top: 100%;
  bottom: auto;
  transform: translate(-50%, 0.25rem);
}
[data-tooltip][data-placement="bottom"]:after {
  transform: translate(-50%, -0.3rem);
  border: 0.3rem solid transparent;
  border-bottom: 0.3rem solid;
}
[data-tooltip][data-placement="left"]::before,
[data-tooltip][data-placement="left"]::after {
  top: 50%;
  right: 100%;
  bottom: auto;
  left: auto;
  transform: translate(-0.25rem, -50%);
}
[data-tooltip][data-placement="left"]:after {
  transform: translate(0.3rem, -50%);
  border: 0.3rem solid transparent;
  border-left: 0.3rem solid;
}
[data-tooltip][data-placement="right"]::before,
[data-tooltip][data-placement="right"]::after {
  top: 50%;
  right: auto;
  bottom: auto;
  left: 100%;
  transform: translate(0.25rem, -50%);
}
[data-tooltip][data-placement="right"]:after {
  transform: translate(-0.3rem, -50%);
  border: 0.3rem solid transparent;
  border-right: 0.3rem solid;
}
[data-tooltip]:focus::before,
[data-tooltip]:focus::after,
[data-tooltip]:hover::before,
[data-tooltip]:hover::after {
  opacity: 1;
}
@media (hover: hover) and (pointer: fine) {
  [data-tooltip][data-placement="bottom"]:focus::before,
  [data-tooltip][data-placement="bottom"]:focus::after,
  [data-tooltip][data-placement="bottom"]:hover [data-tooltip]:focus::before,
  [data-tooltip][data-placement="bottom"]:hover [data-tooltip]:focus::after,
  [data-tooltip]:hover::before,
  [data-tooltip]:hover::after {
    animation-duration: 0.2s;
    animation-name: tooltip-slide-top;
  }
  [data-tooltip][data-placement="bottom"]:focus::after,
  [data-tooltip][data-placement="bottom"]:hover [data-tooltip]:focus::after,
  [data-tooltip]:hover::after {
    animation-name: tooltip-caret-slide-top;
  }
  [data-tooltip][data-placement="bottom"]:focus::before,
  [data-tooltip][data-placement="bottom"]:focus::after,
  [data-tooltip][data-placement="bottom"]:hover::before,
  [data-tooltip][data-placement="bottom"]:hover::after {
    animation-duration: 0.2s;
    animation-name: tooltip-slide-bottom;
  }
  [data-tooltip][data-placement="bottom"]:focus::after,
  [data-tooltip][data-placement="bottom"]:hover::after {
    animation-name: tooltip-caret-slide-bottom;
  }
  [data-tooltip][data-placement="left"]:focus::before,
  [data-tooltip][data-placement="left"]:focus::after,
  [data-tooltip][data-placement="left"]:hover::before,
  [data-tooltip][data-placement="left"]:hover::after {
    animation-duration: 0.2s;
    animation-name: tooltip-slide-left;
  }
  [data-tooltip][data-placement="left"]:focus::after,
  [data-tooltip][data-placement="left"]:hover::after {
    animation-name: tooltip-caret-slide-left;
  }
  [data-tooltip][data-placement="right"]:focus::before,
  [data-tooltip][data-placement="right"]:focus::after,
  [data-tooltip][data-placement="right"]:hover::before,
  [data-tooltip][data-placement="right"]:hover::after {
    animation-duration: 0.2s;
    animation-name: tooltip-slide-right;
  }
  [data-tooltip][data-placement="right"]:focus::after,
  [data-tooltip][data-placement="right"]:hover::after {
    animation-name: tooltip-caret-slide-right;
  }
}
@keyframes tooltip-slide-top {
  from {
    transform: translate(-50%, 0.75rem);
    opacity: 0;
  }
  to {
    transform: translate(-50%, -0.25rem);
    opacity: 1;
  }
}
@keyframes tooltip-caret-slide-top {
  from {
    opacity: 0;
  }
  50% {
    transform: translate(-50%, -0.25rem);
    opacity: 0;
  }
  to {
    transform: translate(-50%, 0rem);
    opacity: 1;
  }
}
@keyframes tooltip-slide-bottom {
  from {
    transform: translate(-50%, -0.75rem);
    opacity: 0;
  }
  to {
    transform: translate(-50%, 0.25rem);
    opacity: 1;
  }
}
@keyframes tooltip-caret-slide-bottom {
  from {
    opacity: 0;
  }
  50% {
    transform: translate(-50%, -0.5rem);
    opacity: 0;
  }
  to {
    transform: translate(-50%, -0.3rem);
    opacity: 1;
  }
}
@keyframes tooltip-slide-left {
  from {
    transform: translate(0.75rem, -50%);
    opacity: 0;
  }
  to {
    transform: translate(-0.25rem, -50%);
    opacity: 1;
  }
}
@keyframes tooltip-caret-slide-left {
  from {
    opacity: 0;
  }
  50% {
    transform: translate(0.05rem, -50%);
    opacity: 0;
  }
  to {
    transform: translate(0.3rem, -50%);
    opacity: 1;
  }
}
@keyframes tooltip-slide-right {
  from {
    transform: translate(-0.75rem, -50%);
    opacity: 0;
  }
  to {
    transform: translate(0.25rem, -50%);
    opacity: 1;
  }
}
@keyframes tooltip-caret-slide-right {
  from {
    opacity: 0;
  }
  50% {
    transform: translate(-0.05rem, -50%);
    opacity: 0;
  }
  to {
    transform: translate(-0.3rem, -50%);
    opacity: 1;
  }
}

/**
 * Accessibility & User interaction
 */
[aria-controls] {
  cursor: pointer;
}

[aria-disabled="true"],
[disabled] {
  cursor: not-allowed;
}

[aria-hidden="false"][hidden] {
  display: initial;
}

[aria-hidden="false"][hidden]:not(:focus) {
  clip: rect(0, 0, 0, 0);
  position: absolute;
}

a,
area,
button,
input,
label,
select,
summary,
textarea,
[tabindex] {
  -ms-touch-action: manipulation;
}

[dir="rtl"] {
  direction: rtl;
}

/**
* Reduce Motion Features
*/
@media (prefers-reduced-motion: reduce) {
  *:not([aria-busy="true"]),
  :not([aria-busy="true"])::before,
  :not([aria-busy="true"])::after {
    background-attachment: initial !important;
    animation-duration: 1ms !important;
    animation-delay: -1ms !important;
    animation-iteration-count: 1 !important;
    scroll-behavior: auto !important;
    transition-delay: 0s !important;
    transition-duration: 0s !important;
  }
}

#mount#mount {
  /* --primary: rgb(227, 59, 126); */
  --primary: #ea4c89;
  --primary-hover: #f082ac;
  --icon-xia: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9IkZyYW1lIj4KPHBhdGggaWQ9IlZlY3RvciIgZD0iTTguMDAyOTEgOS42Nzk4M0wzLjgzMzM5IDUuNTEyMjFMMy4wMjUzOSA2LjMxOTgzTDguMDAzMjkgMTEuMjk1MUwxMi45NzYyIDYuMzE5ODNMMTIuMTY3OSA1LjUxMjIxTDguMDAyOTEgOS42Nzk4M1oiIGZpbGw9IiM4MzgzODMiLz4KPC9nPgo8L3N2Zz4K");
  --switch-checked-background-color: var(--primary);
}

li.select-link.select-link:hover > ul {
  display: none;
}
li.select-link.select-link > ul {
  display: none;
}
li.select-link.select-link a:focus ~ ul {
  display: none;
}

li.select-link.select-link a:active ~ ul {
  display: none;
}
li.select-link-active.select-link-active > ul {
  display: flex;
}
li.select-link-active.select-link-active:hover > ul {
  display: flex;
}

li.select-link-active.select-link-active a:focus ~ ul {
  display: flex;
}

li.select-link-active.select-link-active a:active ~ ul {
  display: flex;
}
ul.select-link-ul.select-link-ul {
  right: 0px;
  left: auto;
}

a.select-link-selected {
  background-color: var(--primary-focus);
}
.immersive-translate-no-select {
  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none; /* Safari */
  -khtml-user-select: none; /* Konqueror HTML */
  -moz-user-select: none; /* Old versions of Firefox */
  -ms-user-select: none; /* Internet Explorer/Edge */
  user-select: none;
}

/* li[role="list"].no-arrow > a::after { */
/*   background-image: none; */
/*   width: 0; */
/*   color: var(--color); */
/* } */
li[role="list"].no-arrow {
  margin-left: 8px;
  padding-right: 0;
}
li[role="list"] > a::after {
  -webkit-margin-start: 0.2rem;
  margin-inline-start: 0.2rem;
}

li[role="list"].no-arrow > a,
li[role="list"].no-arrow > a:link,
li[role="list"].no-arrow > a:visited {
  color: var(--secondary);
}

select.min-select {
  --form-element-spacing-horizontal: 0;
  margin-bottom: 4px;
  max-width: 128px;
  overflow: hidden;
  color: var(--primary);
  font-size: 13px;
  border: none;
  padding: 0;
  padding-right: 20px;
  padding-left: 8px;
  text-overflow: ellipsis;
  color: var(--color);

}
select.min-select-secondary {
  color: var(--color);
}
select.min-select:focus {
  outline: none;
  border: none;
  --box-shadow: none;
}
select.min-select-no-arrow {
  background-image: none;
  padding-right: 0;
}

select.min-select-left {
  padding-right: 0px;
  /* padding-left: 24px; */
  /* background-position: center left 0; */
  text-overflow: ellipsis;
  text-align: left;
}

.muted {
  color: var(--muted-color);
}

.select.button-select {
  --background-color: var(--secondary-hover);
  --border-color: var(--secondary-hover);
  --color: var(--secondary-inverse);
  cursor: pointer;
  --box-shadow: var(--button-box-shadow, 0 0 0 rgba(0, 0, 0, 0));
  padding: var(--form-element-spacing-vertical)
    var(--form-element-spacing-horizontal);
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  font-size: 16px;
  line-height: var(--line-height);
  text-align: center;
  cursor: pointer;
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
  -webkit-appearance: button;
  margin: 0;
  margin-bottom: 0px;
  overflow: visible;
  font-family: inherit;
  text-transform: none;
}

html {
  font-size: 16px;
  --font-size: 16px;
}

body {
  padding: 0;
  margin: 0 auto;
  min-width: 268px;
  border-radius: 10px;
}

.popup-container {
  color: #666;
  background-color: var(--popup-footer-background-color);
  width: 316px;
  min-width: 316px;
}

.popup-content {
  background-color: var(--popup-content-background-color);
  border-radius: 0px 0px 12px 12px;
  padding: 16px 20px;
}

.immersive-translate-popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  touch-action: none;
}

.immersive-translate-popup-wrapper {
  background: var(--background-color);
  border-radius: 10px;
  border: 1px solid var(--muted-border-color);
}

#mount#mount {
  --font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
    "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  --line-height: 1.5;
  --font-weight: 400;
  --font-size: 16px;
  --border-radius: 4px;
  --border-width: 1px;
  --outline-width: 3px;
  --spacing: 16px;
  --typography-spacing-vertical: 24px;
  --block-spacing-vertical: calc(var(--spacing) * 2);
  --block-spacing-horizontal: var(--spacing);
  --grid-spacing-vertical: 0;
  --grid-spacing-horizontal: var(--spacing);
  --form-element-spacing-vertical: 12px;
  --form-element-spacing-horizontal: 16px;
  --nav-element-spacing-vertical: 16px;
  --nav-element-spacing-horizontal: 8px;
  --nav-link-spacing-vertical: 8px;
  --nav-link-spacing-horizontal: 8px;
  --form-label-font-weight: var(--font-weight);
  --transition: 0.2s ease-in-out;
  --modal-overlay-backdrop-filter: blur(4px);
}

[data-theme="light"],
#mount:not([data-theme="dark"]) {
  --popup-footer-background-color: #e8eaeb;
  --popup-content-background-color: #ffffff;
  --popup-item-background-color: #f3f5f6;
  --popup-item-hover-background-color: #eaeced;
  --popup-trial-pro-background-color: #F9FBFC;
  --text-black-2: #222222;
  --text-gray-2: #222222;
  --text-gray-6: #666666;
  --text-gray-9: #999999;
  --text-gray-c2: #c2c2c2;
  --service-select-content-shadow: 0px 2px 12px 0px rgba(75, 76, 77, 0.20);
  --service-select-border-color: #FAFAFA;
  --service-select-selected-background-color: #F3F5F6;
}

@media only screen and (prefers-color-scheme: dark) {
  #mount:not([data-theme="light"]) {
    --popup-footer-background-color: #0d0d0d;
    --popup-content-background-color: #191919;
    --popup-item-background-color: #272727;
    --popup-item-hover-background-color: #333333;
    --popup-trial-pro-background-color: #222222;
    --text-black-2: #ffffff;
    --text-gray-2: #dbdbdb;
    --text-gray-6: #b3b3b3;
    --text-gray-9: #777777;
    --text-gray-c2: #5b5b5b;
    --service-select-content-shadow: 0px 2px 12px 0px rgba(0, 0, 0, 0.90);
    --service-select-border-color: #2C2C2C;
    --service-select-selected-background-color: #333333;
  }
}

[data-theme="dark"] {
  --popup-footer-background-color: #0d0d0d;
  --popup-content-background-color: #191919;
  --popup-item-background-color: #272727;
  --popup-item-hover-background-color: #333333;
  --popup-trial-pro-background-color: #222222;
  --text-black-2: #ffffff;
  --text-gray-2: #dbdbdb;
  --text-gray-6: #b3b3b3;
  --text-gray-9: #777777;
  --text-gray-c2: #5b5b5b;
  --service-select-content-shadow: 0px 2px 12px 0px rgba(0, 0, 0, 0.90);
  --service-select-border-color: #2C2C2C;
  --service-select-selected-background-color: #333333;
}

.text-balck {
  color: var(--text-black-2);
}

.text-gray-2 {
  color: var(--text-gray-2);
}

.text-gray-6 {
  color: var(--text-gray-6);
}

.text-gray-9 {
  color: var(--text-gray-9);
}

.text-gray-c2 {
  color: var(--text-gray-c2);
}

#mount {
  min-width: 268px;
}

.main-button {
  font-size: 15px;
  vertical-align: middle;
  border-radius: 12px;
  padding: unset;
  height: 44px;
  line-height: 44px;
}

.pt-4 {
  padding-top: 16px;
}

.p-2 {
  padding: 8px;
}

.pl-5 {
  padding-left: 48px;
}

.p-0 {
  padding: 0;
}

.pl-2 {
  padding-left: 8px;
}

.pl-4 {
  padding-left: 24px;
}

.pt-2 {
  padding-top: 8px;
}

.pb-2 {
  padding-bottom: 8px;
}

.pb-4 {
  padding-bottom: 16px;
}

.pb-5 {
  padding-bottom: 20px;
}

.pr-5 {
  padding-right: 48px;
}

.text-sm {
  font-size: 13px;
}

.text-base {
  font-size: 16px;
}

.w-full {
  width: 100%;
}

.flex {
  display: flex;
}

.flex-row {
  flex-direction: row;
}

.flex-wrap {
  flex-wrap: wrap;
}

.flex-end {
  justify-content: flex-end;
}

.flex-grow {
  flex-grow: 1;
}

.justify-between {
  justify-content: space-between;
}

.mb-0 {
  margin-bottom: 0px;
}

.mb-2 {
  margin-bottom: 8px;
}

.mb-4 {
  margin-bottom: 16px;
}

.mb-3 {
  margin-bottom: 12px;
}

.inline-block {
  display: inline-block;
}

.py-2 {
  padding-top: 8px;
  padding-bottom: 8px;
}

.py-2-5 {
  padding-top: 6px;
  padding-bottom: 6px;
}

.mt-0 {
  margin-top: 0;
}

.mt-2 {
  margin-top: 8px;
}

.mt-3 {
  margin-top: 12px;
}

.mt-4 {
  margin-top: 16px;
}

.mt-5 {
  margin-top: 20px;
}

.mt-6 {
  margin-top: 24px;
}

.mb-1 {
  margin-bottom: 4px;
}

.ml-4 {
  margin-left: 24px;
}

.ml-3 {
  margin-left: 16px;
}

.ml-2 {
  margin-left: 8px;
}

.ml-1 {
  margin-left: 4px;
}

.mr-1 {
  margin-right: 4px;
}

.mr-2 {
  margin-right: 8px;
}

.mr-3 {
  margin-right: 16px;
}

.mx-2 {
  margin-left: 8px;
  margin-right: 8px;
}

.pl-3 {
  padding-left: 12px;
}

.pr-3 {
  padding-right: 12px;
}

.p-3 {
  padding: 12px;
}

.px-1 {
  padding-left: 4px;
  padding-right: 4px;
}

.px-3 {
  padding-left: 12px;
  padding-right: 12px;
}

.pt-3 {
  padding-top: 12px;
}

.px-6 {
  padding-left: 18px;
  padding-right: 18px;
}

.px-4 {
  padding-left: 16px;
  padding-right: 16px;
}

.pt-6 {
  padding-top: 20px;
}

.py-3 {
  padding-top: 12px;
  padding-bottom: 12px;
}

.py-0 {
  padding-top: 0;
  padding-bottom: 0;
}

.left-auto {
  left: auto !important;
}

.max-h-28 {
  max-height: 112px;
}

.max-h-30 {
  max-height: 120px;
}

.overflow-y-scroll {
  overflow-y: scroll;
}

.text-xs {
  font-size: 12px;
}

.flex-1 {
  flex: 1;
}

.flex-3 {
  flex: 3;
}

.flex-4 {
  flex: 4;
}

.flex-2 {
  flex: 2;
}

.items-center {
  align-items: center;
}

.max-content {
  width: max-content;
}

.justify-center {
  justify-content: center;
}

.items-end {
  align-items: flex-end;
}

.items-baseline {
  align-items: baseline;
}

.my-5 {
  margin-top: 48px;
  margin-bottom: 48px;
}

.my-4 {
  margin-top: 24px;
  margin-bottom: 24px;
}

.my-3 {
  margin-top: 16px;
  margin-bottom: 16px;
}

.pt-3 {
  padding-top: 12px;
}

.px-3 {
  padding-left: 12px;
  padding-right: 12px;
}

.pt-2 {
  padding-top: 8px;
}

.px-2 {
  padding-left: 8px;
  padding-right: 8px;
}

.pt-1 {
  padding-top: 4px;
}

.px-1 {
  padding-left: 4px;
  padding-right: 4px;
}

.pb-2 {
  padding-bottom: 8px;
}

.justify-end {
  justify-content: flex-end;
}

.w-auto {
  width: auto;
}

.shrink-0 {
  flex-shrink: 0;
}

select.language-select,
select.translate-service,
select.min-select {
  --form-element-spacing-horizontal: 0;
  margin-bottom: 0px;
  max-width: unset;
  flex: 1;
  overflow: hidden;
  font-size: 13px;
  border: none;
  border-radius: 8px;
  padding-right: 30px;
  padding-left: 0px;
  background-position: center right 12px;
  background-size: 16px auto;
  background-image: var(--icon-xia);
  text-overflow: ellipsis;
  color: var(--text-gray-2);
  background-color: transparent;
  box-shadow: unset !important;
  cursor: pointer;
}

select.more {
  background-position: center right;
  padding-right: 20px;
}

select.transform-padding-left {
  padding-left: 12px;
  transform: translateX(-12px);
  background-position: center right 0px;
}

select.translate-service {
  color: var(--text-black-2);
}

/* dark use black, for windows */
@media (prefers-color-scheme: dark) {

  select.language-select option,
  select.translate-service option,
  select.min-select option {
    background-color: #666666;
  }
}

.text-overflow-ellipsis {
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.max-w-20 {
  max-width: 180px;
  white-space: nowrap;
}

select.min-select-secondary {
  color: var(--color);
}

select.min-select:focus {
  outline: none;
  border: none;
  --box-shadow: none;
}

select.min-select-no-arrow {
  background-image: none;
  padding-right: 0;
}

select.min-select-left {
  padding-right: 0px;
  /* padding-left: 24px; */
  /* background-position: center left 0; */
  text-overflow: ellipsis;
  text-align: left;
}

.popup-footer {
  background-color: var(--popup-footer-background-color);
  height: 40px;
}

.text-right {
  text-align: right;
}

.clickable {
  cursor: pointer;
}

.close {
  cursor: pointer;
  width: 16px;
  height: 16px;
  background-image: var(--icon-close);
  background-position: center;
  background-size: auto 1rem;
  background-repeat: no-repeat;
  opacity: 0.5;
  transition: opacity var(--transition);
}

.padding-two-column {
  padding-left: 40px;
  padding-right: 40px;
}

.muted {
  color: #999;
}

.text-label {
  color: #666;
}

.display-none {
  display: none;
}

/* dark use #18232c */
@media (prefers-color-scheme: dark) {
  .text-label {
    color: #9ca3af;
  }
}

.text-decoration-none {
  text-decoration: none;
}

.text-decoration-none:is([aria-current], :hover, :active, :focus),
[role="link"]:is([aria-current], :hover, :active, :focus) {
  --text-decoration: none !important;
  background-color: transparent !important;
}

.language-select-container {
  position: relative;
  width: 100%;
  background-color: var(--popup-item-background-color);
  height: 55px;
  border-radius: 12px;
}

select.language-select {
  color: var(--text-black-2);
  font-size: 14px;
  padding: 8px 24px 24px 16px;
  position: absolute;
  border-radius: 12px;
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
}

select.text-gray-6 {
  color: var(--text-gray-6);
}

.language-select-container label {
  position: absolute;
  bottom: 10px;
  left: 16px;
  font-size: 12px;
  color: var(--text-gray-9);
  line-height: 12px;
  margin: 0;
}

.translation-service-container {
  background-color: var(--popup-item-background-color);
  border-radius: 12px;
}

.min-select-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 44px;
  background-color: var(--popup-item-background-color);
  padding-left: 16px;
}

.min-select-container:first-child {
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

.min-select-container:last-child {
  border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px;
}

.min-select-container:only-child {
  border-radius: 10px;
}

.translate-mode {
  width: 44px;
  height: 44px;
  border-radius: 22px;
  background-color: var(--popup-item-background-color);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
}

.translate-mode svg {
  fill: var(--text-gray-2);
}

.widgets-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.widgets-container> :not(:last-child) {
  margin-right: 8px;
}

.widget-item {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--popup-item-background-color);
  font-size: 12px;
  height: 44px;
  border-radius: 8px;
  cursor: pointer;
  flex: 1;
}

.widget-item svg {
  fill: var(--text-gray-2);
}

.setting svg {
  fill: var(--text-gray-6);
}

.share-button-container {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 2px 3px 0 8px;
}

.share-button-container svg {
  fill: var(--text-gray-9);
}

.min-select-container:hover,
.language-select-container:hover,
.widget-item:hover,
.translate-mode:hover {
  background-color: var(--popup-item-hover-background-color);
}

.main-button:hover {
  background-color: #f5508f;
}

.share-button-container:hover {
  background-color: var(--popup-item-background-color);
  border-radius: 6px;
}

.error-boundary {
  background: #fff2f0;
  border: 1px solid #ffccc7;
  display: flex;
  padding: 12px;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.88);
  word-break: break-all;
  margin: 12px;
  border-radius: 12px;
  flex-direction: column;
}


.upgrade-pro {
  border-radius: 11px;
  background: linear-gradient(57deg, #272727 19.8%, #696969 82.2%);
  padding: 2px 8px;
  transform: scale(0.85);
}

.upgrade-pro span {
  background: linear-gradient(180deg, #FFEAB4 17.65%, #F8C235 85.29%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-size: 12px;
  margin-left: 4px;
}


.upgrade-pro svg {
  margin-top: -2px;
}

.upgrade-pro:hover {
  background: linear-gradient(57deg, #3D3D3D 19.8%, #949494 82.2%);
}

.border-bottom-radius-0 {
  border-bottom-left-radius: 0 !important;
  border-bottom-right-radius: 0 !important;
}

.trial-pro-container {
  border-radius: 0px 0px 12px 12px;
  background: var(--popup-trial-pro-background-color);
  display: flex;
  align-items: center;
  height: 44px;
  padding-left: 16px;
  padding-right: 12px;
  font-size: 12px;
}

.trial-pro-container label {
  line-height: 13px;
  color: var(--text-black-2);
}

.trial-pro-container img {
  margin-left: 5px;
}

.cursor-pointer {
  cursor: pointer;
}

.upgrade-pro-discount-act {
  height: 25px;
  display: flex;
  padding: 0 4px;
  align-items: center;
  border-radius: 15px;
  background: linear-gradient(90deg, #CEFBFA 11.33%, #D7F56F 63.75%, #FCCD5E 100%);
  transform: scale(0.9);
  box-shadow: 0px 1.8px 3.6px 0px rgba(0, 0, 0, 0.10);
  cursor: pointer;
}

.upgrade-pro-discount-act span {
  font-size: 12px;
  font-weight: 700;
  margin-left: 4px;
  color: #222222;
}

.upgrade-pro-discount-act:hover {
  text-decoration: unset;
  background: linear-gradient(90deg, #E2FFFE 11.33%, #E6FF91 63.75%, #FFDF93 100%);
}


.custom-select-container {
  width: 200px;
  position: relative;
  flex: 1;
}

.custom-select-content {
  border-radius: 12px;
  background: var(--popup-content-background-color);
  box-shadow: var(--service-select-content-shadow);
  border: 1px solid var(--service-select-border-color);
  padding: 4px 5px;
  position: absolute;
  left: 0;
  right: 0;
  z-index: 100;
  overflow-y: auto;
}

.custom-select-item {
  font-size: 13px;
  padding: 5px 6px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  cursor: pointer;
  color: var(--text-black-2);
  width: 100%;
  overflow: hidden;
  height: 30px;
  line-height: 30px;
}

.custom-select-item-img {
  width: 20px;
  height: 20px;
  margin-right: 4px;
}

@media (prefers-color-scheme: dark) {
  .custom-select-item-img {
    margin-right: 6px;
  }
}


.custom-select-content .custom-select-item.selected, .custom-select-content .custom-select-item:hover {
  background: var(--service-select-selected-background-color);
}

.custom-select-item > span {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.custom-select-item-pro {
  font-size: 12px;
  margin-left: 6px;
}

.custom-select-item-pro img {
  margin:  0 3px;
  width: 20px;
}


html {
  font-size: 17px;
}

@media print {
  .imt-fb-container {
    display: none !important;
  }
}

#mount#mount {
  position: absolute;
  display: none;
  min-width: 250px;
  height: auto;
  --font-size: 17px;
  font-size: 17px;
}

/* float-ball */
.imt-fb-container {
  position: fixed;
  padding: 0;
  z-index: 2147483647;
  top: 335px;
  width: 56px;
  display: flex;
  flex-direction: column;
  display: none;
}

.imt-fb-container.left {
  align-items: flex-start;
  left: 0;
}

.imt-fb-container.right {
  align-items: flex-end;
  right: 0;
}

.imt-fb-btn {
  cursor: pointer;
  background: linear-gradient(320.9deg, #db3b7b 26.47%, #ffcee2 88.86%);
  height: 36px;
  width: 56px;
  box-shadow: 2px 6px 10px 0px #0e121629;
}

.imt-fb-btn.left {
  border-top-right-radius: 36px;
  border-bottom-right-radius: 36px;
}

.imt-fb-btn.right {
  border-top-left-radius: 36px;
  border-bottom-left-radius: 36px;
}

.imt-fb-btn div {
  background: linear-gradient(140.91deg, #ff87b7 12.61%, #ec4c8c 76.89%);
  height: 34px;
  width: 54px;
  margin: 1px;
  display: flex;
  align-items: center;
}

.imt-fb-btn.left div {
  border-top-right-radius: 34px;
  border-bottom-right-radius: 34px;
  justify-content: flex-end;
}

.imt-fb-btn.right div {
  border-top-left-radius: 34px;
  border-bottom-left-radius: 34px;
}

.imt-fb-logo-img {
  width: 20px;
  height: 20px;
  margin: 0 10px;
}

.imt-float-ball-translated {
  position: absolute;
  width: 11px;
  height: 11px;
  bottom: 4px;
  right: 20px;
}

.btn-animate {
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  -webkit-transition: -webkit-transform ease-out 250ms;
  transition: -webkit-transform ease-out 250ms;
  transition: transform ease-out 250ms;
  transition: transform ease-out 250ms, -webkit-transform ease-out 250ms;
}

.imt-fb-setting-btn {
  margin-right: 18px;
  width: 28px;
  height: 28px;
}

.immersive-translate-popup-wrapper {
  background: var(--background-color);
  border-radius: 20px;
  box-shadow: 2px 10px 24px 0px #0e121614;
  border: none;
}

.popup-container  {
  border-radius: 20px;
}

.popup-content {
  border-radius: 20px 20px 12px 12px;
}
.popup-footer {
  border-radius: 20px;
}

.imt-fb-close-content {
  padding: 22px;
  width: 320px;
}

.imt-fb-close-title {
  font-weight: 500;
  color: var(--h2-color);
}

.imt-fb-close-radio-content {
  background-color: var(--background-light-green);
  padding: 8px 20px;
}

.imt-fb-radio-sel,
.imt-fb-radio-nor {
  width: 16px;
  height: 16px;
  border-radius: 8px;
  flex-shrink: 0;
}

.imt-fb-radio-sel {
  border: 2px solid var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
}

.imt-fb-radio-sel div {
  width: 8px;
  height: 8px;
  border-radius: 4px;
  background-color: var(--primary);
}

.imt-fb-radio-nor {
  border: 2px solid #d3d4d6;
}

.imt-fb-primary-btn {
  background-color: var(--primary);
  width: 72px;
  height: 32px;
  color: white;
  border-radius: 8px;
  text-align: center;
  line-height: 32px;
  font-size: 16px;
  cursor: pointer;
}

.imt-fb-default-btn {
  border: 1px solid var(--primary);
  width: 72px;
  height: 32px;
  border-radius: 8px;
  color: var(--primary);
  line-height: 32px;
  text-align: center;
  font-size: 16px;
}

.imt-fb-guide-container {
  width: 312px;
  transform: translateY(-50%);
}

.imt-fb-guide-bg {
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  height: 100%;
  width: 100%;
}

.imt-fb-guide-bg.left {
  transform: scaleX(-1);
}

.imt-fb-guide-content {
  margin: 16px 32px 60px 21px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.imt-fb-guide-content.left {
  margin: 16px 21px 60px 32px;
}

.imt-fb-guide-img {
  width: 235px;
  height: 171px;
  margin-top: 16px;
}

.imt-fb-guide-message {
  font-size: 16px;
  line-height: 28px;
  color: #333333;
  white-space: pre-wrap;
  text-align: center;
  font-weight: 700;
  margin-top: 10px;
}

.imt-fb-guide-button {
  margin-top: 16px;
  line-height: 40px;
  height: 40px;
  padding: 0 20px;
  width: unset;
}

.imt-fb-more-buttons {
  box-shadow: 0px 2px 10px 0px #00000014;
  border: 1px solid var(--float-ball-more-button-border-color);
  background: var(--float-ball-more-button-background-color);
  width: 36px;
  display: flex;
  flex-direction: column;
  border-radius: 18px;
  margin-right: 8px;
}

.imt-fb-more-button {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}


/* Sheet.css */
.immersive-translate-sheet {
  position: fixed;
  transform: translateY(100%);
  /* Start off screen */
  left: 0;
  right: 0;
  background-color: white;
  transition: transform 0.3s ease-out;
  /* Smooth slide transition */
  box-shadow: 0px -2px 10px rgba(0, 0, 0, 0.1);
  /* Ensure it's above other content */
  bottom: 0;
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
  overflow: hidden;
}

.immersive-translate-sheet.visible {
  transform: translateY(0);
}

.immersive-translate-sheet-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  opacity: 0;
  transition: opacity 0.3s ease-out;
}

.immersive-translate-sheet-backdrop.visible {
  opacity: 1;
}

.popup-container-sheet {
  max-width: 100vw;
  width: 100vw;
}

.imt-no-events svg * {
  pointer-events: none !important;
}

.imt-manga-button {
  width: 36px;
  display: flex;
  flex-direction: column;
  position: relative;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  pointer-events: all;
  margin: 12px 0 0 0;
  background-color: white;
  border-radius: 18px;
  filter: drop-shadow(0px 2px 10px rgba(0, 0, 0, 0.08));
  opacity: 0.5;
  right: 8px;
}

.imt-manga-feedback {
  cursor: pointer;
  margin: 10px 9px 12px 9px;
}

.imt-manga-button:hover {
  opacity: 1;
}

.imt-manga-translated {
  position: absolute;
  left: 24px;
  top: 20px;
}

.imt-float-ball-loading {
  animation: imt-loading-animation 0.6s infinite linear !important;
}

.imt-manga-guide-bg {
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  width: 372px;
  transform: translateY(-50%);
}
.imt-manga-guide-content {
  position: absolute;
  top: 15px;
  left: 0;
  right: 0;
  margin: 0 40px 0;
}

.img-manga-guide-button {
  width: fit-content;
  margin: 16px auto;
}

.img-manga-close {
  position: absolute;
  bottom: -200px;
  width: 32px;
  height: 32px;
  left: 0;
  right: 0;
  margin: auto;
  cursor: pointer;
}

@-webkit-keyframes imt-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes imt-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}
</style><div id="mount" style="display: block;"><div class="imt-fb-container right notranslate" style="z-index: 2147483647; pointer-events: none; top: 411px; display: flex;"><div title="关闭悬浮球" class="btn-animate" style="transform: translateX(100%); padding: 4px; cursor: pointer;"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_2589_9951)"><path d="M7 14C5.14348 14 3.36301 13.2625 2.05025 11.9497C0.737498 10.637 0 8.85652 0 7C0 5.14348 0.737498 3.36301 2.05025 2.05025C3.36301 0.737498 5.14348 0 7 0C8.85652 0 10.637 0.737498 11.9497 2.05025C13.2625 3.36301 14 5.14348 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM4.183 5.064L6.118 7L4.183 8.936C4.12409 8.99361 4.07719 9.06234 4.04502 9.1382C4.01285 9.21406 3.99605 9.29554 3.99559 9.37794C3.99513 9.46034 4.01101 9.54201 4.04234 9.61823C4.07366 9.69444 4.11978 9.76369 4.17805 9.82195C4.23631 9.88022 4.30556 9.92634 4.38177 9.95766C4.45799 9.98898 4.53966 10.0049 4.62206 10.0044C4.70446 10.004 4.78594 9.98715 4.8618 9.95498C4.93766 9.92281 5.00639 9.87591 5.064 9.817L7 7.882L8.936 9.817C9.05327 9.93168 9.21104 9.99548 9.37506 9.99457C9.53908 9.99365 9.69612 9.92809 9.8121 9.8121C9.92809 9.69612 9.99365 9.53908 9.99457 9.37506C9.99548 9.21104 9.93168 9.05327 9.817 8.936L7.882 7L9.817 5.064C9.87591 5.00639 9.92281 4.93766 9.95498 4.8618C9.98715 4.78594 10.004 4.70446 10.0044 4.62206C10.0049 4.53966 9.98898 4.45799 9.95766 4.38177C9.92634 4.30556 9.88022 4.23631 9.82195 4.17805C9.76369 4.11978 9.69444 4.07366 9.61823 4.04234C9.54201 4.01101 9.46034 3.99513 9.37794 3.99559C9.29554 3.99605 9.21406 4.01285 9.1382 4.04502C9.06234 4.07719 8.99361 4.12409 8.936 4.183L7 6.118L5.064 4.183C4.94673 4.06832 4.78896 4.00452 4.62494 4.00543C4.46092 4.00635 4.30388 4.07191 4.1879 4.1879C4.07191 4.30388 4.00635 4.46092 4.00543 4.62494C4.00452 4.78896 4.06832 4.94673 4.183 5.064Z" fill="#B1B1B1" fill-opacity="0.32"></path></g><defs><clippath id="clip0_2589_9951"><rect width="14" height="14" fill="white"></rect></clippath></defs></svg></div><div style="position: relative; pointer-events: all; display: inline-block;"><div><div class="imt-fb-btn  right btn-animate " style="transform: translateX(20px); opacity: 0.5;"><div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" class="imt-fb-logo-img"><path fill="none" d="M0 0h24v24H0z"></path><path d="M5 15v2a2 2 0 0 0 1.85 1.995L7 19h3v2H7a4 4 0 0 1-4-4v-2h2zm13-5l4.4 11h-2.155l-1.201-3h-4.09l-1.199 3h-2.154L16 10h2zm-1 2.885L15.753 16h2.492L17 12.885zM8 2v2h4v7H8v3H6v-3H2V4h4V2h2zm9 1a4 4 0 0 1 4 4v2h-2V7a2 2 0 0 0-2-2h-3V3h3zM6 6H4v3h2V6zm4 0H8v3h2V6z" fill="rgba(255,255,255,1)"></path></svg><svg hidden="true" class="imt-float-ball-translated" width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="5.5" cy="5.5" r="5.5" fill="#68CD52"></circle><path d="M1.40857 5.87858L2.24148 5.18962L4.15344 6.64214C4.15344 6.64214 6.33547 4.15566 9.00658 2.48145L9.32541 2.87514C9.32541 2.87514 6.28665 5.55844 4.71735 9.07881L1.40857 5.87858Z" fill="white"></path></svg></div></div></div></div><div hidden="" class="imt-manga-button imt-no-events btn-animate " id="manga-button" style="transform: translateX(8px);"><svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="manhua"><path id="Vector" d="M14.8853 4.92364C14.8853 4.92364 16.3905 10.4362 22.6668 4C22.6668 4 20.3381 10.8907 25.3364 10.0843C25.3364 10.0843 22.0563 15.6994 29 18.0599C29 18.0599 22.9934 19.306 21.1617 28C21.1617 28 17.7679 24.54 14.8853 27.3549C14.8853 27.3549 13.3233 23.5724 7.33097 26.27C7.33097 26.27 10.1141 20.6549 4.83179 21.0507C4.83179 21.0507 7.16057 18.8955 3 15.9047C3 15.9047 7.50137 16.1833 6.33697 11.7117C6.33697 11.7117 10.0005 12.3421 8.66576 6.82957C8.65156 6.81491 12.4855 9.80574 14.8853 4.92364Z" fill="#EA4C89"></path><path id="Vector_2" d="M20.8599 13.7022C20.885 13.1361 20.9543 12.5713 20.9959 12.0052C21.0337 11.568 20.8107 11.2794 20.3876 11.18C20.0759 11.1013 19.7508 11.0867 19.433 11.137C19.1951 11.1945 18.9542 11.2396 18.7113 11.2721C18.2403 11.3028 17.9973 11.5275 17.9796 11.988C17.977 12.0833 17.9596 12.1777 17.928 12.268C17.3034 13.9102 16.6774 15.5499 16.0503 17.1873C16.0301 17.2401 16.0062 17.2904 15.9671 17.3776C15.7291 16.8975 15.4281 16.4898 15.2745 15.9986C14.8073 14.5152 14.3186 13.033 13.8312 11.5594C13.6826 11.1112 13.3489 10.9344 12.8754 11.0216C12.7889 11.0365 12.7008 11.0398 12.6134 11.0314C12.2241 10.9938 11.8311 11.0404 11.4623 11.1677C11.0946 11.2991 10.9498 11.557 11.0152 11.9254C11.0428 12.0371 11.0643 12.1503 11.0795 12.2643C11.1223 13.1902 11.1777 14.1087 11.2054 15.0321C11.257 16.7992 11.2117 18.5651 11.0858 20.3284C11.0644 20.6354 11.0304 20.9424 11.0228 21.2494C11.0115 21.6092 11.1613 21.7811 11.5266 21.8143C11.9976 21.8573 12.4711 21.8708 12.9421 21.9088C13.0309 21.9201 13.121 21.9003 13.1962 21.8528C13.2714 21.8053 13.3268 21.7334 13.3527 21.6497C13.3996 21.5394 13.4252 21.4216 13.4282 21.3022C13.4295 20.8258 13.4207 20.3493 13.4081 19.8741C13.393 19.3264 13.3917 18.7763 13.3438 18.231C13.2857 17.5839 13.266 16.934 13.2847 16.2847C13.2847 16.2466 13.291 16.2073 13.2985 16.1312C13.3338 16.2024 13.3514 16.2356 13.3665 16.2712C13.9017 17.5228 14.3617 18.8037 14.7443 20.1074C14.7928 20.2421 14.7928 20.3889 14.7443 20.5237C14.6322 20.8196 14.7141 21.037 14.9659 21.1377C15.4445 21.3268 15.9331 21.4926 16.4155 21.6731C16.4865 21.7033 16.566 21.7091 16.6408 21.6895C16.7157 21.6698 16.7815 21.6259 16.8273 21.565C16.9085 21.4643 16.9743 21.3526 17.0225 21.2335C17.0537 21.1374 17.0798 21.0399 17.1006 20.9412C17.3185 20.2425 17.5653 19.5499 17.7517 18.8438C17.9785 17.9723 18.2624 17.1158 18.6018 16.2798C18.6201 16.2439 18.6411 16.2094 18.6647 16.1766C18.6761 16.2319 18.6761 16.254 18.6761 16.2761C18.6345 17.59 18.5955 18.8978 18.5501 20.2056C18.5363 20.5949 18.491 20.9829 18.4809 21.3722C18.4721 21.705 18.6207 21.8708 18.9557 21.9002C19.4355 21.9432 19.9191 21.9592 20.4002 21.9973C20.4888 22.0079 20.5784 21.9875 20.653 21.9399C20.7277 21.8922 20.7827 21.8203 20.8082 21.7369C20.8531 21.6305 20.8766 21.5167 20.8775 21.4017C20.88 20.7668 20.8674 20.132 20.8674 19.4971C20.8662 19.2846 20.8687 19.0722 20.8523 18.8622C20.8158 18.3968 20.7264 17.9314 20.7339 17.4685C20.7515 16.2122 20.8044 14.9572 20.8599 13.7022Z" fill="white"></path></g></svg><svg hidden="true" class="imt-manga-translated" width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="5.5" cy="5.5" r="5.5" fill="#68CD52"></circle><path d="M1.40857 5.87858L2.24148 5.18962L4.15344 6.64214C4.15344 6.64214 6.33547 4.15566 9.00658 2.48145L9.32541 2.87514C9.32541 2.87514 6.28665 5.55844 4.71735 9.07881L1.40857 5.87858Z" fill="white"></path></svg><svg class="imt-float-ball-loading" hidden="true" width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 9px;"><path d="M9.42859 0C9.84288 0 10.1929 0.387143 10.1929 0.847143V3.99429C10.1929 4.45429 9.84431 4.84143 9.42859 4.84143C9.01431 4.84143 8.66431 4.45571 8.66431 3.99429V0.847143C8.66431 0.387143 9.01288 0 9.42859 0Z" fill="#E9E9E9"></path><path d="M14.1301 1.38877C14.5158 1.62591 14.6301 2.12163 14.4258 2.52305L12.9515 5.19448C12.901 5.28714 12.8325 5.36876 12.75 5.43455C12.6675 5.50035 12.5727 5.54898 12.4712 5.5776C12.3696 5.60621 12.2634 5.61424 12.1586 5.60119C12.0539 5.58814 11.9529 5.55429 11.8615 5.50163C11.6787 5.38432 11.5468 5.20237 11.4923 4.9921C11.4377 4.78184 11.4645 4.55874 11.5672 4.36734L13.0415 1.69591C13.2686 1.29448 13.7443 1.15305 14.1301 1.38877Z" fill="#989697"></path><path d="M17.4685 4.75707C17.5813 4.95451 17.6123 5.18824 17.5549 5.40825C17.4975 5.62826 17.3563 5.81705 17.1614 5.93422L14.4971 7.52564C14.0971 7.76993 13.6014 7.62422 13.3657 7.20707C13.2532 7.00994 13.2222 6.77667 13.2793 6.55702C13.3365 6.33737 13.4771 6.14874 13.6714 6.03136L16.3357 4.43993C16.7371 4.21993 17.2557 4.34136 17.4685 4.7585V4.75707Z" fill="#9B999A"></path><path d="M18.8572 9.42835C18.8572 9.84263 18.47 10.1926 18.01 10.1926H14.8629C14.4029 10.1926 14.0157 9.84406 14.0157 9.42835C14.0157 9.01406 14.4029 8.66406 14.8629 8.66406H18.01C18.47 8.66406 18.8572 9.01263 18.8572 9.42835Z" fill="#A3A1A2"></path><path d="M17.4686 14.1303C17.3515 14.3134 17.1697 14.4455 16.9594 14.5003C16.7491 14.5552 16.5259 14.5286 16.3343 14.426L13.6629 12.9517C13.5702 12.9012 13.4886 12.8327 13.4228 12.7503C13.357 12.6678 13.3084 12.573 13.2798 12.4714C13.2512 12.3698 13.2431 12.2636 13.2562 12.1589C13.2692 12.0542 13.3031 11.9532 13.3558 11.8617C13.4731 11.6789 13.655 11.547 13.8653 11.4925C14.0755 11.4379 14.2986 11.4647 14.49 11.5674L17.1615 13.0417C17.5629 13.2689 17.7043 13.7446 17.4686 14.1303Z" fill="#ABA9AA"></path><path opacity="0.7" d="M14.1 17.4686C13.9026 17.5814 13.6689 17.6124 13.4489 17.555C13.2288 17.4976 13.04 17.3564 12.9229 17.1615L11.3315 14.4972C11.0872 14.0972 11.2329 13.6015 11.65 13.3658C11.8472 13.2533 12.0804 13.2224 12.3001 13.2795C12.5197 13.3366 12.7084 13.4773 12.8257 13.6715L14.4172 16.3358C14.6372 16.7372 14.5157 17.2558 14.0986 17.4686H14.1Z" fill="#B2B2B2"></path><path opacity="0.6" d="M9.42859 18.8571C9.01431 18.8571 8.66431 18.4699 8.66431 18.0099V14.8628C8.66431 14.4028 9.01288 14.0156 9.42859 14.0156C9.84288 14.0156 10.1929 14.4028 10.1929 14.8628V18.0099C10.1929 18.4699 9.84431 18.8571 9.42859 18.8571Z" fill="#BAB8B9"></path><path opacity="0.5" d="M4.72717 17.4685C4.5441 17.3514 4.41195 17.1696 4.35713 16.9593C4.30231 16.749 4.32885 16.5258 4.43145 16.3342L5.90574 13.6628C5.95622 13.5701 6.02472 13.4885 6.1072 13.4227C6.18969 13.3569 6.2845 13.3083 6.38606 13.2797C6.48762 13.251 6.59387 13.243 6.69857 13.2561C6.80327 13.2691 6.90431 13.303 6.99574 13.3556C7.38145 13.5914 7.49431 14.0885 7.29002 14.4899L5.81574 17.1614C5.5886 17.5628 5.11288 17.7042 4.72717 17.4685Z" fill="#C2C0C1"></path><path opacity="0.4" d="M1.38862 14.1002C1.27584 13.9027 1.24483 13.669 1.30223 13.449C1.35964 13.229 1.50089 13.0402 1.69576 12.923L4.36004 11.3316C4.76004 11.0873 5.25576 11.233 5.49147 11.6502C5.60393 11.8473 5.63491 12.0806 5.5778 12.3002C5.52069 12.5199 5.38 12.7085 5.18576 12.8259L2.52004 14.4173C2.12004 14.6373 1.60004 14.5159 1.38862 14.0987V14.1002Z" fill="#CBCBCB"></path><path d="M0 9.42835C0 9.01406 0.387143 8.66406 0.847143 8.66406H3.99429C4.45429 8.66406 4.84143 9.01263 4.84143 9.42835C4.84143 9.84263 4.45571 10.1926 3.99429 10.1926H0.847143C0.387143 10.1926 0 9.84406 0 9.42835Z" fill="#D2D2D2"></path><path opacity="0.2" d="M1.38852 4.72705C1.50561 4.54398 1.68746 4.41183 1.89774 4.35701C2.10803 4.30219 2.33125 4.32873 2.52281 4.43133L5.19424 5.90562C5.28689 5.9561 5.36851 6.0246 5.43431 6.10708C5.5001 6.18957 5.54874 6.28438 5.57735 6.38594C5.60597 6.48749 5.61399 6.59375 5.60094 6.69845C5.5879 6.80315 5.55405 6.90419 5.50138 6.99562C5.38407 7.17844 5.20212 7.31029 4.99186 7.36484C4.78159 7.4194 4.55849 7.39263 4.3671 7.2899L1.69567 5.81562C1.29424 5.58847 1.15281 5.11276 1.38852 4.72705Z" fill="#DADADA"></path><path d="M4.75719 1.38849C4.95463 1.27571 5.18837 1.24471 5.40838 1.30211C5.62838 1.35952 5.81718 1.50077 5.93434 1.69564L7.52577 4.35992C7.77005 4.75992 7.62434 5.25564 7.20719 5.49135C7.01006 5.60381 6.77679 5.63479 6.55714 5.57768C6.33749 5.52056 6.14886 5.37988 6.03148 5.18564L4.44005 2.51992C4.22005 2.11992 4.34148 1.59992 4.75862 1.38849H4.75719Z" fill="#E2E2E2"></path></svg><div style="position: relative; pointer-events: all; display: inline-block;"><div><svg class="imt-manga-feedback" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.9999 3C15.1688 3 15.336 3.03326 15.492 3.09787C15.648 3.16248 15.7897 3.25719 15.9091 3.37658C16.0285 3.49597 16.1232 3.6377 16.1878 3.79369C16.2524 3.94968 16.2857 4.11687 16.2857 4.28571V12.8571C16.2857 13.026 16.2524 13.1932 16.1878 13.3492C16.1232 13.5052 16.0285 13.6469 15.9091 13.7663C15.7897 13.8857 15.648 13.9804 15.492 14.045C15.336 14.1096 15.1688 14.1429 14.9999 14.1429H8.32366L5.37766 16.0736C5.313 16.1159 5.23809 16.14 5.16086 16.1433C5.08363 16.1465 5.00696 16.1288 4.93897 16.0921C4.87097 16.0553 4.81418 16.0008 4.77462 15.9344C4.73506 15.868 4.71419 15.7922 4.71423 15.7149V14.1429H2.99995C2.83111 14.1429 2.66392 14.1096 2.50793 14.045C2.35194 13.9804 2.2102 13.8857 2.09081 13.7663C1.97142 13.6469 1.87672 13.5052 1.8121 13.3492C1.74749 13.1932 1.71423 13.026 1.71423 12.8571V4.28571C1.71423 3.94472 1.84969 3.61769 2.09081 3.37658C2.33193 3.13546 2.65896 3 2.99995 3H14.9999ZM14.9999 4.28571H2.99995V12.8571H5.99995V14.1287L7.94009 12.8571H14.9999V4.28571ZM9.54852 8.57143V9.85714H5.99995V8.57143H9.54852ZM11.9999 6V7.28571H5.99995V6H11.9999Z" fill="#6C6F73"></path></svg></div></div></div><div class="imt-fb-more-buttons btn-animate" style="margin-top: 12px; transform: translateX(60px);"><div class="btn-animate" style="position: relative; pointer-events: all; display: inline-block;"><div><div class="imt-fb-more-button"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.6861 1L15.2353 4.54635V7.11765V14.6471V15.5882C15.2353 15.9627 15.0866 16.3217 14.8218 16.5865C14.557 16.8513 14.198 17 13.8235 17H4.41176C4.03734 17 3.67825 16.8513 3.4135 16.5865C3.14874 16.3217 3 15.9627 3 15.5882V14.6471V7.11765V2.41176C3 2.03734 3.14874 1.67825 3.4135 1.4135C3.67825 1.14874 4.03734 1 4.41176 1H11.6861ZM11.8692 3.17882V4.74212H13.4334L11.8692 3.17882ZM4.41171 15.5882V14.647V2.41176H10.4574L10.4578 6.15341H13.8235V14.647V15.5882H4.41171ZM12.7739 7.51746H5.46094V8.6155H12.7739V7.51746ZM5.46094 9.98805H12.7739V11.0861H5.46094V9.98805ZM9.5127 12.36H5.46094V13.458H9.5127V12.36Z" fill="#6C6F73"></path></svg></div></div></div><div class="btn-animate" style="position: relative; pointer-events: all; display: inline-block;"><div><div class="imt-fb-more-button"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.55741 0L9.06847 0.00329403C9.84824 0.00470579 10.4802 0.636235 10.4812 1.41647L10.4821 1.82588C10.9687 2.0278 11.4297 2.28671 11.8553 2.59718L12.1913 2.40329C12.516 2.21676 12.9013 2.1665 13.2629 2.26352C13.6246 2.36055 13.933 2.59695 14.1207 2.92094L15.3795 5.09365C15.5601 5.40546 15.6149 5.7744 15.5328 6.12523C15.4507 6.47606 15.2378 6.78235 14.9376 6.98165L14.8609 7.02871L14.5235 7.22353C14.5819 7.76273 14.5736 8.30708 14.4986 8.84424L14.7372 8.98259C15.0496 9.16307 15.2812 9.45606 15.3848 9.80165C15.4884 10.1472 15.456 10.5193 15.2944 10.8419L15.2553 10.9153L14.076 12.9576C13.8955 13.27 13.6025 13.5017 13.2569 13.6053C12.9113 13.7088 12.5392 13.6765 12.2167 13.5148L12.1433 13.4753L11.8172 13.2871C11.4074 13.5817 10.9651 13.8283 10.4991 14.0221L10.4995 14.5831C10.5 14.9434 10.3629 15.2904 10.1163 15.5532C9.86972 15.816 9.53215 15.9748 9.17247 15.9972L9.08306 16L6.57153 15.9967C6.19697 15.9961 5.83793 15.847 5.57312 15.5821C5.30831 15.3172 5.15932 14.9581 5.15883 14.5835L5.15788 13.9073C4.76852 13.7244 4.39771 13.5044 4.05059 13.2504L3.44918 13.5967C3.12448 13.7834 2.73902 13.8337 2.37726 13.7367C2.01551 13.6397 1.70698 13.4032 1.5193 13.0791L0.260473 10.9064C0.0799611 10.5945 0.0252226 10.2255 0.107423 9.87467C0.189623 9.52384 0.402569 9.21757 0.702826 9.01835L0.779062 8.97129L1.3913 8.61835C1.34424 8.17129 1.34188 7.71765 1.38706 7.26494L0.707532 6.87247C0.395061 6.69207 0.163305 6.39911 0.0596515 6.05351C-0.0440025 5.70791 -0.0117246 5.33577 0.149885 5.01318L0.189415 4.93976L1.36871 2.89741C1.54919 2.58502 1.84218 2.35337 2.18777 2.2498C2.53336 2.14624 2.90547 2.17859 3.228 2.34023L3.30141 2.37976L3.89436 2.72188C4.28027 2.42082 4.69854 2.1637 5.14141 1.95529L5.14047 1.41694C5.14001 1.05657 5.27707 0.709596 5.52367 0.446813C5.77028 0.184029 6.10786 0.0252343 6.46753 0.00282354L6.55741 0ZM6.55553 1.41506L6.55694 2.85271L5.74377 3.23576C5.39553 3.39906 5.06706 3.60094 4.764 3.83718L4.01247 4.424L2.62941 3.62494L2.59365 3.60518L1.41483 5.64753L2.88636 6.49694L2.79506 7.40612C2.75968 7.7598 2.76078 8.11619 2.79836 8.46965L2.8953 9.38541L1.48494 10.1976L2.7433 12.3704L4.14377 11.5647L4.88636 12.1087C5.15997 12.309 5.45231 12.4823 5.7593 12.6264L6.57106 13.008L6.57388 14.5816L9.08447 14.5849L9.08306 13.0791L9.95553 12.7158C10.3216 12.5635 10.6689 12.3698 10.9908 12.1384L11.7329 11.6047L12.8506 12.2499L14.0289 10.2075L12.9654 9.592L13.0972 8.64847C13.1561 8.22659 13.1628 7.79904 13.1169 7.37553L13.0181 6.45882L14.1555 5.80235L12.8967 3.62965L11.7645 4.28235L11.0214 3.74024C10.686 3.4956 10.3229 3.29152 9.93953 3.13224L9.06894 2.77082L9.06659 1.41835L6.55553 1.41506ZM9.37153 5.47624C10.0214 5.85201 10.4955 6.47036 10.6898 7.19547C10.8841 7.92058 10.7827 8.69316 10.4078 9.34353C10.2223 9.66543 9.97517 9.9476 9.68053 10.1739C9.38589 10.4002 9.04953 10.5662 8.69068 10.6623C8.33183 10.7585 7.95754 10.7829 7.58923 10.7343C7.22092 10.6856 6.86582 10.5648 6.54424 10.3788C5.89445 10.003 5.4204 9.38458 5.2262 8.65948C5.032 7.93438 5.13352 7.16184 5.50847 6.51153C5.69395 6.18963 5.94107 5.90746 6.23571 5.68117C6.53034 5.45488 6.86671 5.28891 7.22556 5.19275C7.58441 5.09659 7.9587 5.07213 8.32701 5.12077C8.69532 5.16942 9.05042 5.29021 9.372 5.47624H9.37153ZM6.73388 7.21835C6.54638 7.54388 6.49567 7.9305 6.5929 8.29336C6.69012 8.65623 6.92733 8.96571 7.25247 9.15388C7.41305 9.24679 7.59037 9.30712 7.77429 9.33143C7.9582 9.35574 8.14511 9.34355 8.32431 9.29556C8.50351 9.24757 8.67149 9.16472 8.81864 9.05174C8.96579 8.93877 9.08923 8.7979 9.18188 8.63718C9.55883 7.98353 9.356 7.15435 8.73435 6.74494L8.66377 6.70118L8.59035 6.66165C8.26834 6.49988 7.89663 6.46742 7.55145 6.57093C7.20626 6.67444 6.91375 6.90608 6.73388 7.21835Z" fill="#6C6F73"></path></svg></div></div></div></div><div hidden="" class="imt-fb-more-buttons btn-animate" style="margin-top: 12px; transform: translateX(60px);"><div class="btn-animate" style="position: relative; pointer-events: all; display: inline-block;"><div><svg class="imt-manga-feedback" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.9999 3C15.1688 3 15.336 3.03326 15.492 3.09787C15.648 3.16248 15.7897 3.25719 15.9091 3.37658C16.0285 3.49597 16.1232 3.6377 16.1878 3.79369C16.2524 3.94968 16.2857 4.11687 16.2857 4.28571V12.8571C16.2857 13.026 16.2524 13.1932 16.1878 13.3492C16.1232 13.5052 16.0285 13.6469 15.9091 13.7663C15.7897 13.8857 15.648 13.9804 15.492 14.045C15.336 14.1096 15.1688 14.1429 14.9999 14.1429H8.32366L5.37766 16.0736C5.313 16.1159 5.23809 16.14 5.16086 16.1433C5.08363 16.1465 5.00696 16.1288 4.93897 16.0921C4.87097 16.0553 4.81418 16.0008 4.77462 15.9344C4.73506 15.868 4.71419 15.7922 4.71423 15.7149V14.1429H2.99995C2.83111 14.1429 2.66392 14.1096 2.50793 14.045C2.35194 13.9804 2.2102 13.8857 2.09081 13.7663C1.97142 13.6469 1.87672 13.5052 1.8121 13.3492C1.74749 13.1932 1.71423 13.026 1.71423 12.8571V4.28571C1.71423 3.94472 1.84969 3.61769 2.09081 3.37658C2.33193 3.13546 2.65896 3 2.99995 3H14.9999ZM14.9999 4.28571H2.99995V12.8571H5.99995V14.1287L7.94009 12.8571H14.9999V4.28571ZM9.54852 8.57143V9.85714H5.99995V8.57143H9.54852ZM11.9999 6V7.28571H5.99995V6H11.9999Z" fill="#6C6F73"></path></svg></div></div></div></div></div></template></div></html>